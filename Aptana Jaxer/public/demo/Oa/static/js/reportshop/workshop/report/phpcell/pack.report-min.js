function TCRSReport(o,p,w,u,t,y,x,s,r,B,v,A,q,z){this.openMode=o;this.repId=p;this.s_repname="";this.organId=w;this.userId=u;this.writeTime=t;this.s_title="";this.s_memo="";this.s_writer_organid="";this.s_writer=y;if(this.s_writer==""||this.s_writer==this.userId){this.s_writer=this.userId;this.s_writer_organid=w}this.s_assign_user=x;if(this.s_assign_user==undefined){this.s_assign_user=""}this.refKID="";this.s_kid="";title_schema="";subtitle_schema="";this.s_title_schema="";this.s_subtitle_schema="";s_title_schema=new Object();s_title_schema.name="";s_subtitle_schema=new Object();this.mobile=B;this.b_mobile=B;this.mobilestyle=v;this.s_repno="";this.showZeroValue=false;this.writeColList=null;this.readColList=null;this.obj_target_cell=null;this.obj_mouse_enter_cell=null;this.obj_mouse_enter_row=null;this.s_last_cell_bg_color=null;this.obj_target_inline_obj=null;this.crsDataSet=new TCRSDataSet();this.crsTableIndex=new TCRSTableIndex(this.crsDataSet,this.repId);this.crsFormulasCache=new TCRSFormulasCache(this.crsDataSet,this.repId);this.crsCodeIndex=new TCRSCodeIndex(this.crsDataSet);this.crsAutoCode=new TCRSAutoCode(this.crsDataSet);this.crsPrivCache=null;this.crsDeptCache=new TCRSDepartment(this.crsDataSet,w);this.crsUserCache=new TCRSUser(this.crsDataSet);this.crsChartCache=new TCRSChart(this.crsDataSet,this.repId);this.crsWorkflow=new TCRSWorkflow(this.crsDataSet,this.repId);this.crsReportState=new TCRSReportState(this.crsDataSet,this.repId,this.userId,this.writeTime);this.b_as_form=A||B;this.crsCommon=new TCRSCommon(this.b_as_form,B);this.obj_cell_maps={};this.ListKey="";this.s_read_filter="";this.s_dataflow="";this.i_active_sheet_index=0;this.obj_active_cell=null;if(this.writeTime==""){this.writeTime=this.crsDataSet.get_now()}this.s_begin_task="";this.s_cur_task=r;this.b_is_endtask=false;this.s_write_mode="";this.s_write_role="";this.s_can_roll_back="";this.s_next_task="";this.s_only_redirect_task="";this.b_submit=false;this.s_begin_writer="";this.arr_prev_done_tasks=null;this.b_saved=false;this.s_para=unescape(s);this.i_width=0;this.i_height=0;this.arr_schema=null;this.s_data_flow="";this.func_show_list_view=null;this.arr_upload_files=[];this.b_is_query=false;this.b_from_center=false;this.b_inline=false;this.s_postfix=q;this.s_timer="";this.b_has_inline_calcu=false;this.b_crs_gz=false;this.b_has_sign_seal=false;this.DWebSignSeal=null;this.b_delete_fresh=z}TCRSReport.prototype={constructor:TCRSReport,get_valid_cur_task:function(){var b=crsReport.s_cur_task;if(b==""){b=crsReport.s_begin_task}else{b=crsReport.crsWorkflow.get_valid_task(b)}return b},doOpenReport:function(){var b=this.crsDataSet.execQuery("select * from crscell.crs_report where id='"+this.repId+"'",undefined,undefined,"#tablecrs_report");this.s_write_organ=HandleMemoStr(b[0].write_priv_organ,false);this.s_write_role=HandleMemoStr(b[0].write_priv_role,false);this.s_kid=b[0].kid;this.s_write_mode=b[0].mode;this.showZeroValue=b[0].showzerovalue=="y";this.b_has_inline_calcu=b[0].has_inline_calcu=="y";this.s_can_roll_back=b[0].canrollback;this.s_title_schema=HandleMemoStr(b[0].title_schema,false);this.s_subtitle_schema=HandleMemoStr(b[0].subtitle_schema,false);s_title_schema.name=HandleMemoStr(b[0].title_schema,false);s_subtitle_schema.name=HandleMemoStr(b[0].subtitle_schema,false);this.s_repno=b[0].repno;this.s_repname=b[0].repname;if(this.openMode!="delete"){this.crsChartCache.load_chart()}this.initPara();this.crsCommon.draw(this.openMode!="write");if(this.arr_schema["#fetch_res"]!=undefined){this.crsFormulasCache.loadData("#tablecrs_formulas");this.crsFormulasCache.init_formulas();if(this.b_crs_gz){this.arr_schema["#fetch_res"]=crs_decode(this.arr_schema["#fetch_res"])}this.fill_values(this.arr_schema["#fetch_res"],this,this.arr_schema["#fetch_idx"])}if(this.openMode=="copynew"){this.writeTime=this.crsDataSet.get_now();this.crsTableIndex.clear_data_item_id();this.openMode="write"}if(this.openMode!="delete"){this.set_timer()}},initPara:function(){this.s_begin_task=this.crsWorkflow.get_begin_task();if(this.openMode=="write"||this.openMode=="copynew"){this.crsPrivCache=new TCRSDetailPriv(this.crsDataSet,this.repId,false);if(this.has_workflow()){var c=this.crsWorkflow.get_task_candidate("");for(i in c){if(this.s_begin_writer!=""){this.s_begin_writer+=","}this.s_begin_writer+=i}}var d=this.crsUserCache.get_dept_and_priv(this.s_writer);if(this.s_writer_organid==""){this.s_writer_organid=d.dept}this.crsPrivCache.getColumnList(this.s_writer,d.dept,d.other_dept,d.priv,d.other_priv,this.s_assign_user)}else{if(this.openMode=="edit"){if(this.s_cur_task==""||this.s_cur_task==this.s_begin_task||this.s_cur_task.indexOf(this.s_begin_task+"(")!=-1){this.crsPrivCache=new TCRSDetailPriv(this.crsDataSet,this.repId,false);var d=this.crsUserCache.get_dept_and_priv(this.s_writer);this.crsPrivCache.getColumnList(this.s_writer,d.dept,d.other_dept,d.priv,d.other_priv,this.s_assign_user)}else{var d=this.crsUserCache.get_dept_and_priv(this.s_writer);this.crsWorkflow.getColumnList(this.s_writer,d.dept,d.other_dept,d.priv,d.other_priv,this.s_assign_user)}if(this.s_writer_organid==""){this.s_writer_organid=d.dept}}else{if(this.openMode=="read"){this.crsPrivCache=new TCRSDetailPriv(this.crsDataSet,this.repId,true);var d=this.crsUserCache.get_dept_and_priv(this.s_writer);this.crsPrivCache.getColumnList(this.s_writer,d.dept,d.other_dept,d.priv,d.other_priv,this.s_assign_user)}}}this.crsTableIndex.initColSchema()},blur_handler:function(){this.crsCommon.blur_handler()},calculate:function(){this.crsCommon.calculate()},save_as_excel:function(){this.blur_handler();this.crsCommon.save_as_excel()},execute_manu_formulas:function(b){this.crsFormulasCache.execute_formulas("",CRS_MANUL_EXEC,0,"",1,b,false,false,false)},check:function(){this.save_data(false)},fill_values:function(aM,bt,aK){if(bt.openMode=="delete"){return}bt.crsFormulasCache.s_info="";if(aM==""){bt.crsCommon.begin_update();bt.crsCommon.end_update();return""}bt.crsCommon.begin_update();var aO=aM.split("@");var aC={};var k=1,bl="",a8=null,bk=null,bn=-1;var aY=[];var a4=[];for(var aN=0,aW=aO.length;aN<aW;aN++){if(aO[aN]==""){continue}var a7=aO[aN].split(";");var a0=a7[0].indexOf("_");if(a0==-1){a0=a7[0].length}var br=a7[0].substr(0,a0);a7=a7.slice(1);var br=br%bt.crsFormulasCache.rows.length;var ba=bt.crsFormulasCache.rows[br].formulastype;bl="";bn=-1;if(ba=="\u9a8c\u8bc1\u516c\u5f0f"){if(bt.crsFormulasCache.arr_formulas[br].arr_cur_column_ref!=null){for(var bd=0,bc=a7.length;bd<bc;bd++){var aG=a7[bd].indexOf("->displayseq");var a0=aG;while(a7[bd].charAt(a0)!=","){a0--}var a1=parseInt(a7[bd].substring(a0+1,aG));if(bt.crsFormulasCache.arr_formulas[br].i_cur_seq>0&&bt.crsFormulasCache.arr_formulas[br].i_cur_seq!=a1){continue}for(var aT=0,bf=bt.crsFormulasCache.arr_formulas[br].arr_cur_column_ref.length;aT<bf;aT++){var aU=bt.crsFormulasCache.arr_formulas[br].arr_cur_table_ref[aT];if(bt.crsFormulasCache.arr_formulas[br].arr_cur_column_ref[aT].charAt(0)!="{"){bt.crsFormulasCache.arr_formulas[br].arr_cur_column_ref[aT]=crsReport.crsTableIndex.get_col_kid_by_id(aU,bt.crsFormulasCache.arr_formulas[br].arr_cur_column_ref[aT])}var bv=crsReport.crsTableIndex.getAColSchema(bt.crsFormulasCache.arr_formulas[br].arr_cur_column_ref[aT]);var aH=bv.get_cell_point(a1);var bu=parseInt(crsReport.crsTableIndex.rows[bv.row_idx].sheetindex)-1;crsReport.crsCommon.set_cell_backgroud_color(bu,aH.x,aH.y,is_color_position(bt.crsFormulasCache.rows[br].fill_table));if(aT==0&&bt.crsFormulasCache.arr_formulas[br].s_error_hint_content!=""){bt.crsFormulasCache.s_info+="\u3010"+bt.crsFormulasCache.arr_formulas[br].s_label+"//"+HandleMemoStr(bt.crsFormulasCache.arr_formulas[br].s_error_hint_content,false)+"\u3011 \u7b2c\u3010"+a1+"\u3011\u884c\u6216\u5217\u4e0d\u6ee1\u8db3\n"}}}}}else{if(ba=="\u56de\u5199\u516c\u5f0f"){}else{for(var aT=0,az=a7.length;aT<az;aT++){if(a7[aT]==""){continue}var a9=a7[aT].split(",");for(var aV=0,bh=a9.length;aV<bh;aV++){a0=a9[aV].indexOf("->");if(a0==-1){continue}var bp=a9[aV].substr(0,a0);var a2=a9[aV].substr(a0+2,a9[aV].length);a0=a2.indexOf(CRSLimiter);if(a0==-1){var aI=bt.crsTableIndex.getAColSchema(a2);var aU=bt.crsTableIndex.rows[aI.row_idx].label;var p=aI.col.rows[aI.col_idx].columnlabel}else{var aU=a2.substr(0,a0),p=a2.substr(a0+3)}if(bp==""&&a4.indexOf(p)!=-1){continue}if(a4.indexOf(p)==-1){a4.push(p)}var au;var aF=br+aU+p;if(aC[aF]==undefined){aC[aF]={};au=bt.crsFormulasCache.get_fill_type(br,aU,p);if(au==""){for(var bd=0,bb=aK.length;bd<bb;bd++){au=bt.crsFormulasCache.get_fill_type(aK[bd],aU,p);if(au!=""){break}}if(au==""){au="\u586b\u5165\u503c"}}aC[aF].fill_type=au;var at=bt.crsTableIndex.get_col_kid_by_name(aU,p);aC[aF].col_schema=bt.crsTableIndex.getAColSchema(at)}else{au=aC[aF].fill_type}if(bl!=aU||a8==null){if(bl!=aU||a8==null){a8=bt.crsTableIndex.search("label",aU)}bl=aU;if(k!=1){k=1}if(a8.tabletype=="\u660e\u7ec6\u8868"){if(aT==0&&bn==-1){if(bt.crsFormulasCache.arr_formulas[br].i_cur_seq==0){bt.crsFormulasCache.arr_formulas[br].i_cur_seq=1}var aE=aY.indexOf(aU);if(aE!=-1){if(bt.crsFormulasCache.arr_formulas[br].b_do_match){k=bt.crsFormulasCache.arr_formulas[br].i_cur_seq}else{k=aY[aE+1]}aY[aE+1]=k+az;bn=0}else{k=bt.crsFormulasCache.arr_formulas[br].i_cur_seq;aY.push(aU);aY.push(k+az);bn=0}}if(az+k-1>a8.initcz&&bt.crsFormulasCache.arr_formulas[br].has_fill()){var aS=az+k-1-a8.initcz;var av=bt.crsTableIndex.getColumn(a8.id);var a6=rectNameToIndex(av.getColumnDefRect());if(a8.expandtype=="\u6309\u884c\u5411\u4e0b"){if(crsReport.b_as_form){crsReport.crsCommon.crsForm.append_record(a8,aC[aF].col_schema,aS)}else{var ay=a6[1].y-a6[0].y+1;var bi=a6[0].y+(a8.initcz-1)*ay;var bg=ay*aS;bt.crsTableIndex.update_cell_refer(a8.sheetindex,a8.expandtype,a6,aS,true);bt.crsCommon.crsTable.crsCellControler.insert_row(bt.obj_cell_maps[a8.sheetindex-1]["row"+bi+"column"+a6[0].x],a8.sheetindex-1,bi,bg);bt.crsCommon.crsTable.crsCellControler.cache_td(a8.sheetindex-1);for(var bd=0;bd<bg;bd++){var a1=bi+(bd+1)*ay;var aJ="row"+a1+"column"+a6[0].x;$(bt.obj_cell_maps[a8.sheetindex-1][aJ]).parent("#row"+a1).attr("rid",bt.crsTableIndex.create_row_kid(av.rows[0].kid))}a8.initcz=az+k-1;bt.crsTableIndex.auto_increment(av.rows[0].kid)}}else{if(a8.expandtype=="\u6309\u5217\u5411\u53f3"){var ay=a6[1].x-a6[0].x+1;var bi=a6[0].x+(a8.initcz-1)*ay;var bg=ay*aS;bt.crsTableIndex.update_cell_refer(a8.sheetindex,a8.expandtype,a6,aS,true);bt.crsCommon.crsTable.crsCellControler.insert_column(a8.sheetindex-1,bi,bg);bt.crsCommon.crsTable.crsCellControler.cache_td(a8.sheetindex-1);var bx="";for(var bd=0;bd<bg;bd++){for(var aQ=a6[0].y;aQ<=a6[1].y;){var a1=bi+(bd+1)*ay;var aJ="row"+aQ+"column"+a1;if(aQ==a6[0].y){bx=bt.crsTableIndex.create_row_kid(av.rows[0].kid)}var be=$(bt.obj_cell_maps[a8.sheetindex-1][aJ]);be.attr("rid",bx);if(be.attr("rowspan")!=undefined){aQ+=parseInt(be.attr("rowspan"))}else{aQ+=1}}}bt.crsTableIndex.auto_increment(av.rows[0].kid)}}}}}if(au=="\u6784\u9020\u4e0b\u62c9\u5217\u8868"||au=="\u6784\u9020\u4e0b\u62c9\u5217\u8868\uff08\u5141\u8bb8\u5176\u4ed6\u503c\uff09"){var bw=false;if(bt.crsFormulasCache.s_exec_time=="\u7b5b\u9009\u6761\u4ef6\u6539\u53d8\u540e\u81ea\u52a8\u6267\u884c"&&bt.crsFormulasCache.arr_formulas[br].b_do_match){if(au=="\u6784\u9020\u4e0b\u62c9\u5217\u8868"){var ax="n."+k+"."+aU+p+"."}else{var ax="y."+k+"."+aU+p+"."}}else{if(au=="\u6784\u9020\u4e0b\u62c9\u5217\u8868"){var ax="n.0."+aU+p+"."}else{var ax="y.0."+aU+p+"."}bw=true}if(aT==0){var aA=aC[aF].col_schema.canwrite?"":" disabled";if(bp.indexOf(CRSLess+"col"+CRSGreaterSign)==-1){if(crsReport.crsTableIndex.rows[aC[aF].col_schema.row_idx].tabletype=="\u4e3b\u8868"){if(crsReport.b_mobile){var aX=$("div[cid='"+aC[aF].col_schema.kid+"']")}else{var aX=$("td[cid='"+aC[aF].col_schema.kid+"']")}var bo=crsReport.crsCommon.get_cell_value(aX);if(bo!=""){$(aX).html('<select onchange="javascript:crsReport.crsCommon._do_editor_deactive(this);"'+aA+"><option value=''></option><option value='<\u8f93\u5165...>'><\u8f93\u5165...></option><option value='"+bo+"' selected>"+bo+"</option></select>")}else{$(aX).html('<select onchange="javascript:crsReport.crsCommon._do_editor_deactive(this);"'+aA+"><option value=''></option><option value='<\u8f93\u5165...>'><\u8f93\u5165...></option></select>")}}else{if(crsReport.b_mobile){var aP="div[cid='"+aC[aF].col_schema.kid+"']"}else{if(crsReport.b_as_form){var aP="td[aria-describedby$='"+aC[aF].col_schema.kid+"']"}else{var aP="td[cid='"+aC[aF].col_schema.kid+"']"}}$(aP).each(function(){var a=crsReport.crsCommon.get_cell_value(this);if(a!=""){$(this).html('<select onchange="javascript:crsReport.crsCommon._do_editor_deactive(this);"'+aA+"><option value=''></option><option value='<\u8f93\u5165...>'><\u8f93\u5165...></option><option value='"+a+"' selected>"+a+"</option></select>")}else{$(this).html('<select onchange="javascript:crsReport.crsCommon._do_editor_deactive(this);"'+aA+"><option value=''></option><option value='<\u8f93\u5165...>'><\u8f93\u5165...></option></select>")}})}}else{if(bt.crsTableIndex.listValues[ax]==undefined){bt.crsTableIndex.listValues[ax]={};bt.crsTableIndex.listValues[ax].formulas_label=bt.crsFormulasCache.rows[br].label;bt.crsTableIndex.listValues[ax].key=ax;bt.crsTableIndex.listValues[ax].data_list=[];bt.crsTableIndex.listValues[ax].obj_view=null}else{bt.crsTableIndex.listValues[ax].data_list=[];bt.crsTableIndex.listValues[ax].obj_view=null}if(crsReport.crsTableIndex.rows[aC[aF].col_schema.row_idx].tabletype=="\u4e3b\u8868"){if(crsReport.b_mobile){var bm=$("div[cid='"+aC[aF].col_schema.kid+"'] > input:eq(0)")}else{var bm=$("td[cid='"+aC[aF].col_schema.kid+"'] > input:eq(0)")}if(crsReport.b_mobile){if($(bm).attr("placeholder")!="\u8bf7\u9009\u62e9"&&aA==""){$(bm).attr("placeholder","\u8bf7\u9009\u62e9");$(bm).click(function(){crsReport.crsCommon.obj_cur_editor=bm;crsReport.crsTableIndex.loadCodeItem(bm.parent())})}}else{if(!$(bm).hasClass("userField")){$(bm).addClass("userField");$(bm).parent().append("<a href=\"javascript:\" onclick=\"$(this).siblings().val('');$(this).parent().attr('val','');return false;\" class=\"ref-delete-handle inline-block\"></a>");if(aA==""){$(bm).click(function(){crsReport.crsCommon.obj_cur_editor=bm;crsReport.crsTableIndex.loadCodeItem(bm.parent())})}$(bm).width($(bm).parent().width()-32)}}}else{if(crsReport.b_mobile){var aP="em[cid='"+aC[aF].col_schema.kid+"']"}else{if(crsReport.b_as_form){var aP="td[aria-describedby$='"+aC[aF].col_schema.kid+"']"}else{var aP="td[cid='"+aC[aF].col_schema.kid+"']"}}if(!crsReport.b_mobile){$(aP).each(function(){var b=crsReport.crsCommon.get_cell_value(this);var d=$(this).children();if(!$(d).hasClass("userField")){$(d).addClass("userField").mouseenter(function(){crsReport.crsCommon._id(this)});$(this).append("<a href=\"javascript:\" onclick=\"$(this).siblings().val('');$(this).parent().attr('val','');return false;\" class=\"ref-delete-handle inline-block\"></a>");if(aA==""){var f=this;$(d).attr("onclick","crsReport.crsCommon.obj_cur_editor = $(this); crsReport.crsTableIndex.loadCodeItem($(this).parent());")}$(d).width($(d).parent().width()-32)}if(bw&&crsReport.b_as_form){bw=false;var c=crsReport.crsCommon.crsForm.obj_detail_dump_row["tab_"+aC[aF].col_schema.tableid][aC[aF].col_schema.kid];var g=c.indexOf('<div class="field"');var g=c.indexOf(">",g);var e=c.indexOf("</div>",g);var a=c.substring(g+1,e);c=c.replace(a,$(this).html());crsReport.crsCommon.crsForm.obj_detail_dump_row["tab_"+aC[aF].col_schema.tableid][aC[aF].col_schema.kid]=c}})}else{if(bw){bw=false;var aw=crsReport.crsCommon.crsForm.obj_detail_dump_row["tab_"+aC[aF].col_schema.tableid][aC[aF].col_schema.kid];var bs=aw.indexOf('<div class="field"');var bs=aw.indexOf(">",bs);var bq=aw.indexOf("</div>",bs);var bj=aw.substring(bs+1,bq),s=bj;bj=bj.replace(">",' placeholder="\u8bf7\u9009\u62e9" onclick="crsReport.crsCommon.obj_cur_editor = $(this); crsReport.crsTableIndex.loadCodeItem($(this).parent());">');aw=aw.replace(s,bj);crsReport.crsCommon.crsForm.obj_detail_dump_row["tab_"+aC[aF].col_schema.tableid][aC[aF].col_schema.kid]=aw}}}}}if(bp!=""){var aZ=bp.split(" ");for(var bd=0,bb=aZ.length;bd<bb;bd++){var a5=HandleMemoStr(aZ[bd],false);if(a5.indexOf("<col>")==-1){if(crsReport.crsTableIndex.rows[aC[aF].col_schema.row_idx].tabletype=="\u4e3b\u8868"){crsReport.crsCommon.add_option($("td[cid='"+aC[aF].col_schema.kid+"'],div[cid='"+aC[aF].col_schema.kid+"']").children("select"),a5)}else{if(!crsReport.b_mobile&&crsReport.b_as_form){var aP="aria-describedby$='"+aC[aF].col_schema.kid+"'"}else{var aP="cid='"+aC[aF].col_schema.kid+"'"}$("td["+aP+"],div["+aP+"]").each(function(){crsReport.crsCommon.add_option($(this).children("select"),a5);if(bw&&crsReport.b_as_form&&bd==bb-1){bw=false;var b=crsReport.crsCommon.crsForm.obj_detail_dump_row["tab_"+aC[aF].col_schema.tableid][aC[aF].col_schema.kid];var d=b.indexOf('<div class="field"');var d=b.indexOf(">",d);var c=b.indexOf("</div>",d);var a=b.substring(d+1,c);b=b.replace(a,$(this).html());crsReport.crsCommon.crsForm.obj_detail_dump_row["tab_"+aC[aF].col_schema.tableid][aC[aF].col_schema.kid]=b}})}}else{bt.crsTableIndex.listValues[ax].data_list.push(a5)}}}}else{if(au=="\u586b\u5165\u503c"){var aB=aC[aF].col_schema.display_rect[0].x,aD=aC[aF].col_schema.display_rect[0].y;a8=bt.crsTableIndex.search("label",aU);if(bt.crsTableIndex.rows[aC[aF].col_schema.row_idx].tabletype=="\u660e\u7ec6\u8868"){var aL;if(bt.crsTableIndex.rows[aC[aF].col_schema.row_idx].expandtype=="\u6309\u5217\u5411\u53f3"||bt.crsTableIndex.rows[aC[aF].col_schema.row_idx].expandtype=="\u4e0d\u6269\u5c55\uff08\u6309\u5217\u5411\u53f3\uff09"){aL=aC[aF].col_schema.display_rect[1].x-aC[aF].col_schema.display_rect[0].x+1;aB+=aL*(aT+k-1)}else{aL=aC[aF].col_schema.display_rect[1].y-aC[aF].col_schema.display_rect[0].y+1;aD+=aL*(aT+k-1)}}bp=HandleMemoStr(bp,false);if(!bt.b_as_form){var aX=bt.crsCommon.crsTable.crsCellControler.get_cell(a8.sheetindex-1,aB,aD);var a3=aC[aF].col_schema;if(aC[aF].col_schema.datatype=="\u65e5\u671f\u578b"){$(aX).addClass("td_date")}if(aC[aF].col_schema.datatype=="\u8d27\u5e01\u578b"){$(aX).addClass("td_price")}if(aC[aF].col_schema.datatype=="\u6570\u503c\u578b"){if(a3.col.rows[a3.col_idx].columnlabel.indexOf("\u91d1\u989d")>=0){$(aX).addClass("td_price")}else{$(aX).addClass("td_number")}}if(aC[aF].col_schema.datatype=="\u94fe\u63a5\u578b"){$(aX).addClass("td_link")}if(a3.col.rows[a3.col_idx].columnlabel.indexOf("\u4eba")>=0){$(aX).addClass("td_name")}if(a3.col.rows[a3.col_idx].columnlabel.indexOf("\u540d\u79f0")>=0){$(aX).addClass("td_text")}if(a3.col.rows[a3.col_idx].columnlabel.indexOf("\u7f16\u53f7")>=0){$(aX).addClass("td_no")}if(a3.col.rows[a3.col_idx].columnlabel.indexOf("\u90e8\u95e8")>=0){$(aX).addClass("td_dept")}if(a3.col.rows[a3.col_idx].columnlabel.indexOf("\u671f\u6b21")>=0){$(aX).addClass("td_qici")}if(aT%2==0){$(aX).parent().addClass("even")}}crsReport.crsCommon.set_cell_value(a8.sheetindex-1,aB,aD,bp,aC[aF].col_schema);if(!bt.b_as_form){if(s_title_schema.name!=""){if(title_schema==""){title_schema=s_title_schema.name.replaceAll(aC[aF].col_schema.kid,format_text(aC[aF].col_schema.kid,bp))}else{title_schema=title_schema.replaceAll(aC[aF].col_schema.kid,format_text(aC[aF].col_schema.kid,bp))}}if(s_subtitle_schema.name!=""){if(subtitle_schema==""){subtitle_schema=s_subtitle_schema.name.replaceAll(aC[aF].col_schema.kid,format_text(aC[aF].col_schema.kid,bp))}else{subtitle_schema=subtitle_schema.replaceAll(aC[aF].col_schema.kid,format_text(aC[aF].col_schema.kid,bp))}}}}}}}}}}bt.crsCommon.end_update();if(!bt.b_as_form){var aR="";if(aR.indexOf(bt.s_repno)>=0){change_style=1}else{change_style=0}if(change_style==1){if(title_schema.indexOf("{")>=0){title_schema=title_schema.replace(/\{[^\}]*\}/g,"")}if(subtitle_schema.indexOf("{")>=0){subtitle_schema=subtitle_schema.replace(/\{[^\}]*\}/g,"0")}$("#table_title").html(title_schema);$("#table_title").css("display","block");$("#subject_title").html("("+subtitle_schema+")");$("#subject_title").css("display","block");$("#sheet0 #row0").remove();$("#sheet0 #row1").remove();$("#sheet0 #row2").addClass("title_th");var aW=$("#sheet0 #row2").children("td").length;for(aN=0;aN<aW;aN++){if($("#sheet0 #row2").children("td").eq(aN).html()==""){$("#sheet0  tr").each(function(){$(this).children("td:eq("+aN+")").remove()})}}$("#sheet0").addClass("tablenew");if(bt.mobile==1){$("#sheet0 #row2").addClass("mobiletitle_th");if(bt.mobilestyle==1){$("#table_title").addClass("ipmobile_table_title");$("#subject_title").addClass("ipmobile_subject_title");$("#sheet0 #row2").addClass("ipmobile_title_th");$("#sheet0  tr:not(:nth-child(1))").addClass("ipmobile_tr")}}$("#showdiv").css("display","block")}}},handle_before_save:function(){this.blur_handler();this.crsCommon.calculate(true);this.crsFormulasCache.execute_formulas(this.get_valid_cur_task(),CRS_SAVE_EXEC,"","","0","",false,false,false)},save_data:function(b){if(b==undefined){b=true}return this.crsTableIndex.save_data(b,false,true,false,false)},free:function(){if(this.s_timer!=""){clearTimeout(this.s_timer)}return this.crsTableIndex.free()},get_val_from_para:function(m){var g="";if(this.s_para!=""){var k=this.s_para.indexOf(m);if(k!=-1){var h=this.s_para.length,l=k+m.length;while(this.s_para.charAt(l)==" "){l++}if(l<h&&this.s_para.charAt(l)=="="){l++;while(this.s_para.charAt(l)==" "){l++}var n=l+1;while(n<h&&this.s_para.charAt(n)!=" "){n++}g=this.s_para.substring(l,n)}else{l=k;while(l>=0&&this.s_para.charAt(l)!=" "&&this.s_para.charAt(l)!="="){l--}while(l>=0&&this.s_para.charAt(l)==" "){l--}if(this.s_para.charAt(l)=="="){l--;while(l>=0&&this.s_para.charAt(l)==" "){l--}var n=l-1;while(n>=0&&this.s_para.charAt(n)!=" "){n--}g=this.s_para.substring(n+1,l+1)}}}}if(g!=""){if(g.charAt(0)=='"'){g=g.substr(1)}if(g.charAt(g.length-1)=='"'){g=g.substring(0,g.length-1)}}return g},get_sub_query:function(d,c){return""},get_column_data_type:function(f,d,e){return""},has_inline_func:function(){return this.b_has_inline_calcu},has_manu_exec_func:function(){return this.crsFormulasCache.has_manu_exec_func()},has_workflow:function(){return this.s_write_mode!=""||this.crsWorkflow.length()>0},has_chart:function(){return this.crsChartCache.length()>0},get_chart_type:function(){if(this.crsChartCache.length()>0){return this.crsChartCache.rows[0].chart_type}return"\u67f1\u72b6\u56fe"},pivot:function(l){var h=$(this.obj_active_cell).attr("cid");if(h==""){return}var f=this.crsCellControler.get_cell_point(this.obj_active_cell);var g=this.crsTableIndex.getAColSchema(h);var k=g.get_display_seq(f.x,f.y);this.crsFormulasCache.execute_formulas("","NaN",1,h,k,l,false,false,true)},resize:function(){this.crsCommon.resize()},submit_picture:function(d,c){if(d==undefined){d="FILE1"}ajaxFileUpload(d,"img",this.show_picture,c)},show_picture:function(l,m){if(l!=""){if(m==undefined){m=crsReport.obj_target_cell}crsReport.arr_upload_files.push(l);var g=$(m).width()-20,k=$(m).height()-2;var f=$(m).children("i").length>0?"<i align='right'>"+$(m).children("i").html()+"</i>":"";var h="<img src='/attachment/reportshop/images/"+l+"' width='"+g+"' height='"+k+"' ondblclick='window.parent.float_image(this)' onmouseover='crsReport.show_delete(this)'/>";$(m).html(h+f);$(m).attr("val2",l)}},show_delete:function(h){if($(h).next(":not(i)").length>0){return}if(this.openMode=="read"){return}var g=$(h).parent().attr("cid");if(g==undefined&&this.b_as_form){g=this.crsCommon.crsForm._get_cid_by_td($(h).parent())}if(g==""){return}var e=this.crsTableIndex.getAColSchema(g);if(e==null||!e.canwrite||!e.canread||(this.writeColList!=null&&this.writeColList.indexOf(g)==-1)){return}var f='<img id="delete_icon" title="\u5220\u9664" src="/static/images/closesearch.gif" align=absmiddle style="cursor:pointer;" onclick="crsReport.delete_attach(this)" onmouseout="crsReport.hide_delete(this);"/>';$(h).after(f)},hide_delete:function(b){$(b).remove()},delete_attach:function(k){k=$(k).prev();var h=$(k)[0].localName.toLowerCase();if(h=="img"){var f=$(k).attr("src");f=f.replaceAll("/attachment/reportshop/images/","");if(this.arr_upload_files.indexOf(f)==-1){this.arr_upload_files.push(f)}g=$(k).parent();$(k).parent().removeAttr("val");$(k).parent().removeAttr("val2");$(k).next().remove();$(k).remove();f=this.crsCommon.get_rid_and_cid(g);$(g).prepend('<a class="addfile" href="javascript:;">\u9009\u62e9\u56fe\u7247<input class="addfile" hidefocus="true" type="file" size="1" id="'+f+'" name="'+f+'" accept="image/*" onchange="crsReport.submit_picture(\''+f+'\', $(this).parent().parent());" onclick="crsReport.crsCommon._id(this);"></a>')}else{if(h=="a"){var f=$(k).attr("href");f=f.replaceAll("/attachment/reportshop/attachment/","");if(this.arr_upload_files.indexOf(f)==-1){this.arr_upload_files.push(f)}var g=$(k).parent();$(k).parent().removeAttr("val");$(k).parent().removeAttr("val2");$(k).next().remove();$(k).remove();f=f.substring(1,f.indexOf("}_"));var e=$.md5(f);$(g).prepend('<a class="addfile" href="javascript:;">\u9009\u62e9\u9644\u4ef6<input class="addfile" hidefocus="true" type="file" size="1" id="'+e+'" name="'+e+'" onchange="crsReport.submit_attach(\''+e+"', $(this).parent().parent(), '"+f+'\');" onclick="crsReport.crsCommon._id(this);"></a>')}}},submit_attach:function(d,c,e){if(e==undefined){e=""}if(d==undefined){d="FILE1"}ajaxFileUpload(d,"attach",this.show_attach,c,e)},show_attach:function(k,f){if(k!=""){if(f==undefined){f=crsReport.obj_target_cell}var g=k.split("}_");crsReport.arr_upload_files.push(k);var e=$(f).children("i").length>0?"<i align='right'>"+$(f).children("i").html()+"</i>":"";var h="<a href='/attachment/reportshop/attachment/"+k+"' target='_blank' onmouseover='crsReport.show_delete(this)'>"+g[1]+"</a>";$(f).html(h+e);$(f).attr("val",g[1]);$(f).attr("val2",g[1])}},hide_edit:function(b){$(b).remove()},edit:function(f){var d=$(f).parent().attr("val");var e='<input title="'+d+'" class="InputField Width90 "" onfocus="$(this).addClass(\'InputFocus\');" type="text" maxlength="100"value="'+d+'" onblur="$(this).removeClass(\'InputFocus\');crsReport.crsCommon._do_editor_deactive(this);">';$(f).parent().html(e)},show_edit:function(h){if($(h).next().length>0){return}if(this.openMode=="read"){return}var g=$(h).parent().attr("cid");if(g==undefined&&this.b_as_form){g=this.crsCommon.crsForm._get_cid_by_td($(h).parent())}if(g==""){return}var e=this.crsTableIndex.getAColSchema(g);if(e==null||!e.canwrite||!e.canread||(this.writeColList!=null&&this.writeColList.indexOf(g)==-1)){return}var f='<img title="\u7f16\u8f91" src="/static/images/edit.gif" align=absmiddle style="cursor:pointer;" onclick="crsReport.edit(this)" onmouseout="crsReport.hide_edit(this);"/>';$(h).after(f)},fill_selected_value:function(p,n,r,k){var o=this.crsCommon.get_row_seq(this.crsCommon.obj_cur_editor.parent())+k;var m=this.crsTableIndex.get_col_kid_by_id(p,n);var l=this.crsTableIndex.getAColSchema(m);var q=l.get_cell_point(o);this.crsCommon.set_cell_value(0,q.x,q.y,r)},on_dblclick:function(d){var f=(d.srcElement==undefined)?d.target:d.srcElement;if($(f).attr("cid")==undefined){f=$(f).parent("td");if(!this.b_as_form&&$(f).attr("cid")==undefined){return}}var e=crsReport.crsTableIndex.get_ref_report(f);if(e!=null){window.parent.link_report(e)}return false},_s_exec:function(){this.crsFormulasCache.execute_formulas("",CRS_WRITE_EXEC,"1","","0","",false,false,false)},set_timer:function(){if(this.has_chart()){var b=this.crsChartCache.first();if(b.realtime>0){this._s_exec();this.s_timer=window.setTimeout("crsReport.set_timer()",b.realtime*1000)}}},show_hint:function(a){if(this.b_mobile){show_it(a)}else{alert(a)}}};function TCRSDataSet(){this.xml=""}TCRSDataSet.prototype={constructor:TCRSDataSet,execQuery:function(aSQL,cb,obj,s_key,_s_temp_table_list,_s_snapshot_sql){if(_s_temp_table_list==undefined){_s_temp_table_list=""}if(_s_snapshot_sql==undefined){_s_snapshot_sql=""}if(crsReport.arr_schema!=null&&s_key!=undefined&&s_key!=""){if(crsReport.arr_schema[s_key]!=undefined){if(crsReport.b_crs_gz&&typeof crsReport.arr_schema[s_key]=="string"){crsReport.arr_schema[s_key]=crs_decode(crsReport.arr_schema[s_key]);crsReport.arr_schema[s_key]=eval(crsReport.arr_schema[s_key])}if(cb==undefined){return crsReport.arr_schema[s_key]}else{cb(crsReport.arr_schema[s_key],obj);return}}}if(cb==undefined){var s=$.ajax({url:"/general/reportshop/utils/exec_query.php",type:"post",data:{SQLQuery:crsReport.b_crs_gz?crs_encode(aSQL):MapKey(HandleMemoStr(aSQL)),json:"1",temp_table_list:_s_temp_table_list,snapshot_sql:crsReport.b_crs_gz?crs_encode(_s_snapshot_sql):MapKey(HandleMemoStr2(_s_snapshot_sql))},dataType:"json",async:false}).responseText;if(crsReport.b_crs_gz){s=eval(crs_decode(s))}return s}else{$.ajax({url:"/general/reportshop/utils/exec_query.php",type:"post",data:{SQLQuery:crsReport.b_crs_gz?crs_encode(aSQL):MapKey(HandleMemoStr(aSQL)),json:"1",snapshot_sql:crsReport.b_crs_gz?crs_encode(_s_snapshot_sql):MapKey(HandleMemoStr2(_s_snapshot_sql))},dataType:crsReport.b_crs_gz?"text":"json",success:function(json){if(crsReport.b_crs_gz){json=eval(crs_decode(json))}cb(json,obj)},error:function(request,strError){crsReport.show_hint("\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u91cd\u65b0\u52a0\u8f7d\u3002")},async:false})}},execQuery2:function(d,e,g,f){if(crsReport.arr_schema!=null&&f!=undefined&&f!=""){if(crsReport.arr_schema[f]!=undefined){if(crsReport.b_crs_gz&&typeof crsReport.arr_schema[f]=="string"){crsReport.arr_schema[f]=crs_decode(crsReport.arr_schema[f])}e(crsReport.arr_schema[f],g);return}}$.ajax({url:"/general/reportshop/utils/exec_query2.php",type:"post",data:{SQLQuery:crsReport.b_crs_gz?crs_encode(d):MapKey(HandleMemoStr(d)),json:"1"},dataType:"text",success:function(a){if(crsReport.b_crs_gz){a=crs_decode(a)}e(a,g)},error:function(a,b){crsReport.show_hint("\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u91cd\u65b0\u52a0\u8f7d\u3002")},async:false})},exec_sql_list:function(y,D,p,s,v,u,x,r,A,w,C,z,B){var q=JSON.stringify(D);if(y==""){y="\u6570\u636e\u6e90_TD_OA"}if(B==undefined){B=""}var t=false;$.ajax({url:"/general/reportshop/utils/db_action.php",type:"post",data:{database:(y),action:"exec1",action_map:crsReport.b_crs_gz?crs_encode(q):q,b_pivot:p,cur_table_list:v,column_ref_back:x,cond_sql_list:r,temp_table_list:z,snapshot_sql:crsReport.b_crs_gz?crs_encode(B):MapKey(HandleMemoStr2(B)),json:"1",cur_rep:crsReport.s_postfix},dataType:"text",beforeSend:function(){show_hint("\u83b7\u53d6\u6570\u636e\u4e2d\uff0c\u8bf7\u7a0d\u540e")},complete:function(){hide_hint()},success:function(a){if(crsReport.b_crs_gz){a=crs_decode(a)}A(a,w,C);crsReport.crsFormulasCache.end_execute()},error:function(a,b){crsReport.crsFormulasCache.end_execute();crsReport.show_hint("\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u91cd\u65b0\u52a0\u8f7d\u3002"+b)},async:false})},execUpdate:function(b){b=b.replaceAll("\\","#005C`");b=b.replaceAll("\n",CRSNewLine);$.ajax({url:"/general/reportshop/utils/batch_exec_query.php",type:"post",data:{SQLQuery:crsReport.b_crs_gz?crs_encode(b):MapKey(HandleMemoStr2(b)),json:"1"},dataType:"text",success:function(a){},error:function(d,a){crsReport.show_hint("\u4fdd\u5b58\u51fa\u9519\uff1a"+a)},async:false})},get_next_autocode:function(c){var d=$.ajax({url:"/general/reportshop/design/report/console/autocode/autocode.php?action=generate&id="+c,type:"get",dataType:"text",async:false}).responseText;return d},roll_back:function(d,c){$.ajax({url:"/general/reportshop/design/report/console/autocode/autocode.php?id="+d+"action=rollback&code="+c,type:"get",dataType:"text",async:false})},is_exist_key:function(g,m,l,n){var k=false;var h=$.ajax({url:"/general/reportshop/utils/misc2.php",data:{action:"is_exists_key",tabid:g,key_where:m,userid:l,writetime:n,json:1},type:"post",dataType:"text",async:false}).responseText;k=h=="y";return k},get_now:function(){return $.ajax({url:"/general/reportshop/utils/misc.php?action=timestamp",type:"get",dataType:"text",async:false}).responseText},calculate:function(_arr_actions,cb,obj,_b_asyn,_b_save_excel){var s=_arr_actions.toString();$.ajax({url:"/general/reportshop/utils/js_action.php",data:{action:"calcu",actions:crsReport.b_crs_gz?crs_encode(s):s,cur_rep:crsReport.s_postfix},type:"post",dataType:crsReport.b_crs_gz?"text":"json",beforeSend:function(){},complete:function(){},success:function(json){if(crsReport.b_crs_gz){json=eval(crs_decode(json))}cb(json,obj,_b_save_excel)},error:function(request,strError){},async:_b_asyn})},save_as_excel:function(b){$("iframe[name='actionFrame']",window.parent.document).attr("src","/general/reportshop/utils/js_action.php?action=save_as_excel&file_name="+b+"&cur_rep="+crsReport.s_postfix)},free_me:function(f){var h="";for(var l=0,g=crsReport.arr_upload_files.length;l<g;l++){if(crsReport.arr_upload_files[l]!=""){h+=crsReport.arr_upload_files[l]+","}}f="";if(crsReport.openMode=="edit"&&crsReport.b_saved&&crsReport.b_delete_fresh){f=crsReport.crsTableIndex.create_cur_table_data(true)}var k={SQLQuery:crsReport.b_crs_gz?crs_encode(f):MapKey(HandleMemoStr2(f)),cur_rep:crsReport.s_postfix,json:1,open_mode:crsReport.openMode,has_workflow:crsReport.has_workflow(),saved:(crsReport.b_saved?1:0)};k.rep_repid=crsReport.repId;k.rep_organid=crsReport.organId;k.rep_userid=crsReport.userId;k.rep_writetime=crsReport.writeTime;if(h!=""){k.upload_files=h}if(crsReport.b_saved&&k.has_workflow){if(!crsReport.b_submit&&crsReport.b_is_endtask&&crsReport.writeColList!=null&&crsReport.writeColList.length==0){crsReport.b_submit=true}k.task_IsSubmit=crsReport.b_submit;k.task_BeginWriter=crsReport.s_begin_writer;k.task_CurTask=crsReport.s_cur_task;k.task_CurOrgan=crsReport.s_writer_organid;k.task_CurWriter=crsReport.s_writer;k.task_NextTask=crsReport.s_next_task;k.task_RedirectTask=crsReport.s_only_redirect_task}return $.ajax({url:"/general/reportshop/utils/free_me.php",type:"post",data:k,dataType:"text",success:function(a){},error:function(a,b){},async:false}).responseText},open_hyperlink:function(f,g,k,h){var l=$.ajax({url:"/general/reportshop/utils/misc2.php",type:"post",data:{action:"open_hyperlink",repid:crsReport.repId,kid:f,seq:g,postfix:k,userid:crsReport.userId,writetime:crsReport.writeTime,json:1,snapshot_sql:crsReport.b_crs_gz?crs_encode(h):MapKey(HandleMemoStr2(h))},dataType:"text",success:function(a){},error:function(a,b){},async:false}).responseText;return l},get_user_by_id:function(b){var a=[];$.ajax({url:"/general/reportshop/utils/get_user_by_id.php",type:"post",data:{userid_list:b},dataType:"json",success:function(c){a=c},error:function(c,d){},async:false});return a},get_user_by_name:function(a){var b=[];var d=$.ajax({url:"/general/reportshop/utils/get_user_by_name.php",type:"post",data:{username_list:a},dataType:"json",success:function(c){b=c},error:function(c,e){},async:false}).responseText;return b},get_dept_by_id:function(b){var a=[];var d=$.ajax({url:"/general/reportshop/utils/get_dept_by_id.php",type:"post",data:{deptid_list:b},dataType:"json",success:function(c){a=c},error:function(c,e){},async:false}).responseText;return a},get_dept_by_name:function(a){var b=[];var d=$.ajax({url:"/general/reportshop/utils/get_dept_by_name.php",type:"post",data:{deptname_list:a},dataType:"json",success:function(c){b=c},error:function(c,e){},async:false}).responseText;return b},get_long_dept_name:function(a){return $.ajax({url:"/general/reportshop/utils/get_long_dept_name.php",type:"post",data:{dept_id:a},dataType:"text",async:false}).responseText}};function TCRSDataRecord(h,g,f,l,k){this.dataSet=h;this.rows=[];this.doLoaded=false;this.columnList=f;if(f!=undefined){this.arr_column_list=f.split(";")}this.condExpr=l;this.tabName=g;this.orderExpr=k;this.cursor=0}TCRSDataRecord.prototype={loadData:function(d){if(this.doLoaded){return}var c="select "+this.columnList+" from "+this.tabName;if(this.condExpr!=""){c+=" where "+this.condExpr}if(this.orderExpr!=""){c+=" order by "+this.orderExpr}this.dataSet.execQuery(c,this.loadDataCB,this,d);this.doLoaded=true},loadDataCB:function(e,f){var d=f.rows;$.each(e,function(b,a){d.push(a)})},isEmpty:function(){return this.rows.length==0},EOF:function(){return this.rows.length<=this.cursor},first:function(){this.cursor=0;return this.rows[this.cursor]},next:function(){++this.cursor;if(this.EOF()){return null}else{return this.rows[this.cursor]}},length:function(){return this.rows.length},search:function(c,f){var g=this.cursor;if(!this.isEmpty()){var h=this.first();while(!this.EOF()){if(h[c]==f){this.cursor=g;return h}h=this.next()}}this.cursor=g;return null},multi_search:function(c,o){var l=this.cursor;if(!this.isEmpty()){var m=this.first();while(!this.EOF()){for(var p=0,k=c.length;p<k;p++){var n=c[p],q=o[p];if(m[n]!=q){break}}if(p==c.length){this.cursor=l;return m}m=this.next()}}this.cursor=l;return null},get_nth_by_col_name:function(b){return indexOf(this.arr_column_list,b)}};function TCRSTable(d,c){this.tabId=d;this.column=c}function TCRSTableIndex(c,d){this.repId=d;this.curColumn=null;this.crsDataSet=c;TCRSDataRecord.call(this,this.crsDataSet,"crscell.crs_tableindex","id,sheetindex,label,tabletype,expandtype,initcz,ishidden","repid='"+this.repId+"'","position");this.columns=[];this.colSchemas={};this.listValues={};this.obj_new_row_kid=null;this.obj_loaded_row_kid=null;this.obj_deleted_row_kid=null;this.arr_tab_property=null;this.arr_tab_id=null;this.arr_cur_tab_name=null;this.arr_hidden_rows=null;this.arr_hidden_cols=null;this.arr_col_name_to_kid=null;this.arr_col_id_to_kid=null}TCRSTableIndex.prototype=new TCRSDataRecord();TCRSTableIndex.prototype.initColSchema=function(){this.loadData("#tablecrs_tableindex"+this.repId);if(!this.isEmpty()){var o=crsReport.s_cur_task;if(o==""){o=crsReport.s_begin_task}var n=this.first();while(!this.EOF()){if(n.initcz<1){n.initcz=1}var r=this.getColumn(n.id);if(r.i_init_cz!=n.initcz){r.i_init_cz=n.initcz}r.loadData("#tablecrs_columnindex"+n.id);if(!r.isEmpty()){var p=r.first();while(!r.EOF()){if(p.color==""){p.color=16}var m=getColPlatKId(p.kid);this.colSchemas[m]={};if(crsReport.openMode=="read"){var k=false}else{var k=true}if(p.readonly!="\u662f"&&p.has_inline_calcu=="y"){p.readonly="\u662f"}if(p.readonly=="\u662f"||p.datatype=="\u81ea\u52a8\u7f16\u53f7"||p.datatype=="\u81ea\u589e\u578b"){k=false}var q=true;if(p.ishidden=="\u662f"||n.ishidden=="\u662f"){if(p.ishidden!="\u662f"){p.ishidden="\u662f"}q=false;k=false}if(k&&crsReport.writeColList!=null&&$.inArray(p.kid,crsReport.writeColList)==-1){k=false}if(q&&crsReport.readColList!=null&&$.inArray(p.kid,crsReport.readColList)==-1){q=false}this.colSchemas[m].canread=q;this.colSchemas[m].canwrite=k;if(k&&n.canwrite==undefined){n.canwrite=true}if(q&&n.canread==undefined){n.canread=true}if((q||k)&&!crsReport.b_has_sign_seal&&p.datatype=="\u624b\u5199\u7b7e\u7ae0"){crsReport.b_has_sign_seal=true}if(n.tabletype=="\u4e3b\u8868"){if(q||k){if(p.datatype=="\u56fe\u7247\u578b"){if(r.arr_picture_cols==null){r.arr_picture_cols=[]}r.arr_picture_cols.push(p.kid)}else{r.arr_output_cols.push(r.cursor)}}else{if(r.arr_hidden_cols==null){r.arr_hidden_cols=[]}r.arr_hidden_cols.push(r.cursor)}}if(!q&&!k){if(this.arr_hidden_rows==null){this.arr_hidden_rows={}}if(this.arr_hidden_rows[n.id]==undefined){this.arr_hidden_rows[n.id]={col:[],dat:[]}}this.arr_hidden_rows[n.id]["col"].push(p.kid)}this.colSchemas[m].ismust=false;if(p.ismust=="\u662f"){this.colSchemas[m].ismust=true}else{if(p.ismust!=""){var l=p.ismust.split(",");if(l.indexOf(o)!=-1){this.colSchemas[m].ismust=true}}}this.colSchemas[m].id=p.id;this.colSchemas[m].kid=p.kid;this.colSchemas[m].tableid=p.tableid;this.colSchemas[m].datatype=p.datatype;this.colSchemas[m].displaystyle=p.displaystyle;this.colSchemas[m].codeid=p.codeid;this.colSchemas[m].display_rect=rectNameToIndex(p.cellspan);this.colSchemas[m].row_idx=this.cursor;this.colSchemas[m].col=r;this.colSchemas[m].col_idx=r.cursor;this.colSchemas[m].check_value=function(d){var b="";if(d==undefined||d==null||d==""||d.charAt(0)=="#"){return""}var e=this.col.rows[this.col_idx];if(e.datatype=="\u65e5\u671f\u578b"){var g="";var f="";var v="";var s="";if(d.indexOf(":")!=-1){var c=d.split(" ");var u=c[0].split("-");var h=c[1].split(":");g=h[0];f=h[1];v=h[2];s=h[3]}else{var u=d.split("-");g=0;f=0;v=0;s=0}if(u.length<2){u.push("00");u.push("00")}else{if(u.length<3){u.push("00")}}var a=Date.parse(u[1]+"/"+u[2]+"/"+u[0]+" "+g+":"+f+":"+v+"."+s);if(typeof a!="number"){b="\u3010"+e.columnlabel+"\u3011\u6307\u6807\u53ea\u5141\u8bb8\u8f93\u5165\u65e5\u671f\u578b\u6570\u636e\uff0c\u8bf7\u68c0\u67e5\u60a8\u7684\u8f93\u5165\uff01"}}else{if(e.datatype=="\u6570\u503c\u578b"){if(d.search(/^[-]{0,1}[0-9]+[.]{0,1}[0-9]*[%]{0,1}$/g)==-1){b="\u3010"+e.columnlabel+"\u3011\u6307\u6807\u53ea\u5141\u8bb8\u8f93\u5165\u6570\u503c\u578b\u6570\u636e\uff0c\u8bf7\u68c0\u67e5\u60a8\u7684\u8f93\u5165\uff01"}}else{if(e.datatype=="\u8d27\u5e01\u578b"){if(d.search(/^[-]{0,1}[0-9]+[.]{0,1}[0-9]*$/g)==-1){b="\u3010"+e.columnlabel+"\u3011\u6307\u6807\u53ea\u5141\u8bb8\u8f93\u5165\u8d27\u5e01\u578b\u6570\u636e\uff0c\u8bf7\u68c0\u67e5\u60a8\u7684\u8f93\u5165\uff01"}}}}return b};this.colSchemas[m].get_display_seq=function(c,a){var b=1;if(crsReport.crsTableIndex.rows[this.row_idx].tabletype=="\u660e\u7ec6\u8868"){var d=this.display_rect;if(crsReport.crsTableIndex.rows[this.row_idx].expandtype=="\u4e0d\u6269\u5c55"||crsReport.crsTableIndex.rows[this.row_idx].expandtype=="\u6309\u884c\u5411\u4e0b"){b=(a-d[0].y)/(d[1].y-d[0].y+1)+1}else{b=(c-d[0].x)/(d[1].x-d[0].x+1)+1}}return b};this.colSchemas[m].get_cell_point=function(b){var c={x:this.display_rect[0].x,y:this.display_rect[0].y};var a=crsReport.crsTableIndex.rows[this.row_idx];if(b>1&&a.tabletype=="\u660e\u7ec6\u8868"){if(a.expandtype=="\u6309\u884c\u5411\u4e0b"||a.expandtype=="\u4e0d\u6269\u5c55"){c.y+=(this.display_rect[1].y-this.display_rect[0].y+1)*(b-1)}else{c.x+=(this.display_rect[1].x-this.display_rect[0].x+1)*(b-1)}}return c};this.colSchemas[m].get_cell_rect=function(d){var b=[];b.push({x:this.display_rect[0].x,y:this.display_rect[0].y});b.push({x:this.display_rect[1].x,y:this.display_rect[1].y});var c=crsReport.crsTableIndex.rows[this.row_idx];if(d>1&&c.tabletype=="\u660e\u7ec6\u8868"){if(c.expandtype=="\u6309\u884c\u5411\u4e0b"||c.expandtype=="\u4e0d\u6269\u5c55"){var a=this.display_rect[1].y-this.display_rect[0].y+1;b[0].y+=a*(d-1);b[1].y+=a*(d-1)}else{var a=this.display_rect[1].x-this.display_rect[0].x+1;b[0].x+=a*(d-1);b[1].x+=a*(d-1)}}return b};if(p.radiogroup!=""&&p.datatype=="\u903b\u8f91\u578b"){if(r.arr_radio_group==undefined){r.arr_radio_group=[]}r.arr_radio_group.push(HandleMemoStr(p.radiogroup,false))}p=r.next()}}n=this.next()}}};TCRSTableIndex.prototype.getAColSchema=function(c){var d=getColPlatKId(c);return this.colSchemas[d]};TCRSTableIndex.prototype.getColumn=function(f){var h=0,g=this.columns.length;for(;h<g;h++){if(this.columns[h].tabId==f){break}}if(h>=g){var e=new TCRSColumnIndex(this.crsDataSet,f);this.columns.push(new TCRSTable(f,e));return e}else{return this.columns[h].column}};TCRSTableIndex.prototype.getFirstTable=function(){this.loadData("#tablecrs_tableindex");res=null;if(!this.isEmpty()){var c=this.first();while(!this.EOF()){if(c.ishidden!="\u662f"){this.curColumn=this.getColumn(c.id);res=[];res.push(c.tabletype=="\u4ea4\u53c9\u8868"?"\u4e3b\u8868":c.tabletype);res.push(c.sheetindex);res.push(c.expandtype);res.push(c.initcz);var d=this.curColumn.getRecordCount();if(d>c.initcz){c.initcz=d}res.push(d);res.push(this.curColumn.getColumnDefRect(c.expandtype));break}c=this.next()}}return res};TCRSTableIndex.prototype.getNextTable=function(){this.loadData("#tablecrs_tableindex");res=null;if(!this.isEmpty()){var c=this.next();while(!this.EOF()){if(c.ishidden!="\u662f"){this.curColumn=this.getColumn(c.id);res=[];res.push(c.tabletype=="\u4ea4\u53c9\u8868"?"\u4e3b\u8868":c.tabletype);res.push(c.sheetindex);res.push(c.expandtype);res.push(c.initcz);var d=this.curColumn.getRecordCount();if(d>c.initcz){c.initcz=d}res.push(d);res.push(this.curColumn.getColumnDefRect(c.expandtype));break}c=this.next()}}return res};TCRSTableIndex.prototype.GetFirstWritableCellList=function(k){var o=null;this.loadData("#tablecrs_tableindex");var q=true;if(!this.isEmpty()){var m=this.first();while(!this.EOF()){if(m.ishidden!="\u662f"){if(k!=null){for(var p=0,l=k.length;p<l;p++){var r=this.getColumn(m.id);var n=this.getAColSchema(k[p]);if(true||r==n.col){q=true;break}else{if(q){q=false}}}}if(q){break}}m=this.next()}if(m!=null){r=this.getColumn(m.id);this.curColumn=r;o=r.getWriteCellList(m,k)}}return o};TCRSTableIndex.prototype.GetNextWritableCellList=function(k){var o=null;this.loadData("#tablecrs_tableindex");var q=true;if(!this.isEmpty()){var m=this.next();while(!this.EOF()){if(m.ishidden!="\u662f"){if(k!=null){for(var p=0,l=k.length;p<l;p++){var r=this.getColumn(m.id);var n=this.getAColSchema(k[p]);if(true||r==n.col){q=true;break}else{if(q){q=false}}}}if(q){break}}m=this.next()}if(m!=null){r=this.getColumn(m.id);this.curColumn=r;o=r.getWriteCellList(m,k)}}return o};TCRSTableIndex.prototype.get_sheet_sz=function(){var a=$("table").last();return parseInt($(a).attr("id").replace("sheet",""))+1};TCRSTableIndex.prototype.loadCodeItem=function(B){var G=crsReport.crsCommon.get_row_seq(B);var C=this.getAColSchema(crsReport.crsCommon.get_cid_by_td(B));var t=this.rows[C.row_idx].label+C.col.rows[C.col_idx].columnlabel;var F="y."+G+"."+t+".";if(this.listValues[F]==undefined){F="n."+G+"."+t+".";if(this.listValues[F]==undefined){G=0;F="y."+G+"."+t+".";if(this.listValues[F]==undefined){F="n."+G+"."+t+".";if(this.listValues[F]==undefined){F=""}}}}if(F!=""&&this.listValues[F]!=undefined){if(this.listValues[F].data_list.length>0&&this.listValues[F].data_list[0].substr(0,5)=="<col>"){if(crsReport.func_show_list_view!=null){crsReport.func_show_list_view(this.listValues[F].data_list,F.substr(0,2)=="n.")}if(F.substr(0,2)=="n."){return}}else{var z='<select onchange="javascript:crsReport.change_handler(this);" style="position: absolute;left:'+i_l+"; top:"+i_t+";width:"+i_w+";height:"+i_h+';" id="'+$(B).attr("cid")+'"><option></option>';for(var A=0,w=this.listValues[F].data_list.length;A<w;A++){var v=(this.listValues[F].data_list[A]==val)?"selected":"";if(A==0){if(F.substr(0,2)=="y."){z+="<option value='<\u8f93\u5165...>'><\u8f93\u5165...></option>"}}z+="<option value='"+this.listValues[F].data_list[A]+"' "+v+">"+this.listValues[F].data_list[A]+"</option>"}z+="</select>";return z}}if(C.datatype=="\u4ee3\u7801\u578b"){if(C.codeid=="-10"){return'<form name="form1"style="position: absolute;left:'+i_l+"; top:"+i_t+";height:"+i_h+";width:"+i_w+';" id="'+$(B).attr("cid")+'"><a href="javascript:;" class="orgAdd" onClick="SelectDept();">\u6dfb\u52a0</a>&nbsp;&nbsp;<a href="javascript:;" class="orgClear" onClick="ClearUser()">\u6e05\u7a7a</a>&nbsp;&nbsp;<a href="javascript:;" class="orgAdd" onClick="javascript:getName(this);">\u786e\u8ba4</a><input type="hidden" name="TO_ID" value=""><textarea style="height:'+i_h+";width:"+i_w+';" cols=20 name=TO_NAME rows=1 class="BigStatic" wrap="yes" readonly>'+val+"</textarea></form>"}else{if(C.codeid=="-11"){return'<form name="form1" style="position: absolute;left:'+i_l+"; top:"+i_t+";height:"+i_h+";width:"+i_w+';z-index:1;" id="'+$(B).attr("cid")+'"><a href="javascript:;" class="orgAdd" onClick="SelectUser(\'admin\',\'COPY_TO_ID\', \'COPY_TO_NAME\');">\u6dfb\u52a0</a>&nbsp;&nbsp;<a href="javascript:;" class="orgClear" onClick="ClearUser(\'COPY_TO_ID\', \'COPY_TO_NAME\')">\u6e05\u7a7a</a>&nbsp;&nbsp;<a href="javascript:;" class="orgAdd" onClick="javascript:getName(this);">\u786e\u8ba4</a><input type="hidden" name="COPY_TO_ID" value=""><textarea style="height:'+i_h+";width:"+i_w+';" cols=20 name="COPY_TO_NAME" rows=2 class="BigStatic" wrap="yes" readonly>'+val+"</textarea></form>"}else{if(parseInt(C.codeid)>0){var D=crsReport.crsCodeIndex.get_select(C.codeid,val);if(D==""){var f="";if(crsReport.crsCodeIndex.is_readonly(C.codeid)){f="readOnly"}return"<input "+f+' style="position: absolute;left:'+i_l+"; top:"+i_t+";height:"+i_h+";width:"+i_w+';" id="'+getColPlatKId($(B).attr("cid"))+'" name="" size="20" class="BigInput" value="'+val+'" onClick="javascript:crsReport.crsCodeIndex.get_tree('+C.codeid+", '"+val+"', 0, 1, 0, '', '"+getColPlatKId($(B).attr("cid"))+'\');" onchange="javascript:crsReport.change_handler(this);">'}else{return'<select style="position: absolute;left:'+i_l+"; top:"+i_t+";width:"+i_w+';" id="'+$(B).attr("cid")+'" onchange="javascript:crsReport.change_handler(this);">'+D+"</select>"}}else{if(C.codeid!=""){var u=HandleMemoStr(C.codeid,false).split("|");var E="";for(var s=0,x=u.length;s<x;s++){if(s==0&&u[0]!=""){E+="<option value=''></option><option value='<\u8f93\u5165...>'><\u8f93\u5165...></option>"}var f=HandleMemoStr(u[s],false);if(f==val){E+="<option value='"+f+"' selected>"+f+"</option>"}else{E+="<option value='"+f+"'>"+f+"</option>"}}return'<select style="position: absolute;left:'+i_l+"; top:"+i_t+";width:"+i_w+';" id="'+$(B).attr("cid")+'" onchange="javascript:crsReport.change_handler(this);">'+E+"</select>"}}}}}else{if(C.datatype=="\u65e5\u671f\u578b"){if(C.displaystyle=="yyyy\u5e74"){return'<input style="position: absolute;left:'+i_l+"; top:"+i_t+";height:"+i_h+";width:"+i_w+';" id="'+$(B).attr("cid")+'" name="" size="20" class="BigInput" value="'+val+'" onClick="WdatePicker({dateFmt:\'yyyy\'})" onchange="javascript:crsReport.change_handler(this);">'}else{if(C.displaystyle=="yyyy\u5e74mm\u6708"||C.displaystyle=="yyyy.mm"){var y=(C.displaystyle=="yyyy\u5e74mm\u6708")?"yyyy\u5e74MM\u6708":"yyyy.MM";return'<input style="position: absolute;left:'+i_l+"; top:"+i_t+";height:"+i_h+";width:"+i_w+';" id="'+$(B).attr("cid")+'" name="" size="20" class="BigInput" value="'+val+'" onClick="WdatePicker({dateFmt:\''+y+'\'})"onchange="javascript:crsReport.change_handler(this);">'}else{if(C.displaystyle.indexOf(":")!=-1){return'<input style="position: absolute;left:'+i_l+"; top:"+i_t+";height:"+i_h+";width:"+i_w+';" id="'+$(B).attr("cid")+'" name="" size="20" class="BigInput" value="'+val+'" onClick="WdatePicker({dateFmt:\'yyyy-MM-dd HH:mm:ss:ms\'})" onchange="javascript:crsReport.change_handler(this);">'}else{return'<input style="position: absolute;left:'+i_l+"; top:"+i_t+";height:"+i_h+";width:"+i_w+';" id="'+$(B).attr("cid")+'" name="" size="20" class="BigInput" value="'+val+'" onClick="WdatePicker({dateFmt:\'yyyy-MM-dd\'})"onchange="javascript:crsReport.change_handler(this);">'}}}}else{if(C.datatype=="\u5b57\u7b26\u578b"){return'<textarea style="position: absolute;left:'+i_l+"; top:"+i_t+";height:"+i_h+";width:"+i_w+';" id="'+B.cid+'"onchange="javascript:crsReport.change_handler(this);">'+val+"</textarea>"}else{if(C.datatype=="\u81ea\u589e\u578b"){}else{if(C.datatype=="\u903b\u8f91\u578b"){if($(B).attr("val")=="\u221a"){crsReport.crsCellControler.set_cell_value(B,"")}else{crsReport.crsCellControler.set_cell_value(B,"\u221a")}}else{if(C.datatype=="\u56fe\u7247\u578b"){if($(B).html()==""){return'<form name="form01" method="post" enctype= "multipart/form-data">\u8bf7\u9009\u62e9\u56fe\u7247<input style="position:absolute;margin-left:-220px;opacity:0;" type= "file" id="FILE1" accept="image/*" name="FILE1" onchange="javascript:crsReport.submit_picture(this);" /></form>'}}else{if(C.datatype=="\u9644\u4ef6\u578b"){if($(B).html()==""){return'<form name="form01" method="post" enctype= "multipart/form-data">\u8bf7\u9009\u62e9\u9644\u4ef6<input style="position:absolute;margin-left:-220px;opacity:0;" type= "file" id="FILE1" name="FILE1" onchange="javascript:crsReport.submit_attach(this);" /></form>'}}else{return'<input style="position: absolute;left:'+i_l+"; top:"+i_t+";height:"+i_h+";width:"+i_w+';" id="'+$(B).attr("cid")+'" name="" class="BigInput" value="'+val+'" onchange="javascript:crsReport.change_handler(this);">'}}}}}}}};TCRSTableIndex.prototype.get_col_kid_by_name=function(l,q){var n=l+"."+q;if(this.arr_col_name_to_kid!=null&&this.arr_col_name_to_kid[n]!=undefined){return this.arr_col_name_to_kid[n]}this.loadData("#tablecrs_tableindex");for(var p=0,m=this.rows.length;p<m;p++){if(this.rows[p].label==l){var o=this.getColumn(this.rows[p].id);o.loadData("#tablecrs_columnindex");for(var r=0,k=o.rows.length;r<k;r++){if(o.rows[r].columnlabel==q){if(this.arr_col_name_to_kid==null){this.arr_col_name_to_kid=[]}this.arr_col_name_to_kid[n]=o.rows[r].kid;return o.rows[r].kid}}break}}return""};TCRSTableIndex.prototype.get_col_kid_by_id=function(l,k){this.loadData("#tablecrs_tableindex");if(this.arr_col_id_to_kid!=null&&this.arr_col_id_to_kid[k]!=undefined){return this.arr_col_id_to_kid[k]}for(var o=0,m=this.rows.length;o<m;o++){if(this.rows[o].id==l){var n=this.getColumn(this.rows[o].id);n.loadData("#tablecrs_columnindex");for(var p=0,h=n.rows.length;p<h;p++){if(n.rows[p].id==k){if(this.arr_col_id_to_kid==null){this.arr_col_id_to_kid=[]}this.arr_col_id_to_kid[k]=n.rows[p].kid;return n.rows[p].kid}}break}}return""};TCRSTableIndex.prototype.get_col_id_by_col_kid=function(c){var d=this.getAColSchema(c);return d.id};TCRSTableIndex.prototype.get_tab_id_by_col_kid=function(c){var d=this.getAColSchema(c);return this.rows[d.row_idx].id};TCRSTableIndex.prototype.get_tab_id_by_name=function(d){var c=this.search("label",d);if(c!=null){return c.id}else{return -1}};TCRSTableIndex.prototype.get_cell_value=function(s,m,o,n){this.loadData("#tablecrs_tableindex");if(o==undefined){if(!this.isEmpty()){var k=this.first();while(!this.EOF()){var r=this.getColumn(k.id);r.loadData("#tablecrs_columnindex"+k.id);if(!r.isEmpty()){var p=r.first();while(!r.EOF()){if(s==p.kid){return r.get_raw_value(p.id,m)}p=r.next()}}k=this.next()}}}else{if(!n){s=this.get_tab_id_by_name(s)}var l=this.getColumn(s);var q=this.search("id",s);if(q.tabletype=="\u4ea4\u53c9\u8868"){}else{return l.get_cell_value(m,o,n,q,false)}}};TCRSTableIndex.prototype.get_cur_tab_name=function(d){this.loadData("#tablecrs_tableindex");var c=this.getColumn(d);return c.get_cur_tab_name()};TCRSTableIndex.prototype.get_tab_type_by_id=function(d){var c=this.search("id",d);if(c!=null){return c.tabletype}else{return""}};TCRSTableIndex.prototype.clear_values_on_list=function(d,f,e){if(this.listValues["y."+e+"."+d+f+"."]!=undefined){this.listValues["y."+e+"."+d+f+"."]=undefined}else{if(this.listValues["n."+e+"."+d+f+"."]!=undefined){this.listValues["n."+e+"."+d+f+"."]=undefined}}if(crsReport.b_as_form){}};TCRSTableIndex.prototype.clear_data_item=function(o){if(o==null||o.length<=0){return}var p=0,r=o.length/3;while(p<r){var k=o[p*3];if(k!=""){var n=this.search("label",k);if(n!=null){var l=this.getColumn(n.id);var q=p;var m=[];while(q<r){if(o[q*3]==k){m.push(o[q*3+1]);m.push(o[q*3+2]);o[q*3]=""}q++}l.clear_data_item(n,m)}}p++}};TCRSTableIndex.prototype.create_cur_table_data=function(b){return this.save_data(true,true,false,false,b)};TCRSTableIndex.prototype.reset_cell_color=function(m){if(m==null||m.length<=0){return}var p=0,r=m.length/3;while(p<r){var k=m[p*3];if(k!=""){var n=this.search("id",k);if(n!=null){var l=this.getColumn(n.id);var q=p;var o=[];while(q<r){if(m[q*3]==k){o.push(m[q*3+1]);o.push(m[q*3+2]);m[q*3]=""}q++}l.reset_cell_color(n,o)}}p++}};TCRSTableIndex.prototype.update_cell_refer=function(l,o,r,k,m){var p=this.cursor;if(!this.isEmpty()){var n=this.first();while(!this.EOF()){if(n.sheetindex==l){var q=this.getColumn(n.id);if(q!=null){q.update_cell_refer(r,m?"insert":"delete",k,o)}}n=this.next()}}this.cursor=p};TCRSTableIndex.prototype.get_first_data_item=function(){if(this.curColumn!=null){return this.curColumn.get_first_data_item()}return null};TCRSTableIndex.prototype.get_next_data_item=function(){if(this.curColumn!=null){return this.curColumn.get_next_data_item()}return null};TCRSTableIndex.prototype.save_data=function(aw,au,al,aa,am){var at="";var X=[];if(!aa&&!am&&(this.obj_new_row_kid!=null||this.obj_loaded_row_kid!=null)){if(!au){if(this.obj_loaded_row_kid!=null){for(s_key in this.obj_loaded_row_kid){this.obj_loaded_row_kid[s_key].init()}}if(this.obj_new_row_kid!=null){for(s_key in this.obj_new_row_kid){this.obj_new_row_kid[s_key].init()}}}var av=crsReport.get_valid_cur_task();var M=this;if(!au){var R=[]}if(crsReport.b_as_form){if(!crsReport.crsTableIndex.isEmpty()){var ak=crsReport.crsTableIndex.first();while(!crsReport.crsTableIndex.EOF()){var U=true;var aq,ar,T;if(ak.tabletype=="\u4e3b\u8868"){aq="main_tab_"+ak.id;ar="rid";T="cid"}else{aq="detail_tab_"+ak.id;if(crsReport.b_mobile){ar="rid";T="cid"}else{ar="id";T="aria-describedby"}}var ag=parseInt(ak.sheetindex)-1,aj=1,af="";if(crsReport.b_mobile){var V="#page1 #"+aq+">div["+ar+"]>div["+T+"]"}else{var V="table[id^='"+aq+"'] tbody tr["+ar+"] td["+T+"]"}$(V).each(function(){if(U){U=false}if(crsReport.b_mobile){var b=$(this).parent("div").attr(ar)}else{var b=$(this).parent("tr").attr(ar)}if(ak.tabletype=="\u660e\u7ec6\u8868"){if(af!=""&&af!=b){aj++}if(af!=b){af=b}}var g=$(this).attr(T);if(g.charAt(0)!="{"){var c=g.indexOf("{");if(c==-1){return true}g=g.substr(c)}if(b.charAt(0)!="{"||g.charAt(0)!="{"){return true}var n=M.getAColSchema(g),a="";var l=n.col.rows[n.col_idx];var h=n.get_cell_point(aj);if(!am){a=$(this).attr("val");if(a==undefined){if(n.datatype=="\u903b\u8f91\u578b"){if($(this).children().eq(0)[0].checked){a="on"}else{a=""}}else{a=$(this).children().eq(0).val()}if(a==undefined){a=""}}if(a==""){a=$(this).attr("val2")}if(a==undefined){a=""}if(n.datatype=="\u624b\u5199\u7b7e\u7ae0"){var e=$.md5(getColPlatKId(b+g));a=crsReport.DWebSignSeal.GetStoreDataEx(e+"_hw;"+e+"_seal")}if(a==""){if(n.datatype=="\u56fe\u7247\u578b"){}else{if(n.datatype=="\u81ea\u52a8\u7f16\u53f7"&&crsReport.openMode=="write"){if(!au){a=crsReport.crsAutoCode.get_next_autocode(l.codeid,false);if(a!=""){crsReport.crsCommon.set_cell_value(ag,h.x,h.y,a)}}}else{if(n.datatype=="\u65e5\u671f\u578b"){}}}}else{if(n.datatype=="\u65e5\u671f\u578b"){if(n.displaystyle=="yyyy\u5e74"){a+="-01-01"}else{if(n.displaystyle=="yyyy\u5e74mm\u6708"||n.displaystyle=="yyyy.mm"){a+="-01"}}}else{if(n.datatype=="\u4ee3\u7801\u578b"){if(n.codeid=="-10"||n.codeid=="-11"){if($(this).children(":eq(1)").length>0){if(crsReport.b_mobile){a=$(this).children(":eq(1)").html()}else{a=$(this).children(":eq(1)").val()}if(a!=""&&a.charAt(a.length-1)==","){a=a.substr(0,a.length-1)}}else{if($(this).children().length<=1){if(a!=""&&a.charAt(a.length-1)==","){a=a.substr(0,a.length-1)}if(n.codeid=="-10"){a=crsReport.crsDeptCache.get_name_by_id(a)}else{a=crsReport.crsUserCache.get_name_by_id(a)}}else{if(a!=""&&a.charAt(a.length-1)==","){a=a.substr(0,a.length-1)}}}}else{a=crsReport.crsCodeIndex.get_value_by_display_text(n.codeid,a)}}else{if(n.datatype=="\u5b57\u7b26\u578b"){if(n.displaystyle=="\u53bb\u7a7a\u683c\u53ca\u6362\u884c"){a=a.trim()}}else{if(n.datatype=="\u56fe\u7247\u578b"){if(aw){var f=crsReport.arr_upload_files.indexOf(a);X.push(f)}a+=" "+ag+" "+Math.floor($(this).offset().left)+" "+Math.floor($(this).offset().top)+" "+Math.floor($(this).offset().left+$(this).width()-1)+" "+Math.floor($(this).offset().top+$(this).height()-1)+" "+h.x+" "+h.y}else{if(n.datatype=="\u9644\u4ef6\u578b"){a="{"+getColPlatKId(b+g)+"}_"+a;if(aw){var f=crsReport.arr_upload_files.indexOf(a);X.push(f)}}else{if(n.datatype=="\u903b\u8f91\u578b"){if(a=="on"){a="\u221a"}}}}}}}}}else{if(M.obj_loaded_row_kid==null||M.obj_loaded_row_kid[getColPlatKId(b)]==undefined){return true}a=$(this).attr("pval");if(a==undefined){a=""}}if(au){if(a==""){if(n.datatype=="\u6570\u503c\u578b"||n.datatype=="\u8d27\u5e01\u578b"){a="null"}}n.col.obj_data_cache.add_cur_col_val(n.get_display_seq(h.x,h.y),g,a)}else{if(a!=""){var d=n.check_value(a);if(d!=""){if(at.indexOf(d)==-1){at+=d+"\n"}}}else{if(n.datatype=="\u6570\u503c\u578b"||n.datatype=="\u8d27\u5e01\u578b"){a="null"}}var m=null;if(M.obj_new_row_kid!=null){m=M.obj_new_row_kid[getColPlatKId(b)];if(m==undefined){m=null}}if(m==null){if(M.obj_loaded_row_kid!=null){m=M.obj_loaded_row_kid[getColPlatKId(b)];if(m==undefined){m=null}if(a!=$(this).attr("pval")&&(crsReport.writeColList==null||crsReport.writeColList.indexOf(g)!=-1)){m.update_col_value("col"+n.id,a)}}}m.add_col_value("col"+n.id,a,n.datatype=="\u81ea\u589e\u578b");if(crsReport.crsTableIndex.rows[n.row_idx].tabletype=="\u660e\u7ec6\u8868"){m.calc_display_seq(l.cellspan,crsReport.crsTableIndex.rows[n.row_idx].expandtype,h.x,h.y)}if(!au&&a!=$(this).attr("pval")){R.push(ag);R.push(h.x);R.push(h.y);R.push(a)}}});if(crsReport.crsTableIndex.arr_hidden_rows!=null){if(U){if(crsReport.crsTableIndex.arr_hidden_rows[ak.id]!=undefined){var ah=0;for(s_rid in crsReport.crsTableIndex.arr_hidden_rows[ak.id]["dat"]){if(typeof crsReport.crsTableIndex.arr_hidden_rows[ak.id]["dat"][s_rid]=="function"){break}ah++;var K=null;if(M.obj_new_row_kid!=null){K=M.obj_new_row_kid[getColPlatKId(s_rid)];if(K==undefined){K=null}}if(K==null){if(M.obj_loaded_row_kid!=null){K=M.obj_loaded_row_kid[getColPlatKId(s_rid)];if(K==undefined){K=null}var k=0;for(s_cid in crsReport.crsTableIndex.arr_hidden_rows[ak.id]["dat"][s_rid]){if(typeof crsReport.crsTableIndex.arr_hidden_rows[ak.id]["dat"][s_rid][s_cid]=="function"){break}var L=crsReport.crsTableIndex.getAColSchema(s_cid);if(au){L.col.obj_data_cache.add_cur_col_val(ah,s_cid,crsReport.crsTableIndex.arr_hidden_rows[ak.id]["dat"][s_rid][s_cid]["val"])}else{if(crsReport.crsTableIndex.arr_hidden_rows[ak.id]["dat"][s_rid][s_cid]["val"]!=crsReport.crsTableIndex.arr_hidden_rows[ak.id]["dat"][s_rid][s_cid]["pval"]){K.update_col_value("col"+L.id,crsReport.crsTableIndex.arr_hidden_rows[ak.id]["dat"][s_rid][s_cid]["val"])}}k++}}}else{var k=0;for(s_cid in crsReport.crsTableIndex.arr_hidden_rows[ak.id]["dat"][s_rid]){if(typeof crsReport.crsTableIndex.arr_hidden_rows[ak.id]["dat"][s_rid][s_cid]=="function"){break}var L=crsReport.crsTableIndex.getAColSchema(s_cid);if(au){L.col.obj_data_cache.add_cur_col_val(ah,s_cid,crsReport.crsTableIndex.arr_hidden_rows[ak.id]["dat"][s_rid][s_cid]["val"])}else{K.add_col_value("col"+L.id,crsReport.crsTableIndex.arr_hidden_rows[ak.id]["dat"][s_rid][s_cid]["val"],L.datatype=="\u81ea\u589e\u578b")}k++}}K.calc_display_seq(ah)}}}else{if(crsReport.crsTableIndex.arr_hidden_rows[ak.id]!=undefined){for(s_rid in crsReport.crsTableIndex.arr_hidden_rows[ak.id]["dat"]){if(typeof crsReport.crsTableIndex.arr_hidden_rows[ak.id]["dat"][s_rid]=="function"){break}var K=null;if(M.obj_new_row_kid!=null){K=M.obj_new_row_kid[getColPlatKId(s_rid)];if(K==undefined){K=null}}if(K==null){if(M.obj_loaded_row_kid!=null){K=M.obj_loaded_row_kid[getColPlatKId(s_rid)];if(K==undefined){K=null}var k=0;for(s_cid in crsReport.crsTableIndex.arr_hidden_rows[ak.id]["dat"][s_rid]){if(typeof crsReport.crsTableIndex.arr_hidden_rows[ak.id]["dat"][s_rid][s_cid]=="function"){break}var L=crsReport.crsTableIndex.getAColSchema(s_cid);if(au){L.col.obj_data_cache.add_cur_col_val(ah,s_cid,crsReport.crsTableIndex.arr_hidden_rows[ak.id]["dat"][s_rid][s_cid]["val"])}else{if(crsReport.crsTableIndex.arr_hidden_rows[ak.id]["dat"][s_rid][s_cid]["val"]!=crsReport.crsTableIndex.arr_hidden_rows[ak.id]["dat"][s_rid][s_cid]["pval"]){K.update_col_value("col"+L.id,crsReport.crsTableIndex.arr_hidden_rows[ak.id]["dat"][s_rid][s_cid]["val"])}}k++}}}else{var k=0;for(s_cid in crsReport.crsTableIndex.arr_hidden_rows[ak.id]["dat"][s_rid]){if(typeof crsReport.crsTableIndex.arr_hidden_rows[ak.id]["dat"][s_rid][s_cid]=="function"){break}var L=crsReport.crsTableIndex.getAColSchema(s_cid);if(au){L.col.obj_data_cache.add_cur_col_val(ah,s_cid,crsReport.crsTableIndex.arr_hidden_rows[ak.id]["dat"][s_rid][s_cid]["val"])}else{K.add_col_value("col"+L.id,crsReport.crsTableIndex.arr_hidden_rows[ak.id]["dat"][s_rid][s_cid]["val"],L.datatype=="\u81ea\u589e\u578b")}k++}}}}}}ak=crsReport.crsTableIndex.next()}}}else{$("table[id^='sheet'] td").each(function(){if($(this).attr("cid")!=undefined&&($(this).attr("rid")!=undefined||$(this).parent("tr").attr("rid")!=undefined)){var g=crsReport.crsCommon.crsTable.crsCellControler.get_sheet_index_by_cell($(this));var h=crsReport.crsCommon.crsTable.crsCellControler.get_cell_point($(this));var a=M.getAColSchema($(this).attr("cid")),b="",c="";c=$(this).parent("tr").attr("rid");if(c==undefined){c=$(this).attr("rid")}var l=a.col.rows[a.col_idx];if(!am){b=$(this).attr("val");if(b==undefined){b=""}if(b==""){b=$(this).attr("val2")}if(b==undefined){b=""}if(a.datatype=="\u624b\u5199\u7b7e\u7ae0"){var e=$.md5(getColPlatKId(c+a.kid));b=crsReport.DWebSignSeal.GetStoreDataEx(e+"_hw;"+e+"_seal")}if(b==""){if(a.datatype=="\u56fe\u7247\u578b"){}else{if(a.datatype=="\u81ea\u52a8\u7f16\u53f7"&&crsReport.openMode=="write"){if(!au){b=crsReport.crsAutoCode.get_next_autocode(l.codeid,false);if(b!=""){crsReport.crsCommon.set_cell_value(g,h.x,h.y,b)}}}else{if(a.datatype=="\u65e5\u671f\u578b"){}}}}else{if(a.datatype=="\u65e5\u671f\u578b"){if(a.displaystyle=="yyyy\u5e74"){b+="-01-01"}else{if(a.displaystyle=="yyyy\u5e74mm\u6708"||a.displaystyle=="yyyy.mm"){b+="-01"}}if(b!=""){b=b.replace(".","-")}}else{if(a.datatype=="\u4ee3\u7801\u578b"){if(a.codeid=="-10"){if($(this).children(":eq(1)").length>0){b=$(this).children(":eq(1)").val();if(b!=""&&b.charAt(b.length-1)==","){b=b.substr(0,b.length-1)}}else{if($(this).children().length<=1){if(b!=""&&b.charAt(b.length-1)==","){b=b.substr(0,b.length-1)}b=crsReport.crsDeptCache.get_name_by_id(b)}else{if(b!=""&&b.charAt(b.length-1)==","){b=b.substr(0,b.length-1)}}}}else{if(a.codeid=="-11"){if($(this).children(":eq(1)").length>0){b=$(this).children(":eq(1)").val();if(b!=""&&b.charAt(b.length-1)==","){b=b.substr(0,b.length-1)}}else{if($(this).children().length<=1){if(b!=""&&b.charAt(b.length-1)==","){b=b.substr(0,b.length-1)}b=crsReport.crsUserCache.get_name_by_id(b)}else{if(b!=""&&b.charAt(b.length-1)==","){b=b.substr(0,b.length-1)}}}}else{b=crsReport.crsCodeIndex.get_value_by_display_text(a.codeid,b)}}}else{if(a.datatype=="\u5b57\u7b26\u578b"){if(a.displaystyle=="\u53bb\u7a7a\u683c\u53ca\u6362\u884c"){b=b.trim()}}else{if(a.datatype=="\u56fe\u7247\u578b"){if(aw){var f=crsReport.arr_upload_files.indexOf(b);X.push(f)}b+=" "+g+" "+Math.floor($(this).offset().left)+" "+Math.floor($(this).offset().top)+" "+Math.floor($(this).offset().left+$(this).width()-1)+" "+Math.floor($(this).offset().top+$(this).height()-1)+" "+h.x+" "+h.y}else{if(a.datatype=="\u9644\u4ef6\u578b"){b="{"+getColPlatKId(c+a.kid)+"}_"+b;if(aw){var f=crsReport.arr_upload_files.indexOf(b);X.push(f)}}else{if(a.datatype=="\u903b\u8f91\u578b"){if(b=="on"){b="\u221a"}}}}}}}}}else{if(M.obj_loaded_row_kid==null||M.obj_loaded_row_kid[getColPlatKId(c)]==undefined){return true}b=$(this).attr("pval");if(b==undefined){b=""}}if(au){if(b==""){if(a.datatype=="\u6570\u503c\u578b"||a.datatype=="\u8d27\u5e01\u578b"){b="null"}}a.col.obj_data_cache.add_cur_col_val(a.get_display_seq(h.x,h.y),$(this).attr("cid"),b)}else{if(b!=""){var d=a.check_value(b);if(d!=""){if(at.indexOf(d)==-1){at+=d+"\n"}}}else{if(a.datatype=="\u6570\u503c\u578b"||a.datatype=="\u8d27\u5e01\u578b"){b="null"}}var m=null;if(M.obj_new_row_kid!=null){m=M.obj_new_row_kid[getColPlatKId(c)];if(m==undefined){m=null}}if(m==null){if(M.obj_loaded_row_kid!=null){m=M.obj_loaded_row_kid[getColPlatKId(c)];if(m==undefined){m=null}if(b!=$(this).attr("pval")&&(crsReport.writeColList==null||crsReport.writeColList.indexOf($(this).attr("cid"))!=-1)){m.update_col_value("col"+a.id,b)}}}m.add_col_value("col"+a.id,b,a.datatype=="\u81ea\u589e\u578b");if(crsReport.crsTableIndex.rows[a.row_idx].tabletype=="\u660e\u7ec6\u8868"){m.calc_display_seq(l.cellspan,crsReport.crsTableIndex.rows[a.row_idx].expandtype,h.x,h.y)}if(!au&&b!=$(this).attr("pval")){R.push(g);R.push(h.x);R.push(h.y);R.push(b)}}}})}if(!au){if(this.arr_tab_property==null){this.arr_tab_property=new Array(this.rows.length);for(var S=0,P=this.rows.length;S<P;S++){this.arr_tab_property[S]=new TCRSTableProperty()}for(S in this.colSchemas){var ae=this.colSchemas[S].col.rows[this.colSchemas[S].col_idx];if(ae.iskey=="\u662f"){if(crsReport.writeColList==null||crsReport.writeColList.indexOf(ae.kid)!=-1||crsReport.readColList==null||crsReport.readColList.indexOf(ae.kid)!=-1){this.arr_tab_property[this.colSchemas[S].row_idx].add_key_col(ae)}}if(ae.ismust=="\u662f"||ae.ismust=="\u6240\u6709\u4efb\u52a1"||av!=""&&ae.ismust==av){if(crsReport.writeColList==null||crsReport.writeColList.indexOf(ae.kid)!=-1){this.arr_tab_property[this.colSchemas[S].row_idx].add_must_col(ae)}}if(ae.isonly=="\u662f"){if(crsReport.writeColList==null||crsReport.writeColList.indexOf(ae.kid)!=-1||crsReport.readColList==null||crsReport.readColList.indexOf(ae.kid)!=-1){this.arr_tab_property[this.colSchemas[S].row_idx].add_only_col(ae)}}}}for(var S=0,P=this.arr_tab_property.length;S<P;S++){this.arr_tab_property[S].init()}if(this.obj_loaded_row_kid!=null){for(S in this.obj_loaded_row_kid){if(this.obj_deleted_row_kid==null||this.obj_deleted_row_kid[S]==undefined){var ai=this.obj_loaded_row_kid[S];this.arr_tab_property[ai.obj_col_schema.row_idx].add_row(ai)}}}if(this.obj_new_row_kid!=null){for(S in this.obj_new_row_kid){var ai=this.obj_new_row_kid[S];this.arr_tab_property[ai.obj_col_schema.row_idx].add_row(ai)}}for(var S=0,P=this.arr_tab_property.length;S<P;S++){if(!this.arr_tab_property[S].do_check(S)){if(at!=""){at+="<br>"}at+=this.arr_tab_property[S].s_err_info}}crsReport.crsFormulasCache.execute_formulas(av,"",0,"",0,"",true,false,false);if(crsReport.crsFormulasCache.s_info!=""){if(at!=""){at+="<br>"}at+=crsReport.crsFormulasCache.s_info;crsReport.crsFormulasCache.s_info=""}if(at!=""){if(aw){aw=false}}}}if(aw){var N="";if(au){for(var S=0,P=crsReport.crsTableIndex.columns.length;S<P;S++){var ap=crsReport.crsTableIndex.columns[S].column;if(!ap.b_do_create_cur_table){ap.b_do_create_cur_table=true}N+="drop TABLE IF EXISTS "+ap.obj_data_cache.s_cur_tab_name+";";crsReport.crsFormulasCache.s_temp_table_list+=ap.obj_data_cache.s_cur_tab_name+",";N+=ap.obj_data_cache.s_cdef_column_list;if(am){if(ap.obj_data_cache.rows!=null){var Q="";for(var ab=0,an=ap.obj_data_cache.rows.length;ab<an;ab++){if(ap.obj_data_cache.rows[ab][0]==""){continue}for(var Y=0,ao=ap.obj_data_cache.rows[ab].length;Y<ao;Y++){if(Y==0){Q="'"+HandleMemoStr(ap.obj_data_cache.rows[ab][Y],false).replaceAll("'","#005C`'").replaceAll(";",CRSSep)+"'"}else{if(ap.obj_data_cache.rows[ab][Y]=="null"){Q+=",null"}else{Q+=",'"+HandleMemoStr(ap.obj_data_cache.rows[ab][Y],false).replaceAll("'","#005C`'").replaceAll(";",CRSSep)+"'"}}}N+="insert into "+ap.obj_data_cache.s_cur_tab_name+" values("+Q+");"}}}else{var O="'','','','"+crsReport.userId+"','"+crsReport.writeTime+"','','unchecked','n','n','"+crsReport.refKID+"'",ac="";for(Y in ap.obj_data_cache.obj_cur_rows){for(var Z=1,an=ap.obj_data_cache.obj_cur_rows[Y].length;Z<an;Z++){if(Z==1){ac=O+","+Y.replace("d","")}if(ap.obj_data_cache.obj_cur_rows[Y][Z]=="null"){ac+=",null"}else{ac+=",'"+ap.obj_data_cache.obj_cur_rows[Y][Z].replaceAll("'","#005C`'").replaceAll(";",CRSSep)+"'"}}N+="insert into "+ap.obj_data_cache.s_cur_tab_name+"("+ap.obj_data_cache.columnList.replaceAll(";",",")+")values("+ac+");"}ap.obj_data_cache.end_add_cur_col_val()}}}else{if(this.obj_deleted_row_kid!=null){for(S in this.obj_deleted_row_kid){if(this.obj_loaded_row_kid!=null&&this.obj_loaded_row_kid[S]!=undefined){N+="delete from crscell.crs_tabledata"+this.rows[this.obj_loaded_row_kid[S].obj_col_schema.row_idx].id+" where kid='"+getColRealKId(S)+"';"}}}if(this.obj_loaded_row_kid!=null){for(S in this.obj_loaded_row_kid){if(this.obj_deleted_row_kid==null||this.obj_deleted_row_kid[S]==undefined){this.obj_loaded_row_kid[S].set_write_info(crsReport.organId,crsReport.userId,crsReport.writeTime,crsReport.s_title,crsReport.s_memo);if(this.obj_loaded_row_kid[S].s_val!=""){N+="update crscell.crs_tabledata"+this.rows[this.obj_loaded_row_kid[S].obj_col_schema.row_idx].id+" set "+this.obj_loaded_row_kid[S].s_val+" where kid='"+getColRealKId(S)+"';"}}else{this.obj_loaded_row_kid[S]=undefined;delete this.obj_loaded_row_kid[S]}}}if(this.obj_new_row_kid!=null){var ad="kid, organid, userid, writetime, uploadtime, logiccheck, isfrozen, ismerge, rkid, displayseq, title, memo, ";for(S in this.obj_new_row_kid){var ai=this.obj_new_row_kid[S];ai.set_write_info(crsReport.organId,crsReport.userId,crsReport.writeTime,crsReport.s_title,crsReport.s_memo);if(ai.arr_val_list!=null&&(ai.i_display_seq==1&&crsReport.openMode=="write"||!ai.is_blank())){N+="insert into crscell.crs_tabledata"+this.rows[ai.obj_col_schema.row_idx].id+"("+ad+ai.arr_col_list.toString()+")values('"+getColRealKId(S)+"','"+crsReport.organId+"','"+crsReport.userId+"','"+crsReport.writeTime+"','0000-00-00 00:00:00', 'unchecked', 'n', 'n', '"+crsReport.refKID+"','"+ai.i_display_seq+"','"+crsReport.s_title+"','"+crsReport.s_memo+"',"+ai.get_delimited_text().replaceAll("'null'","null")+");";this.update_row_kid(S,ai);this.obj_new_row_kid[S]=undefined;delete this.obj_new_row_kid[S]}}var S=-1;for(S in this.obj_new_row_kid){break}if(S==-1){this.obj_new_row_kid=null}}if(this.obj_deleted_row_kid!=null){this.obj_deleted_row_kid=null}}if(N!=""){if(au){return N}crsReport.crsDataSet.execUpdate(N);for(var k=0,W=X.length;k<W;k++){crsReport.arr_upload_files[X[k]]=""}if(!au&&R!=null){for(var S=0,P=R.length/4;S<P;S++){crsReport.crsCommon.set_cell_pvalue(R[S*4],R[S*4+1],R[S*4+2],R[S*4+3])}}if(!au&&crsReport.crsTableIndex.arr_hidden_rows!=null){for(k in crsReport.crsTableIndex.arr_hidden_rows){if(typeof crsReport.crsTableIndex.arr_hidden_rows[k]=="function"){break}if(crsReport.crsTableIndex.arr_hidden_rows[k]!=undefined){for(s_rid in crsReport.crsTableIndex.arr_hidden_rows[k]["dat"]){if(typeof crsReport.crsTableIndex.arr_hidden_rows[k]["dat"][s_rid]=="function"){break}for(s_cid in crsReport.crsTableIndex.arr_hidden_rows[k]["dat"][s_rid]){if(typeof crsReport.crsTableIndex.arr_hidden_rows[k]["dat"][s_rid][s_cid]=="function"){break}if(crsReport.crsTableIndex.arr_hidden_rows[k]["dat"][s_rid][s_cid]["val"]!=crsReport.crsTableIndex.arr_hidden_rows[k]["dat"][s_rid][s_cid]["pval"]){crsReport.crsTableIndex.arr_hidden_rows[k]["dat"][s_rid][s_cid]["pval"]=crsReport.crsTableIndex.arr_hidden_rows[k]["dat"][s_rid][s_cid]["val"]}}}}}}}if(!au&&!am){if(crsReport.b_submit){crsReport.show_hint("\u63d0\u4ea4\u6210\u529f\uff01")}else{crsReport.show_hint("\u4fdd\u5b58\u6210\u529f\uff01")}crsReport.b_saved=true}}if(at!=""){crsReport.show_hint(at)}return at==""};TCRSTableIndex.prototype.can_append=function(k,l){var g={};g.b_can_append=false;if($(k).attr("cid")!=undefined){var h=this.getAColSchema($(k).attr("cid"));if(h==null){return g}if(crsReport.writeColList!=null){var m=false;if(!h.col.isEmpty()){var n=h.col.first();while(!h.col.EOF()){if(crsReport.writeColList.indexOf(n.kid)!=-1){m=true;break}n=h.col.next()}}if(!m){return g}}g.expandtype=this.rows[h.row_idx].expandtype;if(g.expandtype=="\u6309\u884c\u5411\u4e0b"||g.expandtype=="\u6309\u5217\u5411\u53f3"){g.b_can_append=true;h.col.get_noclear_and_defaultval_column_list(g)}g.def_rect=h.col.getColumnDefRect("");g.initcz=this.rows[h.row_idx].initcz;if(g.b_can_append&&l){this.rows[h.row_idx].initcz++}}return g};TCRSTableIndex.prototype.can_delete=function(l,n,p){var h={};h.b_can_delete=false;if($(l).attr("cid")!=undefined){var k=this.getAColSchema($(l).attr("cid"));if(k==null){return h}if(crsReport.writeColList!=null&&!p){var m=false;if(!k.col.isEmpty()){var o=k.col.first();while(!k.col.EOF()){if(crsReport.writeColList.indexOf(o.kid)!=-1){m=true;break}o=k.col.next()}}if(!m){return h}}h.expandtype=this.rows[k.row_idx].expandtype;if(h.expandtype=="\u6309\u884c\u5411\u4e0b"||h.expandtype=="\u6309\u5217\u5411\u53f3"){h.b_can_delete=true}h.def_rect=k.col.getColumnDefRect("");if(this.rows[k.row_idx].initcz<=1){h.b_all=true}else{if(h.b_can_delete&&n){this.rows[k.row_idx].initcz--}}}return h};TCRSTableIndex.prototype.auto_increment=function(c){if(c!=""){var d=this.getAColSchema(c);if(d!=null){if(this.rows[d.row_idx].tabletype=="\u660e\u7ec6\u8868"){d.col.auto_increment(this.rows[d.row_idx].sheetindex-1,this.rows[d.row_idx].expandtype)}}}};TCRSTableIndex.prototype.create_row_kid=function(f){var d=getGuidGenerator();var e=new TCRSRowProperty(this.getAColSchema(f).col,0,crsReport.organId,crsReport.userId,crsReport.writeTime,crsReport.s_title,crsReport.s_memo);if(this.obj_new_row_kid==null){this.obj_new_row_kid={}}this.obj_new_row_kid[getColPlatKId(d)]=e;return d};TCRSTableIndex.prototype.update_row_kid=function(d,c){d=getColPlatKId(d);if(this.obj_loaded_row_kid==null){this.obj_loaded_row_kid={}}this.obj_loaded_row_kid[d]=c};TCRSTableIndex.prototype.delete_row_kid=function(b){if(this.obj_deleted_row_kid==null){this.obj_deleted_row_kid={}}b=getColPlatKId(b);if(this.obj_new_row_kid==null||this.obj_new_row_kid[b]==undefined){this.obj_deleted_row_kid[b]=null}else{if(this.obj_new_row_kid!=null){if(this.obj_new_row_kid[b]!=undefined){this.obj_new_row_kid[b]=null;delete this.obj_new_row_kid[b]}this.obj_deleted_row_kid[b]=null}}};TCRSTableIndex.prototype.get_autocode_list=function(h){var e=null;if(this.colSchemas!=null){for(s_k in this.colSchemas){var g=this.colSchemas[s_k].col.rows[this.colSchemas[s_k].col_idx];if(g.datatype=="\u81ea\u52a8\u7f16\u53f7"&&g.ishidden!="\u662f"&&(crsReport.writeColList==null||crsReport.writeColList.indexOf(g.kid)!=-1)){if(g.codeid!=""){var f=crsReport.crsAutoCode.get_next_autocode(g.codeid,h);if(f!=""){if(e==null){e=[]}e.push(this.rows[this.colSchemas[s_k].row_idx].sheetindex-1);e.push(g.cellspan);e.push(f)}}}}return e}};TCRSTableIndex.prototype.get_ref_report=function(s,t){if(t==undefined){if(crsReport.b_as_form){t=crsReport.crsCommon.crsForm._get_row_seq($(s).parent("tr"))-1;s=crsReport.crsCommon.crsForm._get_cid_by_td(s)}else{var q=crsReport.crsCommon.crsTable.crsCellControler.get_cell_point(s);s=$(s).attr("cid")}}var v=this.getAColSchema(s);if(t==undefined){t=v.get_display_seq(q.x,q.y)-1}var o=null;if(v!=null){if(v.col.rows[v.col_idx].refrepid!=""&&v.col.rows[v.col_idx].refrepid!="0"){if(!crsReport.b_is_query){var A=crsReport.crsTableIndex.create_cur_table_data(false);var p=crsReport.crsDataSet.open_hyperlink(s,t+1,crsReport.s_postfix,A);if(p!=""){var w=window.open(window.parent.location.pathname+"?"+p,"awin"+v.col.rows[v.col_idx].refrepid,"menubar=0,toolbar=0,scrollbars=no,status=1,resizable=1,left=0,top=0,width="+screen.availWidth+",height="+screen.availHeight);if(window.external&&typeof window.external.OA_SMS!="undefined"){}else{w.moveTo(0,0);w.resizeTo(screen.availWidth,screen.availHeight);w.focus()}}return o}var A=crsReport.crsTableIndex.create_cur_table_data(false);var p=crsReport.crsDataSet.open_hyperlink(s,t+1,crsReport.s_postfix,A);if(p!=""&&p.indexOf("openmode=read")!=-1){var w=window.open(window.parent.location.pathname+"?"+p,"awin"+v.col.rows[v.col_idx].refrepid,"menubar=0,toolbar=0,scrollbars=no,status=1,resizable=1,left=0,top=0,width="+screen.availWidth+",height="+screen.availHeight);if(window.external&&typeof window.external.OA_SMS!="undefined"){}else{w.moveTo(0,0);w.resizeTo(screen.availWidth,screen.availHeight);w.focus()}return o}o={rep:HandleMemoStr(v.col.rows[v.col_idx].refrepid,false),para:""};if(v.col.rows[v.col_idx].refrepcond!=""){o.para=HandleMemoStr(v.col.rows[v.col_idx].refrepcond,false);var B=o.para.indexOf("\u672c\u62a5\u8868.");while(B!=-1){B=o.para.indexOf("{",B);var r=o.para.indexOf("}",B);var x=o.para.substring(B,r+1);v=this.getAColSchema(x);var u=rectNameToIndex(v.col.rows[v.col_idx].cellspan);var y=this.rows[v.row_idx];if(y.tabletype=="\u660e\u7ec6\u8868"&&t>0){u[0].y+=(u[1].y-u[0].y+1)*t}var z=crsReport.crsCommon.get_cell_value(0,u[0].x,u[0].y);if(v.datatype=="\u65e5\u671f\u578b"){if(z!=""){z=z.replace(".","-");if(v.displaystyle=="yyyy\u5e74"){z+="-00-00"}else{if(v.displaystyle=="yyyy\u5e74mm\u6708"||v.displaystyle=="yyyy.mm"){z+="-00"}}}}o.para=o.para.replaceAll("\u672c\u62a5\u8868."+x,z).replaceAll('"',"");B=o.para.indexOf("\u672c\u62a5\u8868.")}}}}return o};TCRSTableIndex.prototype.is_invalid=function(d,e){var f=false;return f};TCRSTableIndex.prototype.free=function(){var b="";return this.crsDataSet.free_me(b)};TCRSTableIndex.prototype.clear_data_item_id=function(){if(this.obj_loaded_row_kid!=null){for(s_key in this.obj_loaded_row_kid){this.obj_loaded_row_kid[s_key]=null}this.obj_loaded_row_kid=null}};TCRSTableIndex.prototype.get_auto_code=function(){var f="";if(!this.isEmpty()){var h=this.first();while(!this.EOF()){if(h.tabletype=="\u4e3b\u8868"){var g=this.getColumn(h.id);if(g!=null){if(!g.isEmpty()){var l=g.first();while(!g.EOF()){if(l.datatype=="\u81ea\u52a8\u7f16\u53f7"||l.iskey=="\u662f"||l.isonly=="\u662f"){var k=g.get_cell_value(l.id,1,true,h,true);if(k!=""&&f.indexOf(k)==-1){if(f!=""){f+="/"}f+=k}}l=g.next()}}}}h=this.next()}}if(f==""){f=crsReport.s_title}return f};TCRSTableIndex.prototype.set_hidden_cell_value=function(l,f,m,k){if(k==undefined){k=false}var g=this.getAColSchema(l);var h=0;for(s_k in this.arr_hidden_rows[g.tableid]["dat"]){if(typeof this.arr_hidden_rows[g.tableid]["dat"][s_k]=="function"){break}if(h==f-1){if(this.arr_hidden_rows[g.tableid]["dat"][s_k][l]==undefined){this.arr_hidden_rows[g.tableid]["dat"][s_k][l]={val:"",pval:""}}if(k){this.arr_hidden_rows[g.tableid]["dat"][s_k][l]["pval"]=m}else{this.arr_hidden_rows[g.tableid]["dat"][s_k][l]["val"]=m}break}h++}};TCRSTableIndex.prototype.get_hidden_cell_value=function(c,d){var f=this.getAColSchema(c);var e=0;for(s_k in this.arr_hidden_rows[f.tableid]["dat"]){if(typeof this.arr_hidden_rows[f.tableid]["dat"][s_k]=="function"){break}if(e==d-1){if(this.arr_hidden_rows[f.tableid]["dat"][s_k][c]==undefined){this.arr_hidden_rows[f.tableid]["dat"][s_k][c]={val:"",pval:""}}return this.arr_hidden_rows[f.tableid]["dat"][s_k][c]["val"];break}e++}return""};TCRSTableIndex.prototype.clear_hidden_cell_value=function(c,d){var f=this.getAColSchema(c);var e=0;for(s_k in this.arr_hidden_rows[f.tableid]["dat"]){if(typeof this.arr_hidden_rows[f.tableid]["dat"][s_k]=="function"){break}if(e==d-1){if(this.arr_hidden_rows[f.tableid]["dat"][s_k][c]==undefined){this.arr_hidden_rows[f.tableid]["dat"][s_k][c]={val:"",pval:""}}this.arr_hidden_rows[f.tableid]["dat"][s_k][c]["val"]="";break}e++}};TCRSTableIndex.prototype.delete_hidden_row=function(g,h){var b=this.getAColSchema(g);var f=0;var c="";for(s_k in this.arr_hidden_rows[b.tableid]["dat"]){if(typeof this.arr_hidden_rows[b.tableid]["dat"][s_k]=="function"){break}if(f==h-1){delete this.arr_hidden_rows[b.tableid]["dat"][s_k];c=s_k;break}f++}return c};function TCRSColumnIndex(c,d){this.crsDataSet=c;this.i_tab_id=d;TCRSDataRecord.call(this,this.crsDataSet,"crscell.crs_columnindex","*","tableid='"+d+"'","cellspan");this.obj_data_cache=new TCRSDataCache(this,this.crsDataSet,this.i_tab_id);this.arr_group_column=null;this.arr_merge_column=null;this.b_do_create_cur_table=false;this.i_init_cz=1;this.arr_output_cols=[];this.arr_radio_group=null;this.arr_picture_cols=null;this.arr_hidden_cols=null}TCRSColumnIndex.prototype=new TCRSDataRecord();TCRSColumnIndex.prototype.getRecordCount=function(){return this.obj_data_cache.get_record_count()};TCRSColumnIndex.prototype.getColumnDefRect=function(f){this.loadData("#tablecrs_columnindex"+this.i_tab_id);var h=[{pg:"",x:-1,y:-1},{pg:"",x:-1,y:-1}];if(!this.isEmpty()){var g=this.first();while(!this.EOF()){var e=rectNameToIndex(g.cellspan);if(h[0].x==-1||h[0].x>e[0].x){h[0].x=e[0].x}if(h[0].y==-1||h[0].y>e[0].y){h[0].y=e[0].y}if(h[1].x<e[1].x){h[1].x=e[1].x}if(h[1].y<e[1].y){h[1].y=e[1].y}g=this.next()}}return rectIndexToName(h)};TCRSColumnIndex.prototype.hasColumn=function(c){res=false;this.loadData("#tablecrs_columnindex"+this.i_tab_id);for(var d=0;d<this.rows.length;d++){if(this.rows[d].kid==c){res=true;break}}return res};TCRSColumnIndex.prototype.getWriteCellList=function(o,k){this.loadData("#tablecrs_columnindex"+this.i_tab_id);var p=null;if(!this.isEmpty()){p=[];var l=this.first();while(!this.EOF()){p.push({i_cell_span:l.cellspan,arr_cell_rect:rectNameToIndex(l.cellspan)});var m=HandleMemoStr(l.displaystyle,false);if(m==""){if(l.datatype=="\u6570\u503c\u578b"){m="0"}else{if(l.datatype=="\u6570\u503c\u578b"){m="_($#,##0_) ($#,##0)"}else{if(l.datatype=="\u65e5\u671f\u578b"){m="yyyy.mm.dd"}}}}p.push(m);p.push(o.sheetindex);if(o.tabletype=="\u4ea4\u53c9\u8868"){p.push("\u4e3b\u8868")}else{p.push(o.tabletype)}p.push(o.expandtype);var n=this.getRecordCount();if(n<o.initcz){n=o.initcz}p.push(n);p.push(l.datatype);p.push(l.defaultval);if(l.ishidden!="\u662f"&&o.ishidden=="\u662f"){l.ishidden="\u662f"}p.push(l.ishidden);p.push(l.readonly);var h=true;if(k!=null){if(indexOf(k,l.kid)==-1){h=false}}p.push(h);p.push(l.refrepid);p.push(l.color);p.push(l.kid);p.push(l.id);l=this.next()}}return p};TCRSColumnIndex.prototype.get_id_by_name=function(d){var c=this.search("columnlabel",d);if(c!=null){return c.id}else{return -1}};TCRSColumnIndex.prototype.get_raw_value=function(g,f){var e="";var h=this.getRecordCount();if(h>=f){e=HandleMemoStr(this.obj_data_cache.rows[f-1][this.obj_data_cache.get_nth_by_col_name("col"+g)],false);if(e=="1899-12-30 00:00:00"){e="0000-00-00 00:00:00"}}return e};TCRSColumnIndex.prototype.get_cell_value=function(r,v,q,t,p){var o="",w="";var x=v;if(!q){r=this.get_id_by_name(r)}var s=this.search("id",r);if(s!=null){var n=rectNameToIndex(s.cellspan);var m={};m.x=n[0].x;m.y=n[0].y;if(v==0){v=1}if(v>1){if(t.expandtype=="\u4e0d\u6269\u5c55"||t.expandtype=="\u6309\u884c\u5411\u4e0b"){m.y+=(x-1)*(n[1].y-n[0].y+1)}else{m.x+=(x-1)*(n[1].x-n[0].x+1)}}var u=this.getRecordCount();if(crsReport.writeColList!=null&&crsReport.writeColList.indexOf(s.kid)==-1&&crsReport.readColList!=null&&crsReport.readColList.indexOf(s.kid)==-1){if(u>0&&u>=v){o=this.obj_data_cache.rows[v-1][this.obj_data_cache.get_nth_by_col_name("col"+s.id)]}}else{o=crsReport.crsCommon.get_cell_value(0,m.x,m.y,p);if(o==""&&u>0&&u>=v){o=this.obj_data_cache.rows[v-1][this.obj_data_cache.get_nth_by_col_name("col"+s.id)]}}if(o=="1899-12-30 00:00:00"){o="0000-00-00 00:00:00"}}return o};TCRSColumnIndex.prototype.get_cur_tab_name=function(){if(this.obj_data_cache==null){this.obj_data_cache=new TCRSDataCache(this,this.crsDataSet,this.i_tab_id)}return this.obj_data_cache.s_cur_tab_name};TCRSColumnIndex.prototype.get_column_list=function(f){this.loadData("#tablecrs_columnindex"+this.i_tab_id);var g,h,e;if(!this.isEmpty()){row=this.first();while(!this.EOF()){f.arr_col_index.push(row.kid);if(f.s_cdef_column_list!=""){f.s_cdef_column_list+=",";f.s_column_list+=";"}g=row.id;f.s_column_list+="col"+g;h=HandleMemoStr(row.displaystyle,false);row.displaystyle=h;if(row.datatype=="\u81ea\u589e\u578b"){f.s_cdef_column_list+="col"+g+" int"}else{if(row.datatype=="\u8d27\u5e01\u578b"){f.s_cdef_column_list+="col"+g+" decimal(12,2)"}else{if(row.datatype=="\u6570\u503c\u578b"){if(row.displaystyle=="0"||row.displaystyle=="#,##0"||row.displaystyle=="(#,##0_) (#,##0)"||row.displaystyle=="(#,##0_) [Red](#,##0)"||row.displaystyle==""){if(row.barcode!=""){f.s_cdef_column_list+="col"+g+" bigint"}else{f.s_cdef_column_list+="col"+g+" int"}}else{f.s_cdef_column_list+="col"+g+" double"}}else{if(row.datatype=="\u65e5\u671f\u578b"){if(row.displaystyle=="yyyy\u5e74mm\u6708dd\u65e5"||row.displaystyle=="yyyy\u5e74mm\u6708"||row.displaystyle=="yyyy\u5e74"||row.displaystyle=="yyyy.mm.dd"||row.displaystyle=="yyyy-mm-dd"||row.displaystyle=="yyyy.mm"||row.displaystyle=="yyyy-mm"||row.displaystyle=="m/d/yy"||row.displaystyle=="dd/mm/yy"||row.displaystyle=="dd.mmmm.yy"||row.displaystyle=="d-mmm-y"||row.displaystyle=="d-mmm"||row.displaystyle=="mmmm-yy"||row.displaystyle==""){f.s_cdef_column_list+="col"+g+" date"}else{if(row.displaystyle=="m/d/yy h:mm"){f.s_cdef_column_list+="col"+g+" datetime"}else{f.s_cdef_column_list+="col"+g+" time"}}}else{f.s_cdef_column_list+="col"+g+" text"}}}}e=row.defaultval;if(e==""&&row.ismust!="\u662f"){if(row.datatype=="\u8d27\u5e01\u578b"||row.datatype=="\u6570\u503c\u578b"||row.datatype=="\u65e5\u671f\u578b"){e=0}}f.s_default_val+=";"+e;row=this.next()}}};TCRSColumnIndex.prototype.update_cell_refer=function(o,r,p,k){this.loadData("#tablecrs_columnindex"+this.i_tab_id);if(!this.isEmpty()){var m=this.first();while(!this.EOF()){var l=crsReport.crsTableIndex.getAColSchema(m.kid);var q=l.display_rect;if(k!="\u6309\u5217\u5411\u53f3"&&q[0].y>o[1].y){var n=o[1].y-o[0].y+1;if(r=="insert"){q[0].y+=(n)*p;q[1].y+=(n)*p}else{q[0].y-=(n)*p;q[1].y-=(n)*p}m.cellspan=rectIndexToName(q)}else{if(k=="\u6309\u5217\u5411\u53f3"&&q[0].x>o[1].x){var n=o[1].x-o[0].x;if(r=="insert"){q[0].x+=(n)*p;q[1].x+=(n)*p}else{q[0].x-=(n)*p;q[1].x-=(n)*p}m.cellspan=rectIndexToName(q)}}m=this.next()}}};TCRSColumnIndex.prototype.get_group_column_list=function(){this.loadData("#tablecrs_columnindex"+this.i_tab_id);var d=this.cursor;var e="";if(!this.isEmpty()){var f=this.first();while(!this.EOF()){if(f.isgroup=="\u662f"){if(this.arr_group_column==null){this.arr_group_column=[]}this.arr_group_column.push("col"+f.id);if(e!=""){e+=","}e+="col"+f.id+" asc"}else{if(f.mergetype!=""&&f.mergetype!="\u4e0d\u6c47\u603b"){if(this.arr_merge_column==null){this.arr_merge_column=[]}this.arr_merge_column.push("col"+f.id);this.arr_merge_column.push(f.mergetype)}}f=this.next()}}this.cursor=d;return e};TCRSColumnIndex.prototype.get_order_column_list=function(){this.loadData("#tablecrs_columnindex"+this.i_tab_id);var d=this.cursor;var e="";if(!this.isEmpty()){var f=this.first();while(!this.EOF()){if(f.ordertype!=""&&f.ordertype!="\u4e0d\u6392\u5e8f"){if(e!=""){e+=","}e+="col"+f.id+" "+((f.ordertype=="\u5347\u5e8f")?"asc":"desc")}f=this.next()}}this.cursor=d;return e};TCRSColumnIndex.prototype.prev_handle_data=function(){};TCRSColumnIndex.prototype.get_first_data_item=function(){var h=null;if(this.obj_data_cache!=null){if(!this.obj_data_cache.isEmpty()){h={};h.data=this.obj_data_cache.first()}}if(h!=null){if(!this.isEmpty()){var f=[];var g=this.first();while(!this.EOF()){var e=rectNameToIndex(g.cellspan);f.push(g.id);f.push(e[0].x);f.push(e[0].y);f.push(g.displaystyle);f.push(g.datatype);f.push(g.refrepid);f.push(g.kid);f.push(this.obj_data_cache.get_nth_by_col_name("col"+g.id));f.push(this.obj_data_cache.get_nth_by_col_name("kid"));f.push(g.color);f.push(g.cellspan);f.push(g.readonly);f.push(g.ishidden);f.push(g.merge_equal);if(g.datatype=="\u4ee3\u7801\u578b"&&g.codeid>0){f[f.length-1]=g.codeid}g=this.next()}h.schema=f}}return h};TCRSColumnIndex.prototype.get_next_data_item=function(){var b=null;if(this.obj_data_cache!=null){if(!this.obj_data_cache.isEmpty()){if(!this.obj_data_cache.EOF()){b=this.obj_data_cache.next()}}}return b};TCRSColumnIndex.prototype.clear_data_item=function(w,q){if(q==null||q.length<=0){return}if(this.obj_data_cache!=null){var A=this.obj_data_cache.get_record_count();if(A<w.initcz){A=w.initcz}if(A>0){var s=parseInt(w.sheetindex)-1;for(var y=0,x=q.length/2;y<x;y++){var B=this.search("columnlabel",q[y*2]);if(B!=null){var v=(q[y*2+1].charAt(0)=="-")?true:false;var z=parseInt(q[y*2+1]);if(z<0){z=-z}var r=rectNameToIndex(B.cellspan);if(w.tabletype=="\u660e\u7ec6\u8868"&&z>0){if(w.expandtype=="\u6309\u5217\u5411\u53f3"||w.expandtype=="\u4e0d\u6269\u5c55\uff08\u6309\u5217\u5411\u53f3\uff09"){var u=r[1].x-r[0].x+1;r[0].x+=u*(z-1);r[1].x+=u*(z-1);crsReport.crsCommon.clear_cell(s,r[0].x,r[0].y)}else{var u=r[1].y-r[0].y+1;r[0].y+=u*(z-1);r[1].y+=u*(z-1);crsReport.crsCommon.clear_cell(s,r[0].x,r[0].y)}}else{if(w.expandtype=="\u6309\u5217\u5411\u53f3"||w.expandtype=="\u4e0d\u6269\u5c55\uff08\u6309\u5217\u5411\u53f3\uff09"){var u=r[1].x-r[0].x+1}else{var u=r[1].y-r[0].y+1;for(var t=0;t<A;t++){crsReport.crsCommon.clear_cell(s,r[0].x,r[0].y+u*t)}if(w.expandtype=="\u6309\u884c\u5411\u4e0b"&&!v&&this.i_init_cz<A){if(crsReport.b_as_form){for(var t=A-1;t>=this.i_init_cz;t--){crsReport.crsCommon.crsForm.delete_record(w,s,r[0].x,r[0].y+u*t)}}else{for(var t=A-1;t>=this.i_init_cz;t--){var D=r[0].y+u*t;var C="row"+D+"column"+r[0].x;crsReport.crsCommon.crsTable.delete_record(undefined,crsReport.obj_cell_maps[s][C])}}A=this.i_init_cz}}}}}}}};TCRSColumnIndex.prototype.reset_cell_color=function(q,m){if(m==null||m.length<=0){return}if(this.obj_data_cache!=null){var u=this.obj_data_cache.get_record_count();if(u<q.initcz){u=q.initcz}if(u>0){var o=parseInt(q.sheetindex)-1;for(var s=0,r=m.length/2;s<r;s++){if(m[s*2].charAt(0)=="{"){var v=this.search("kid",m[s*2])}else{var v=this.search("id",m[s*2])}if(v!=null){var t=m[s*2+1];var n=rectNameToIndex(v.cellspan);if(q.tabletype=="\u660e\u7ec6\u8868"&&t>0){if(q.expandtype=="\u6309\u5217\u5411\u53f3"||q.expandtype=="\u4e0d\u6269\u5c55\uff08\u6309\u5217\u5411\u53f3\uff09"){var p=n[1].x-n[0].x+1;n[0].x+=p*(t-1);n[1].x+=p*(t-1)}else{var p=n[1].y-n[0].y+1;n[0].y+=p*(t-1);n[1].y+=p*(t-1)}}crsReport.crsCommon.set_cell_backgroud_color(o,n[0].x,n[0].y)}}}}};TCRSColumnIndex.prototype.get_noclear_and_defaultval_column_list=function(d){if(!this.isEmpty()){var c=this.first();while(!this.EOF()){if(c.iskeep=="\u662f"){if(d.arr_noclear==null){d.arr_noclear=[]}d.arr_noclear.push(c.cellspan)}if(c.defaultval!=""){if(d.arr_defaultval==null){d.arr_defaultval=[]}d.arr_defaultval.push(c.cellspan);d.arr_defaultval.push(c.defaultval)}c=this.next()}}};TCRSColumnIndex.prototype.auto_increment=function(p,q){if(!this.isEmpty()){var k=this.first();while(!this.EOF()){if(k.datatype=="\u81ea\u589e\u578b"){var m=rectNameToIndex(k.cellspan);if(q=="\u6309\u884c\u5411\u4e0b"||q=="\u4e0d\u6269\u5c55"){var l=m[1].y-m[0].y+1;var r="row"+m[0].y+"column"+m[0].x;var o=crsReport.obj_cell_maps[p][r];var s=1;while(o!=null&&$(o).attr("cid")==k.kid){crsReport.crsCommon.set_cell_value(o,s);var n=m[0].y+s*l;var r="row"+n+"column"+m[0].x;o=crsReport.obj_cell_maps[p][r];s++}}}k=this.next()}}};TCRSColumnIndex.prototype.free=function(){if(this.obj_data_cache!=null){this.obj_data_cache.free()}};function TCRSDataCache(d,f,e){this.crsDataSet=f;this.i_tab_id=e;this.s_cur_tab_name="crscell.crs_tabledata"+this.i_tab_id+crsReport.s_postfix;this.s_column_list="";this.s_cdef_column_list="";this.s_default_val="";this.arr_col_index=[];this.arr_col_index.push("displayseq");this.arr_col_index.push("title");this.arr_col_index.push("memo");this.obj_column_cache=d;this.obj_column_cache.get_column_list(this);this.s_cdef_column_list="create TABLE IF NOT EXISTS "+this.s_cur_tab_name+" (id int(10) unsigned NOT NULL auto_increment,kid varchar(40),organid int(11) unsigned NOT NULL default '1',userid varchar(20) NOT NULL default 'admin',writetime varchar(25) default '0000-00-00 00:00:00',uploadtime varchar(25) default '0000-00-00 00:00:00',logiccheck varchar(20) NOT NULL default 'unchecked',isfrozen char(2) NOT NULL default 'n',ismerge char(2) NOT NULL default 'n',rkid varchar(40),displayseq int(10),title varchar(255),memo tinytext,"+this.s_cdef_column_list+",PRIMARY KEY  (id),UNIQUE KEY id (id)) ENGINE=MyISAM;";this.s_default_val=";;"+crsReport.organId+";"+crsReport.userId+";"+crsReport.writeTime+";;uncheck;n;n;"+crsReport.refKID+";;;"+this.s_default_val;TCRSDataRecord.call(this,this.crsDataSet,"crscell.crs_tabledata"+this.i_tab_id,"id;kid;organid;userid;writetime;uploadtime;logiccheck;isfrozen;ismerge;rkid;displayseq;title;memo;"+this.s_column_list,"userid='"+crsReport.userId+"' and writetime = '"+crsReport.writeTime+"'","displayseq");this.obj_cur_rows=null}TCRSDataCache.prototype=new TCRSDataRecord();TCRSDataCache.prototype.LoadNomarizedData=function(){if(this.doLoaded){return}if(this.isEmpty()){if(crsReport.openMode=="write"){this.doLoaded=true;return}var x=crsReport.s_read_filter;if(x!==""){x=x.replaceAll("and","&");var u=x.split("&");x="";for(var K=0,M=u.length;K<M;K++){var A=u[K].replaceAll("or","|");var w=A.split("|");var J=0,y=w.length;var N="";while(J<y){var D=w[J].indexOf("crscell.crs_tabledata"+this.i_tab_id+"c");if(D!=-1){var v=w[J].indexOf(".",D+8);A=w[J].substring(D,v+1);w[K]=w[J].replaceAll(A,"");if(N!=""){N+=" or "}N+=w[K]}else{}J++}if(N!=""){if(x!=""){x+=" and "}x+="("+N+")"}}}var G=this.obj_column_cache.get_group_column_list();if(G==""){G=this.obj_column_cache.get_order_column_list()}if(G==""){G="displayseq"}if(x!=""){var z=x+" and userid='"+crsReport.userId+"' and writetime='"+crsReport.writeTime+"'"}else{var z="userid='"+crsReport.userId+"' and writetime='"+crsReport.writeTime+"'"}if(crsReport.refKID!=""){z+=" and rkid='"+crsReport.refKID+"'"}this.crsDataSet.execQuery2("select "+this.columnList.replaceAll(";",",")+" from "+this.tabName+" where "+z+" order by "+G,this.LoadNomarizedDataCB,this,"#tablecrs_tabledata"+this.i_tab_id);if(this.isEmpty()){if(crsReport.s_data_flow==""){crsReport.s_data_flow=crsReport.crsReportState.get_data_flow(crsReport.s_cur_task)}var T=crsReport.s_data_flow;if(T!=""&&T.indexOf("->"+this.i_tab_id+"_{")){var H=T.split("%");for(var O=0,I=H.length;O<I;O++){if(H[O].indexOf("->"+this.i_tab_id+"_{")!=-1){break}}if(O<I){var B=H[O].split(";");for(var O=0,I=B.length;O<I;O++){var E=B[O].split(",");for(var R=0,S=E.length;R<S;R++){var U=E[R].indexOf("->");var A=E[R].indexOf("{",U),C=E[R].indexOf("}",U);var P=E[R].substr(0,U);var Q=E[R].substring(A,C+1);var L=crsReport.crsTableIndex.getAColSchema(Q);if(L!=null){if(R==0){if(crsReport.crsTableIndex.rows[L.row_idx].tabletype=="\u660e\u7ec6\u8868"||this.rows.length==0){var F=crsReport.crsTableIndex.create_row_kid(Q);this.rows.push(this.s_default_val.split(";"))}}this.rows[this.rows.length-1][this.arr_column_list.indexOf("col"+L.col.rows[L.col_idx].id)]=P}}}}}}}};TCRSDataCache.prototype.LoadNomarizedDataCB=function(l,k){k.doLoaded=true;if(l!=""){var m=l.split("\r");if(k.obj_column_cache.arr_group_column!=null&&crsReport.openMode=="read"){}for(var n=0,h=m.length;n<h;n++){m[n]=m[n].replaceAll('"',"\u53cc\u5f15\u53f7");m[n]=m[n].split(";");if(m[n][11]=="null"){m[n][11]=""}if(m[n][12]=="null"){m[n][12]=""}var g=new TCRSRowProperty(k.obj_column_cache,m[n][10],m[n][2],m[n][3],m[n][4],m[n][11],m[n][12]);crsReport.crsTableIndex.update_row_kid(m[n][1],g);if(crsReport.s_title!=HandleMemoStr(m[n][11],false)){crsReport.s_title=HandleMemoStr(m[n][11],false)}if(crsReport.s_memo!=HandleMemoStr(m[n][12],false)){crsReport.s_memo=HandleMemoStr(m[n][11],false)}}k.rows=m;if(k.obj_column_cache.i_init_cz!=m.length){k.obj_column_cache.i_init_cz=m.length}}};TCRSDataCache.prototype.get_record_count=function(){this.LoadNomarizedData();return this.rows.length};TCRSDataCache.prototype.add_cur_col_val=function(m,l,o){if(this.obj_cur_rows==null){this.obj_cur_rows={}}var p="d"+m;if(this.obj_cur_rows[p]==undefined){this.obj_cur_rows[p]=new Array(this.arr_col_index.length);for(var n=0,h=this.arr_col_index.length;n<h;n++){this.obj_cur_rows[p][n]=""}}var k=this.arr_col_index.indexOf(l);this.obj_cur_rows[p][k]=o};TCRSDataCache.prototype.end_add_cur_col_val=function(){this.obj_cur_rows=null};TCRSDataCache.prototype.free=function(){};function TCRSFormulas(k,l,m,q,n,o,r,p){this.s_label=k;this.s_formulas_type=l;this.s_workflow_time=m;this.s_app_time=q;this.s_distinct=n;this.s_recursive=o;this.s_fun_name=r;this.s_fetch_end=p;this.arr_cur_table_ref=null;this.arr_cur_column_ref=null;this.arr_column_ref_back=null;this.arr_column_ref=null;this.arr_fill_expr=null;this.s_sql="";this.s_sql2="";this.b_merged=false;this.b_hasif=false;this.b_has_match=false;this.b_parsed=false;this.b_to_executed=false;this.i_fill_step=7;this.i_cur_seq=0;this.b_do_match=false;this.i_match_value_fill_formulas_index=-1;this.s_cond_sql="";this.s_db_name="";this.s_table_list="";this.s_table_link="";this.s_condition_expr="";this.s_compute_expr="";this.s_target_expr="";this.s_order_expr="";this.s_fill_table="";this.s_fill_expr="";this.s_v_compute_expr="";this.s_dump_sql="";this.s_recursive_cond_expr="";this.s_recursive_expr="";this.s_column_ref_back="";this.arr_merged_formulas_index=null}TCRSFormulas.prototype={constructor:TCRSFormulas,Init:function(p,q,m,r,o,n,l,k){this.s_table_list=p;this.s_table_link=q;this.s_condition_expr=m;this.s_compute_expr=r;this.s_target_expr=o;this.s_order_expr=n;this.s_fill_table=l;this.s_fill_expr=k},set_to_executed:function(p){if(this.b_to_executed==p){return}this.b_to_executed=p;if(this.arr_fill_expr==null){return}if(this.b_to_executed){for(var n=0,l=this.arr_fill_expr.length/this.i_fill_step;n<l;n++){if(this.arr_fill_expr[n*this.i_fill_step+5]=="\u586b\u5165\u503c"){var f=this.arr_fill_expr[n*this.i_fill_step+3];var o=this.arr_fill_expr[n*this.i_fill_step+4];for(var q=0,r=crsReport.crsFormulasCache.arr_formulas.length;q<r;q++){var m=crsReport.crsFormulasCache.arr_formulas[q];if(!m.b_to_executed&&(m.s_app_time.indexOf(CRS_CHANGE_EXEC)!=-1||m.s_app_time=="")){if(m.s_app_time!=""){m.can_execute(f,o,true)}}}}}}},can_execute:function(q,r,n){var o=r;if(this.b_to_executed){return}if(this.s_v_compute_expr!=""){}else{if(this.arr_cur_column_ref==null){return}if(this.s_app_time.indexOf(CRS_CHANGE_EXEC)==-1){return}this.i_cur_seq=0;if(r==""){}else{var m=this.arr_cur_column_ref.indexOf(r);if(!n){q=crsReport.crsTableIndex.get_tab_id_by_col_kid(r);if(m==-1){r=crsReport.crsTableIndex.get_col_id_by_col_kid(r);m=this.arr_cur_column_ref.indexOf(r)}}if(m!=-1&&(this.s_workflow_time==""||this.s_workflow_time=="\u6240\u6709\u4efb\u52a1"||this.s_workflow_time==crsReport.crsFormulasCache.s_workflow)){if(this.s_fill_table=="\u672c\u62a5\u8868."+q||this.s_fill_table.indexOf("\u672c\u62a5\u8868."+o)!=-1||this.s_formulas_type=="\u9a8c\u8bc1\u516c\u5f0f"){this.i_cur_seq=crsReport.crsFormulasCache.i_display_seq}if(!crsReport.crsFormulasCache.b_for_delete||this.arr_fill_expr!=null&&this.arr_fill_expr.indexOf(q)!=-1){var k=crsReport.crsFormulasCache.i_display_seq;crsReport.crsFormulasCache.i_display_seq=this.i_cur_seq;this.set_to_executed(true);crsReport.crsFormulasCache.i_display_seq=k}else{if(this.arr_fill_expr!=null){for(var p=0,l=this.arr_fill_expr.length/this.i_fill_step;p<l;p++){if(this.arr_fill_expr[p*this.i_fill_step+4]==r&&(this.arr_fill_expr[p*this.i_fill_step+5]=="\u5339\u914d"||this.arr_fill_expr[p*this.i_fill_step+5]=="<>"||this.arr_fill_expr[p*this.i_fill_step+5]=="<"||this.arr_fill_expr[p*this.i_fill_step+5]=="<="||this.arr_fill_expr[p*this.i_fill_step+5]==">="||this.arr_fill_expr[p*this.i_fill_step+5]==">")&&!crsReport.crsFormulasCache.b_for_delete&&(this.s_workflow_time==""||this.s_workflow_time=="\u6240\u6709\u4efb\u52a1"||this.s_workflow_time==crsReport.crsFormulasCache.s_workflow)){this.i_cur_seq=crsReport.crsFormulasCache.i_display_seq;this.set_to_executed(true);break}}}}}}}},get_fill_type:function(l,f){var m="\u586b\u5165\u503c";if(this.arr_fill_expr!=null){for(var k=0,g=this.arr_fill_expr.length/this.i_fill_step;k<g;k++){if(this.arr_fill_expr[k*this.i_fill_step+1]==l&&this.arr_fill_expr[k*this.i_fill_step+2]==f){m=this.arr_fill_expr[k*this.i_fill_step+5];break}}}if(m==""){if(this.arr_merged_formulas_index!=null){for(var k=0,g=this.arr_merged_formulas_index.length,h=crsReport.crsFormulasCache.arr_formulas.length;k<g;k++){if(this.arr_merged_formulas_index[k]<h){m=crsReport.crsFormulasCache.arr_formulas[this.arr_merged_formulas_index[k]].get_fill_type(l,f);if(m!=""){break}}}}}return m},has_fill:function(){var b=false;if(this.s_v_compute_expr!=""){b=true}else{if(this.arr_fill_expr!=null){if(this.arr_fill_expr.indexOf("\u586b\u5165\u503c")!=-1){b=true}}}return b}};function TCRSParseCache(c,d){this.repId=d;this.crsDataSet=c;TCRSDataRecord.call(this,this.crsDataSet,"crscell.crs_parsecache","id,formulasid,cur_table_ref_list,cur_column_ref_list,column_ref_back_list,column_ref_list,fill_expr_list,_sql,_sql2,be_merged,be_hasif,be_hasmatch,recursive_cond_expr,recursive_expr,column_ref_back,cond_sql,db_label,merged_formulas_index_list","repid='"+this.repId+"'","id")}TCRSParseCache.prototype=new TCRSDataRecord();function TCRSFormulasCache(c,d){this.repId=d;this.crsDataSet=c;TCRSDataRecord.call(this,this.crsDataSet,"crscell.crs_formulas","id,label,formulastype,workflowtime,apptime,isdistinct,tablelist,table_link,condition_expr,order_expr,fill_expr,position,funname,fetch_end","repid='"+this.repId+"'","position");this.b_is_locked=false;this.s_exec_time="";this.s_workflow="";this.i_sheet_idx=0;this.s_ref_cell="";this.i_display_seq=0;this.s_exec_formulas="";this.b_for_validate=false;this.b_for_delete=false;this.b_for_pivot=false;this.arr_formulas=null;this.obj_crsParseCache=null;this.s_info="";this.s_temp_table_list=""}TCRSFormulasCache.prototype=new TCRSDataRecord();TCRSFormulasCache.prototype.init_formulas=function(){arr_tab_id=null;arr_cur_tab_name=null;if(this.arr_formulas!=null){return}if(!this.isEmpty()){if(this.obj_crsParseCache==null){this.obj_crsParseCache=new TCRSParseCache(this.crsDataSet,this.repId);this.obj_crsParseCache.loadData("#tablecrs_parsecache")}this.arr_formulas=[];var m=this.first();var q=0;while(!this.EOF()){var p=new TCRSFormulas(m.label,m.formulastype,m.workflowtime,m.apptime,m.isdistinct,m.isrecusive,m.funname,m.fetch_end);this.arr_formulas.push(p);var l=this.obj_crsParseCache.search("formulasid",m.id);if(l!=null){p.s_db_name=l.db_label;if(l.cur_table_ref_list!=""){p.arr_cur_table_ref=HandleMemoStr(l.cur_table_ref_list,false).split(",")}if(l.cur_column_ref_list!=""){p.arr_cur_column_ref=HandleMemoStr(l.cur_column_ref_list,false).split(",")}if(l.column_ref_back_list!=""){p.s_column_ref_back=HandleMemoStr(l.column_ref_back_list,false);p.arr_column_ref_back=p.s_column_ref_back.split(",");p.s_column_ref_back=p.s_column_ref_back.replaceAll(","," ")}if(l.column_ref_list!=""){p.arr_column_ref=HandleMemoStr(l.column_ref_list,false).replaceAll('"',"").split(",")}var n=HandleMemoStr(l.fill_expr_list,false);if(n!=""){if(m.formulastype!="\u53d6\u6570\u516c\u5f0f"){p.arr_fill_expr=n.split(",")}else{p.arr_fill_expr=[];var f=n.split(",");for(var q=0,k=f.length,o=0,n="";q<k;q++){if(q>0&&f[q]=="\u672c\u62a5\u8868"){p.arr_fill_expr.push(n);n="";o=0}if(o<6){p.arr_fill_expr.push(f[q]);o++}else{n+=f[q]}}p.arr_fill_expr.push(n)}}if(l.be_merged=="Y"){p.b_merged=true}if(l.be_hasif=="Y"){p.b_hasif=true}if(l.be_hasmatch=="Y"){p.b_has_match=true}if(l.merged_formulas_index_list!=""){p.arr_merged_formulas_index=HandleMemoStr(l.merged_formulas_index_list,false).split(",")}p.b_parsed=true}p.Init(HandleMemoStr(m.tablelist,false),HandleMemoStr(m.table_link,false),HandleMemoStr(m.condition_expr,false),HandleMemoStr(m.compute_expr,false),HandleMemoStr(m.target_expr,false),HandleMemoStr(m.order_expr,false),HandleMemoStr(m.fill_table,false),HandleMemoStr(m.fill_expr,false));if(m.formulastype=="\u9a8c\u8bc1\u516c\u5f0f"){p.s_input_hint_caption=HandleMemoStr(m.order_expr,false);p.s_input_hint_content=HandleMemoStr(m.fill_expr,false);p.s_error_hint_content=HandleMemoStr(m.fill_vexpr,false)}p.i_item_index=q++;m=this.next()}}};TCRSFormulasCache.prototype.execute_formulas=function(s,q,r,m,n,k,p,l,o){if(this.b_is_locked){}if(s==""){s=crsReport.s_begin_task}this.s_workflow=s;this.s_exec_time=q;this.i_sheet_idx=r;this.s_ref_cell=m;this.i_display_seq=n;this.s_exec_formulas=k;this.b_for_validate=p;this.b_for_delete=l;this.b_for_pivot=o;this.b_is_locked=true;this.begin_execute();this.execute();this.b_is_locked=false};TCRSFormulasCache.prototype.begin_execute=function(){this.loadData("#tablecrs_formulas");this.init_formulas();var h=null;if(this.s_ref_cell!=""){h=this.s_ref_cell.split(",")}if(this.arr_formulas!=null){for(var n=0,k=this.arr_formulas.length;n<k;n++){if(this.arr_formulas[n].b_to_executed){continue}if(((this.arr_formulas[n].s_app_time.indexOf(this.s_exec_time)!=-1&&(this.s_exec_time!=CRS_MANUL_EXEC||this.s_exec_time==CRS_MANUL_EXEC&&(this.s_exec_formulas!=""&&this.s_exec_formulas.indexOf(this.arr_formulas[n].s_label+",")!=-1||this.s_exec_formulas==this.arr_formulas[n].s_fun_name))||this.b_for_validate)&&(this.arr_formulas[n].s_workflow_time==""||this.arr_formulas[n].s_workflow_time=="\u6240\u6709\u4efb\u52a1"||this.arr_formulas[n].s_workflow_time==this.s_workflow)&&(this.b_for_validate&&this.arr_formulas[n].s_formulas_type=="\u9a8c\u8bc1\u516c\u5f0f"||!this.b_for_validate&&this.arr_formulas[n].s_formulas_type!="\u9a8c\u8bc1\u516c\u5f0f"))||this.b_for_pivot&&this.s_exec_formulas==this.arr_formulas[n].s_label){if(this.s_exec_time==CRS_CHANGE_EXEC){if(h!=null){for(var o=0,p=h.length;o<p;o++){var l="";this.arr_formulas[n].can_execute(l,h[o],false)}}else{var l="",m="";this.arr_formulas[n].can_execute(l,m,false)}}else{this.arr_formulas[n].set_to_executed(true)}}}}};TCRSFormulasCache.prototype.execute=function(){var ac="",Y="",O="",S="",ag="",Z="",ak="",X="",an="",ab="",U="";var s=[],K=null;if(this.arr_formulas!=null){for(var aa=0,V=this.arr_formulas.length;aa<V;aa++){if(this.arr_formulas[aa].b_merged&&!this.b_for_pivot){continue}if(this.arr_formulas[aa].b_to_executed){if(this.arr_formulas[aa].b_do_match){this.arr_formulas[aa].b_do_match=false}var af={idx:aa,f_type:this.arr_formulas[aa].s_formulas_type,r_cond_expr:this.arr_formulas[aa].s_recursive_cond_expr,seq:this.arr_formulas[aa].i_cur_seq,rep:[],app:[]};ak="";Z="";if(this.arr_formulas[aa].arr_fill_expr!=null){for(var p=0,ad=this.arr_formulas[aa].arr_fill_expr.length/this.arr_formulas[aa].i_fill_step;p<ad;p++){var Q=this.arr_formulas[aa].arr_fill_expr[p*this.arr_formulas[aa].i_fill_step+5];if(Q=="\u5339\u914d"||Q=="<>"||Q=="<"||Q=="<="||Q==">="||Q==">"){for(var M=0;M<aa;M++){if(this.arr_formulas[M].b_to_executed){if(this.arr_formulas[M].arr_fill_expr!=null){for(var am=0,ae=this.arr_formulas[M].arr_fill_expr.length/this.arr_formulas[M].i_fill_step;am<ae;am++){var ai=this.arr_formulas[M].arr_fill_expr[am*this.arr_formulas[M].i_fill_step+5];if(ai=="\u586b\u5165\u503c"||(this.s_exec_time==CRS_CHANGE_EXEC||this.s_exec_time==CRS_MANUL_EXEC)&&(ai=="\u6784\u9020\u4e0b\u62c9\u5217\u8868"||ai=="\u6784\u9020\u4e0b\u62c9\u5217\u8868\uff08\u5141\u8bb8\u5176\u4ed6\u503c\uff09")){if(this.arr_formulas[aa].arr_fill_expr[p*this.arr_formulas[aa].i_fill_step+3]==this.arr_formulas[M].arr_fill_expr[am*this.arr_formulas[M].i_fill_step+3]&&this.arr_formulas[aa].arr_fill_expr[p*this.arr_formulas[aa].i_fill_step+4]==this.arr_formulas[M].arr_fill_expr[am*this.arr_formulas[M].i_fill_step+4]){this.arr_formulas[aa].i_match_value_fill_formulas_index=M;this.arr_formulas[aa].b_do_match=true;break}}}if(am<ae){break}}}}if(M>=aa){var aj=this.arr_formulas[aa].arr_fill_expr[p*this.arr_formulas[aa].i_fill_step+1];var ah=this.arr_formulas[aa].arr_fill_expr[p*this.arr_formulas[aa].i_fill_step+2];if(this.b_for_pivot){var L=HandleMemoStr(crsReport.crsTableIndex.get_cell_value(aj,ah,this.i_display_seq,false),false);af.rep.push("@"+aj+CRSLimiter+ah);af.rep.push(L);this.arr_formulas[aa].b_do_match=true}else{if(this.arr_formulas[aa].i_cur_seq>0){var L=HandleMemoStr(crsReport.crsTableIndex.get_cell_value(aj,ah,this.i_display_seq,false));af.rep.push("@"+aj+CRSLimiter+ah);af.rep.push(L);this.arr_formulas[aa].b_do_match=true}else{var L=crsReport.crsTableIndex.get_cur_tab_name(this.arr_formulas[aa].arr_fill_expr[p*this.arr_formulas[aa].i_fill_step+3]);if(ag.indexOf(L)==-1){ag+=L+","}if(crsReport.crsTableIndex.get_tab_type_by_id(this.arr_formulas[aa].arr_fill_expr[p*this.arr_formulas[aa].i_fill_step+3])!="\u4ea4\u53c9\u8868"){if(Z==""||Z==L){if(ak!=""){ak+=","}ak+=L+".col"+this.arr_formulas[aa].arr_fill_expr[p*this.arr_formulas[aa].i_fill_step+4]+" as `"+aj+CRSLimiter+ah+"`";Z=L}}}}}}else{if(Q=="\u6784\u9020\u4e0b\u62c9\u5217\u8868"||Q=="\u6784\u9020\u4e0b\u62c9\u5217\u8868\uff08\u5141\u8bb8\u5176\u4ed6\u503c\uff09"){crsReport.crsTableIndex.clear_values_on_list(this.arr_formulas[aa].arr_fill_expr[p*this.arr_formulas[aa].i_fill_step+1],this.arr_formulas[aa].arr_fill_expr[p*this.arr_formulas[aa].i_fill_step+2],this.arr_formulas[aa].i_cur_seq)}}}if(Z!=""){if(crsReport.ListKey!=""){var T=crsReport.ListKey.indexOf(".");var al=crsReport.ListKey.indexOf(".",T+1);var N=crsReport.ListKey.substr(T+1,al-T-1);this.arr_formulas[aa].s_dump_sql="select "+ak+" from "+Z+" where displayseq="+N+" order by displayseq"}else{this.arr_formulas[aa].s_dump_sql="select "+ak+" from "+Z+" order by displayseq"}}if(this.arr_formulas[aa].b_hasif&&this.arr_formulas[aa].i_cur_seq>0){if(this.arr_formulas[aa].arr_cur_column_ref!=null&&this.arr_formulas[aa].arr_cur_column_ref.length>0){var N=crsReport.crsTableIndex.get_cur_tab_name(this.arr_formulas[aa].arr_cur_table_ref[0]);af.app.push(N+".displayseq='"+this.arr_formulas[aa].i_cur_seq+"'")}}}if(this.arr_formulas[aa].arr_cur_column_ref!=null){for(var p=0,ad=this.arr_formulas[aa].arr_cur_column_ref.length;p<ad;p++){var aj=crsReport.crsTableIndex.get_cur_tab_name(this.arr_formulas[aa].arr_cur_table_ref[p]);var N="%%"+aj+".col"+this.arr_formulas[aa].arr_cur_column_ref[p]+"%%";if(Y.indexOf(N)!=-1){L=HandleMemoStr(crsReport.crsTableIndex.get_cell_value(this.arr_formulas[aa].arr_cur_table_ref[p],this.arr_formulas[aa].arr_cur_column_ref[p],true),false);af.rep.push(N);af.rep.push("'%%"+L+"%%'")}N="%%"+aj+".col"+this.arr_formulas[aa].arr_cur_column_ref[p];if(Y.indexOf(N)!=-1){L=HandleMemoStr(crsReport.crsTableIndex.get_cell_value(this.arr_formulas[aa].arr_cur_table_ref[p],this.arr_formulas[aa].arr_cur_column_ref[p],true),false);af.rep.push(N);af.rep.push("'%%"+L+"%%'")}N=aj+".col"+this.arr_formulas[aa].arr_cur_column_ref[p]+"%%";if(Y.indexOf(N)!=-1){L=HandleMemoStr(crsReport.crsTableIndex.get_cell_value(this.arr_formulas[aa].arr_cur_table_ref[p],this.arr_formulas[aa].arr_cur_column_ref[p],true),false);af.rep.push(N);af.rep.push("'%%"+L+"%%'")}}}if(this.arr_formulas[aa].s_formulas_type=="\u81ea\u5b9a\u4e49\u516c\u5f0f"){}else{if(this.arr_formulas[aa].s_dump_sql!=""){af.dump_sql=this.arr_formulas[aa].s_dump_sql}s.push(aa);if(this.arr_formulas[aa].s_column_ref_back!=""){if(O!=""){O+="@"}O+=aa+"@"+this.arr_formulas[aa].s_column_ref_back;if(this.arr_formulas[aa].s_cond_sql!=""){S+=aa+"_"+this.arr_formulas[aa].i_cur_seq+";"+this.arr_formulas[aa].s_cond_sql+";"}}}X=this.arr_formulas[aa].s_db_name;if(K==null){K=[]}K.push(af)}}if(K!=null){var P=[],R=[];for(aa=0;aa<V;aa++){if(!this.arr_formulas[aa].b_to_executed){continue}if(this.arr_formulas[aa].arr_cur_column_ref!=null){for(var p=0,ad=this.arr_formulas[aa].arr_cur_column_ref.length;p<ad;p++){if(an==""||an.indexOf("a"+this.arr_formulas[aa].arr_cur_table_ref[p]+"c")==-1){var N=crsReport.crsTableIndex.get_cur_tab_name(this.arr_formulas[aa].arr_cur_table_ref[p]);if(an!=""){an+=","}an+=N}if(this.arr_formulas[aa].s_formulas_type=="\u9a8c\u8bc1\u516c\u5f0f"){R.push(this.arr_formulas[aa].arr_cur_table_ref[p]);R.push(this.arr_formulas[aa].arr_cur_column_ref[p]);R.push(this.arr_formulas[aa].i_cur_seq)}}}if(this.arr_formulas[aa].arr_fill_expr!=null){for(var p=0,ad=this.arr_formulas[aa].arr_fill_expr.length/this.arr_formulas[aa].i_fill_step;p<ad;p++){if(this.arr_formulas[aa].arr_fill_expr[p*this.arr_formulas[aa].i_fill_step+5]=="\u586b\u5165\u503c"){if(ab!=""){ab+=","}ab+=this.arr_formulas[aa].arr_fill_expr[p*this.arr_formulas[aa].i_fill_step+1]+CRSLimiter+this.arr_formulas[aa].arr_fill_expr[p*this.arr_formulas[aa].i_fill_step+2]+","+this.arr_formulas[aa].arr_fill_expr[p*this.arr_formulas[aa].i_fill_step+3]+","+this.arr_formulas[aa].arr_fill_expr[p*this.arr_formulas[aa].i_fill_step+4];if(this.arr_formulas[aa].b_do_match){P.push(this.arr_formulas[aa].arr_fill_expr[p*this.arr_formulas[aa].i_fill_step+1]);P.push(this.arr_formulas[aa].arr_fill_expr[p*this.arr_formulas[aa].i_fill_step+2]);P.push("-"+this.arr_formulas[aa].i_cur_seq)}else{if(this.arr_formulas[aa].b_has_match){if(this.arr_formulas[aa].i_match_value_fill_formulas_index>=0){P.push(this.arr_formulas[aa].arr_fill_expr[p*this.arr_formulas[aa].i_fill_step+1]);P.push(this.arr_formulas[aa].arr_fill_expr[p*this.arr_formulas[aa].i_fill_step+2]);P.push("-"+this.arr_formulas[aa].i_cur_seq)}else{P.push(this.arr_formulas[aa].arr_fill_expr[p*this.arr_formulas[aa].i_fill_step+1]);P.push(this.arr_formulas[aa].arr_fill_expr[p*this.arr_formulas[aa].i_fill_step+2]);P.push("-0")}}else{var T=-1;if(this.arr_formulas[aa].s_condition_expr!=""){var W=crsReport.crsTableIndex.get_col_kid_by_id(this.arr_formulas[aa].arr_fill_expr[p*this.arr_formulas[aa].i_fill_step+3],this.arr_formulas[aa].arr_fill_expr[p*this.arr_formulas[aa].i_fill_step+4]);T=this.arr_formulas[aa].s_condition_expr.indexOf("\u672c\u62a5\u8868."+W)}if(T==-1){P.push(this.arr_formulas[aa].arr_fill_expr[p*this.arr_formulas[aa].i_fill_step+1]);P.push(this.arr_formulas[aa].arr_fill_expr[p*this.arr_formulas[aa].i_fill_step+2]);P.push("0")}}}}}}}this.s_temp_table_list="";if(P.length>0&&!this.b_for_pivot){if(this.s_exec_time!=CRS_WRITE_EXEC){crsReport.crsTableIndex.clear_data_item(P)}if(an!=""){U=crsReport.crsTableIndex.create_cur_table_data(this.s_exec_time==CRS_DELETE_EXEC)}}else{if(an!=""){U=crsReport.crsTableIndex.create_cur_table_data(this.s_exec_time==CRS_DELETE_EXEC)}}if(R.length>0&&!this.b_for_pivot){crsReport.crsTableIndex.reset_cell_color(R)}if(this.b_for_pivot){crsReport.crsDataSet.exec_sql_list(X,K,1,ac,an,ab,O,S,window.parent.show_pivot_datas,crsReport,s,this.s_temp_table_list,U)}else{crsReport.crsDataSet.exec_sql_list(X,K,0,ac,an,ab,O,S,crsReport.fill_values,crsReport,s,this.s_temp_table_list,U)}}}};TCRSFormulasCache.prototype.end_execute=function(){if(this.arr_formulas!=null){for(var c=0,d=this.arr_formulas.length;c<d;c++){this.arr_formulas[c].b_to_executed=false;if(this.arr_formulas[c].s_dump_sql!=""&&this.arr_formulas[c].s_formulas_type!="\u9a8c\u8bc1\u516c\u5f0f"){this.arr_formulas[c].s_dump_sql=""}}}};TCRSFormulasCache.prototype.get_fill_type=function(d,e,f){return this.arr_formulas[d].get_fill_type(e,f)};TCRSFormulasCache.prototype.can_pivot=function(h){var f={b_can_pivot:false};if(!this.isEmpty()){var g=this.first();while(!this.EOF()){var e=HandleMemoStr(g.fill_expr,false);if(e!=""){if(e.indexOf("(\u586b\u5165\u503c) \u672c\u62a5\u8868."+h)!=-1&&(e.indexOf("\u5408\u8ba1(")!=-1||e.indexOf("\u8ba1\u6570(")!=-1||e.indexOf("\u5747\u503c(")!=-1||e.indexOf("\u6700\u5927\u503c(")!=-1||e.indexOf("\u6700\u5c0f\u503c(")!=-1||e.indexOf("\u6700\u665a(")!=-1||e.indexOf("\u6700\u65e9(")!=-1)){f.b_can_pivot=true;f.s_func=g.label;break}}g=this.next()}}return f};TCRSFormulasCache.prototype.has_manu_exec_func=function(){var f=false;if(!this.isEmpty()){var d=this.first();while(!this.EOF()){var e=HandleMemoStr(d.apptime,false);if(e.indexOf(CRS_MANUL_EXEC)!=-1){f=true;break}d=this.next()}}return f};function TCRSDetailPriv(f,d,e){this.crsDataSet=f;this.repId=d;if(e){TCRSDataRecord.call(this,this.crsDataSet,"crscell.crs_detailreadpriv","organid,roleid,columnlist,afilter","reportid='"+d+"'","");this.loadData("#tablecrs_detailreadpriv")}else{TCRSDataRecord.call(this,this.crsDataSet,"crscell.crs_detailwritepriv","organid,roleid,columnlist,vcolumnlist,afilter","reportid='"+d+"'","");this.loadData("#tablecrs_detailwritepriv")}}TCRSDetailPriv.prototype=new TCRSDataRecord();TCRSDetailPriv.prototype.getColumnList=function(E,F,B,w,z,D){var x="",u="";var J=true,I=true,s=false,G=false;if(!this.isEmpty()){B=","+B+F+",";z=","+z+w+",";var C=this.first();while(!this.EOF()){var A=HandleMemoStr(C.roleid,false);var H=HandleMemoStr(C.organid,false);if(A==E+"."||B.indexOf(","+H+",")!=-1||z.indexOf(","+A+",")!=-1||in_assign_user(H,A,crsReport.s_assign_user)){if(A==""||H==""||in_assign_role(A,z)||crsReport.crsDeptCache.is_dept_manager(E,H,A)){if(C.afilter!=""){if(crsReport.s_read_filter!=""){crsReport.s_read_filter+=" or "}crsReport.s_read_filter+=HandleMemoStr(C.avfilter,false)}if(crsReport.openMode=="read"){if(C.columnlist!=""&&C.columnlist!="--\u5b57\u6bb5\u5217\u8868--"){if(J){J=false}x+=HandleMemoStr(C.columnlist,false)+","}if(C.columnlist=="--\u5b57\u6bb5\u5217\u8868--"){if(!J){J=true}break}if(C.columnlist==""){if(J){J=false}}}else{if(!s){if(C.vcolumnlist!=""&&C.vcolumnlist!="--\u5b57\u6bb5\u5217\u8868--"){if(J){J=false}x+=HandleMemoStr(C.vcolumnlist,false)+","}if(C.vcolumnlist=="--\u5b57\u6bb5\u5217\u8868--"){if(!J){J=true}s=true}if(C.vcolumnlist==""){if(J){J=false}}}if(!G){if(C.columnlist!=""&&C.columnlist!="--\u5b57\u6bb5\u5217\u8868--"){if(I){I=false}u+=HandleMemoStr(C.columnlist,false)+","}if(C.columnlist=="--\u5b57\u6bb5\u5217\u8868--"){if(!I){I=true}G=true}if(C.columnlist==""){if(I){I=false}}}}}}else{if(is_ref_cell(C.roleid)){var y=crsReport.crsTableIndex.get_cell_value(C.roleid,1);y=crsReport.crsUserCache.get_id_list_by_name(y);var v=y.split(",");if(v.indexOf(crsReport.s_writer)!=-1){if(C.afilter!=""){if(crsReport.s_read_filter!=""){crsReport.s_read_filter+=" or "}crsReport.s_read_filter+=HandleMemoStr(C.afilter,false)}if(crsReport.openMode=="read"){if(C.columnlist!=""&&C.columnlist!="--\u5b57\u6bb5\u5217\u8868--"){if(J){J=false}x+=HandleMemoStr(C.columnlist,false)+","}if(C.columnlist=="--\u5b57\u6bb5\u5217\u8868--"){if(!J){J=true}break}if(C.columnlist==""){if(J){J=false}}}else{if(!s){if(C.vcolumnlist!=""&&C.vcolumnlist!="--\u5b57\u6bb5\u5217\u8868--"){if(J){J=false}x+=HandleMemoStr(C.vcolumnlist,false)+","}if(C.vcolumnlist=="--\u5b57\u6bb5\u5217\u8868--"){if(!J){J=true}s=true}if(C.vcolumnlist==""){if(J){J=false}}}if(!G){if(C.columnlist!=""&&C.columnlist!="--\u5b57\u6bb5\u5217\u8868--"){if(I){I=false}u+=HandleMemoStr(C.columnlist,false)+","}if(C.columnlist=="--\u5b57\u6bb5\u5217\u8868--"){if(!I){I=true}G=true}if(C.columnlist==""){if(I){I=false}}}}}}}C=this.next()}}if(I){}else{if(u!=""){var t=u.length;if(u.charAt(t-1)==","){u=u.substr(0,t-1)}crsReport.writeColList=u.split(",")}else{crsReport.writeColList=[]}}if(J){}else{if(x!=""){var t=x.length;if(x.charAt(t-1)==","){x=x.substr(0,t-1)}crsReport.readColList=x.split(",")}else{crsReport.readColList=[]}}};TCRSDetailPriv.prototype.get_role_list_by_organ=function(d){this.loadData();var c=this.search("organid",d);if(c!=null){return HandleMemoStr(c.roleid,false)}return""};function TCRSCodeItem(b){this.crsDataSet=b;this.b_tree_clicked=false;TCRSDataRecord.call(this,this.crsDataSet,"crscell.crs_codeitem","id, codeid, code, name, topcode","","codeid, code")}TCRSCodeItem.prototype=new TCRSDataRecord();function TCRSCodeIndex(b){this.crsDataSet=b;TCRSDataRecord.call(this,this.crsDataSet,"crscell.crs_codeindex","id, istree, refertype, allowothervalue, isparentselect","","");this.arr_codeitem=new TCRSCodeItem(b);this.obj_select_cache={}}TCRSCodeIndex.prototype=new TCRSDataRecord();TCRSCodeIndex.prototype.get_value_by_display_text=function(l,g){this.loadData("#tablecrs_codeindex");this.arr_codeitem.loadData("#tablecrs_codeitem");var f=g;var k=g.indexOf(".");if(k!=-1){g=g.substr(0,k)}var h=this.arr_codeitem.multi_search(["codeid","name"],[l,g]);if(h!=null){f=h.code}return f};TCRSCodeIndex.prototype.get_display_text_by_value=function(m,n){if(m<=0){return n}this.loadData("#tablecrs_codeindex");this.arr_codeitem.loadData("#tablecrs_codeitem");var g=n;var k=this.arr_codeitem.multi_search(["codeid","code"],[m,n]);if(k!=null){var l=this.search("id",m);var h=HandleMemoStr(l.refertype,false);if(h=="only code"){g=k.code}else{if(h=="only name"){g=k.name}else{g=k.code+"."+k.name}}}return g};TCRSCodeIndex.prototype.get_select=function(x,p){this.loadData("#tablecrs_codeindex");this.arr_codeitem.loadData("#tablecrs_codeitem");if(this.obj_select_cache[x]!=undefined){if(typeof this.obj_select_cache[x]=="object"){return""}var c=this.obj_select_cache[x];c=c.replace(" selected>",">");var w=c.indexOf("<option value='"+p+"'>");if(w!=-1){c=c.replace("<option value='"+p+"'>","<option value='"+p+"' selected>")}return c}else{var q="";var n=this.search("id",x);var v=HandleMemoStr(n.refertype,false);if(n!=null){if(n.istree!="y"){q+="<option value=''></option>";if(n.allowothervalue=="y"){q+="<option value='<\u8f93\u5165...>'><\u8f93\u5165...></option>"}var s=false;if(!this.arr_codeitem.isEmpty()){var u=this.arr_codeitem.first();while(!this.arr_codeitem.EOF()){if(u.codeid==x){var r="";var t=HandleMemoStr(u.code,false);var y=HandleMemoStr(u.name,false);if(v=="only code"){r=t}else{if(v=="only name"){r=y}else{r=t+"."+y}}if(!s&&p==t){s=true}q+="<option value='"+t+"'"+((p==t)?" selected":"")+">"+r+"</option>"}u=this.arr_codeitem.next()}}if(n.allowothervalue=="y"&&!s&&p!=""){q+="<option value='"+p+"' selected>"+p+"</option>"}}else{}}if(q!=""){this.obj_select_cache[x]=q}return q}};TCRSCodeIndex.prototype.get_tree=function(c,x,y,J,p,F,K,v){if(v==undefined){v=crsReport.obj_target_cell}var D=false;if(J==1){if(this.obj_select_cache[c]!=undefined){var H=this.obj_select_cache[c].toString();var A=H.indexOf(".set_value('")+12;var L=H.indexOf("'",A);var I=H.substring(A,L);H=H.replaceAll(I,K);if($("#id_select").length>0){$("#id_select").html(H);$("#id_select").css("left",$(v).offset().left);$("#id_select").css("top",$(v).offset().top+$(v).height());$("#id_select").show();$(document).bind("click",function(){var a=(window.event.srcElement==undefined)?window.event.target:window.event.srcElement;if(a!=undefined&&$(a).parents("#id_select").length==0){$("#id_select").hide();crsReport.crsCodeIndex.b_tree_clicked=false;$(document).unbind("click")}else{if(a!=undefined&&a.tagName!=undefined){if(a.tagName.toLowerCase()!="div"){crsReport.crsCodeIndex.b_tree_clicked=true}}}});window.event.cancelBubble=true}else{crsReport.crsCommon.crsForm.show_hint(H)}return}else{var G=this.search("id",c);F=HandleMemoStr(G.refertype,false);this.obj_select_cache[c]=new TreeView();this.obj_select_cache[c].setImagePath("/static/modules/reportshop/selecttree/images/");this.obj_select_cache[c].add(J++,p,G.name,"",null);p=1;D=true}}if(!this.arr_codeitem.isEmpty()){var B=this.arr_codeitem.first();while(!this.arr_codeitem.EOF()){if(B.codeid==c&&B.topcode==y){var E="";var n=HandleMemoStr(B.code,false);var z=HandleMemoStr(B.name,false);if(F=="only code"){E=n}else{if(F=="only name"){E=z}else{E=n+"."+z}}this.obj_select_cache[c].add(J++,p,n+"."+z,"crsReport.crsCodeIndex.set_value('"+K+"', '"+n+"', '"+E+"')",null);var C=this.arr_codeitem.cursor;J=this.get_tree(c,x,B.id,J,J-1,F,K);this.arr_codeitem.cursor=C}B=this.arr_codeitem.next()}if(D){if($("#id_select").length>0){$("#id_select").html(this.obj_select_cache[c].toString());$("#id_select").css("left",$(v).offset().left);$("#id_select").css("top",$(v).offset().top+$(v).height());$("#id_select").show();$(document).bind("click",function(){var a=(window.event.srcElement==undefined)?window.event.target:window.event.srcElement;if(a!=undefined&&$(a).parents("#id_select").length==0){$("#id_select").hide();crsReport.crsCodeIndex.b_tree_clicked=false;$(document).unbind("click")}else{if(a!=undefined&&a.tagName!=undefined){if(a.tagName.toLowerCase()!="div"){crsReport.crsCodeIndex.b_tree_clicked=true}}}});window.event.cancelBubble=true}else{crsReport.crsCommon.crsForm.show_hint(this.obj_select_cache[c].toString())}}return J}};TCRSCodeIndex.prototype.set_value=function(e,f,g){$("#"+e).val(f);$("#"+e+"_text").val(g);if($("#id_select").length>0){$("#id_select").html("");$("#id_select").hide()}else{var d=$("#select_page");d.children("div.container").html("");d.removeClass("in");$("#"+d.attr("page")).addClass("in")}$("#"+e).change()};TCRSCodeIndex.prototype.is_readonly=function(d){var c=this.search("id",d);return c.allowothervalue!="y"};function TCRSAutoCode(b){this.crsDataSet=b;TCRSDataRecord.call(this,this.crsDataSet,"crscell.crs_autocode","*","","");this.arr_cur_autocode=null}TCRSAutoCode.prototype=new TCRSDataRecord();TCRSAutoCode.prototype.get_next_autocode=function(e,g){var f="";this.loadData("#tablecrs_autocode");var h=this.search("id",e);if(h!=null){if(h.newpoint=="\u65b0\u5efa\u62a5\u8868"&&g||h.newpoint=="\u4fdd\u5b58\u62a5\u8868"&&!g){f=this.crsDataSet.get_next_autocode(e);if(this.arr_cur_autocode==null){this.arr_cur_autocode=[]}this.arr_cur_autocode.push(e);this.arr_cur_autocode.push(f)}}return f};TCRSAutoCode.prototype.roll_back=function(){if(this.arr_cur_autocode!=null){for(var d=0,e=this.arr_cur_autocode.length/2;d<e;d++){var f=this.search("id",this.arr_cur_autocode[d*2]);if(f!=null){if(f.reusetype!="\u4e0d\u53ef\u91cd\u7528"){this.crsDataSet.roll_back(f.id,this.arr_cur_autocode[d*2+1])}}}}};function TCRSDepartment(c,d){this.crsDataSet=c;TCRSDataRecord.call(this,this.crsDataSet,"department","DEPT_ID,DEPT_NAME,MANAGER,LEADER1,LEADER2","DEPT_ID='"+d+"'","")}TCRSDepartment.prototype=new TCRSDataRecord();TCRSDepartment.prototype.get_name_by_id=function(d){this.loadData("#tabledepartment");var c=this.search("DEPT_ID",d);if(c==null){var e=this.crsDataSet.get_dept_by_id(d);if(e.length>0){var f=this;$.each(e,function(a,b){f.rows.push(b)});c=e[0]}}if(c!=null){return c.DEPT_NAME}return d};TCRSDepartment.prototype.get_id_by_name=function(d){this.loadData("#tabledepartment");var c=this.search("DEPT_NAME",d);if(c==null){var e=this.crsDataSet.get_dept_by_name(d);if(e.length>0){var f=this;$.each(e,function(a,b){f.rows.push(b)});c=e[0]}}if(c!=null){return c.DEPT_ID}return d};TCRSDepartment.prototype.get_name_list_by_id=function(h){if(h!=""){var e=h.split(",");h="";for(var g=0,f=e.length;g<f;g++){if(e[g]!=""){h+=this.get_name_by_id(e[g])+","}}}return h};TCRSDepartment.prototype.get_id_list_by_name=function(h){if(h!=""){var e=h.split(",");h="";for(var g=0,f=e.length;g<f;g++){if(e[g]!=""){h+=this.get_id_by_name(e[g])+","}}}return h};TCRSDepartment.prototype.is_dept_manager=function(m,k,o){if(o!=""){var q=this.search("DEPT_ID",k);if(q!=null){var r=o.split(",");for(var p=0,l=r.length-1;p<l;p++){var n="";switch(r[p]){case"\u90e8\u95e8\u4e3b\u7ba1":n=q.MANAGER;break;case"\u4e0a\u7ea7\u4e3b\u7ba1\u9886\u5bfc":n=q.LEADER1;break;case"\u4e0a\u7ea7\u5206\u7ba1\u9886\u5bfc":n=q.LEADER2;break}if(n!=""){if((","+n).indexOf(","+m+",")!=-1){return true}}}}}return false};function TCRSChart(c,d){this.i_repid=d;this.crsDataSet=c;TCRSDataRecord.call(this,this.crsDataSet,"crscell.crs_chart","*","repid='"+d+"'","");this.obj_series_ref_col=null;this.arr_colors=["#2f7ed8","#e0522f","#ffcc00","#10cca6","#6bb61d","#f2a21a","#ff7372","#a5e8d2","#9ce810","#fff80a","#1dcfab","#858e54"];this.f_min_val=null;this.f_max_val=null;this.b_rotation=false;this.i_max_len=0}TCRSChart.prototype=new TCRSDataRecord();TCRSChart.prototype.get_chart_type=function(c){var d={s_type:"column",b_stacked:false};switch(c){case"\u67f1\u72b6\u56fe":break;case"\u6808\u67f1\u72b6\u56fe":d.b_stacked=true;break;case"\u6761\u5f62\u56fe":d.s_type="bar";break;case"\u6808\u6761\u5f62\u56fe":d.s_type="bar";d.b_stacked=true;break;case"\u6298\u7ebf\u56fe":d.s_type="line";break;case"\u997c\u72b6\u56fe":d.s_type="pie";break;case"\u9762\u79ef\u56fe":d.s_type="area";break;case"\u6808\u9762\u79ef\u56fe":d.s_type="area";d.b_stacked=true;break;case"\u6563\u70b9\u56fe":d.s_type="scatter";break;case"\u6c14\u6ce1\u56fe":d.s_type="bubble";break;case"\u96f7\u8fbe\u56fe":d.s_type="polar";break;case"\u4eea\u8868\u76d8":d.s_type="gauge";break;default:break}return d};TCRSChart.prototype.get_categories=function(m){if(m.xrange==""){if(m.category_name!=""){return m.category_name.split(",")}else{if(m.series_name!=""){return m.series_name.split(",")}return null}}var l=HandleMemoStr(m.xrange,false).split(",");var r=[];var o=0;for(var t=0,q=l.length;t<q;t++){var p=rectNameToIndex(l[t]);if(m.orientation=="toptobottom"){for(var s=p[0].y;s<=p[1].y;s++){var n=crsReport.crsCommon.get_cell_value(m.sheetindex,p[0].x,s);r.push(n);o+=r[r.length-1].length;if(this.i_max_len<r[r.length-1].length){this.i_max_len=r[r.length-1].length}}}else{for(var s=p[0].x;s<=p[1].x;s++){var n=crsReport.crsCommon.get_cell_value(m.sheetindex,s,p[0].x);r.push(n);o+=r[r.length-1].length;if(this.i_max_len<r[r.length-1].length){this.i_max_len=r[r.length-1].length}}}}if(o>50){this.b_rotation=true}return r};TCRSChart.prototype.get_series=function(k){var x=[];if(k.series_name!=""){x=k.series_name.split(",")}var t=this.get_categories(k);if(t==null){t=[]}if(this.obj_series_ref_col==null){this.obj_series_ref_col={}}this.f_max_val=null;this.f_min_val=null;var C=[],u=[{type:"pie",name:x[0]!=""?x[0]:t[0],data:[]}];var H=HandleMemoStr(k.data_range,false).split(",");for(var G=0,A=H.length;G<A;G++){var z=rectNameToIndex(H[G]);var w,D="";if(k.orientation=="toptobottom"){for(var E=z[0].x,y=G;E<=z[1].x;E++,y++){w={name:x.length>y?x[y]:"\u7cfb\u5217 "+y,data:[],dial:{}};for(var F=z[0].y,v=0;F<=z[1].y;F++,v++){D=crsReport.crsCommon.get_cell_value(k.sheetindex,E,F);if(D==""){D=0}D=parseFloat(D);w.data.push(D);u[0].data.push([t[0]!=""&&t.length>v+y?t[v+y]:(x.length>v+y?x[v+y]:"\u7cfb\u5217 "+v+y),D]);if(k.chart_type=="\u4eea\u8868\u76d8"){w.dial.backgroundColor=this.arr_colors[y];if(this.f_min_val==null||this.f_min_val>D){this.f_min_val=D}if(this.f_max_val==null||this.f_max_val<D){this.f_max_val=D}w.dataLabels={enabled:false}}this.obj_series_ref_col[w.name+"_"+v]={};D=crsReport.crsCommon.get_cell_attr(k.sheetindex,E,F,"cid");this.obj_series_ref_col[w.name+"_"+v].col=D;var B=crsReport.crsTableIndex.getAColSchema(this.obj_series_ref_col[w.name+"_"+v].col);if(B!=null){this.obj_series_ref_col[w.name+"_"+v].seq=B.get_display_seq(E,F)-1}}C.push(w)}}else{for(var E=z[0].y,y=G;E<=z[1].y;E++,y++){w={name:x.length>y?x[y]:"\u7cfb\u5217 "+y,data:[],dial:{}};for(var F=z[0].x,v=0;F<=z[1].x;F++,v++){D=crsReport.crsCommon.get_cell_value(k.sheetindex,F,E);if(D==""){D=0}D=parseFloat(D);w.data.push(D);u[0].data.push([t[0]!=""&&t.length>v+y?t[v+y]:(x.length>v+y?x[v+y]:"\u7cfb\u5217 "+v+y),D]);if(k.chart_type=="\u4eea\u8868\u76d8"){w.dial.backgroundColor=this.arr_colors[y];if(this.f_min_val==null||this.f_min_val>D){this.f_min_val=D}if(this.f_max_val==null||this.f_max_val<D){this.f_max_val=D}w.dataLabels={enabled:false}}this.obj_series_ref_col[w.name+"_"+v]={};this.obj_series_ref_col[w.name+"_"+v].col=crsReport.crsCommon.get_cell_attr(k.sheetindex,F,E,"cid");var B=crsReport.crsTableIndex.getAColSchema(this.obj_series_ref_col[w.name+"_"+v].col);if(B!=null){this.obj_series_ref_col[w.name+"_"+v].seq=B.get_display_seq(F,E)-1}}C.push(w)}}}return(k.chart_type=="\u997c\u72b6\u56fe")?u:C};TCRSChart.prototype.draw_chart=function(P){var K=P.label;var L=$("#"+K);if($(L).length<=0){var T="row"+P.ycoordinate+"column"+P.xcoordinate;var O=crsReport.obj_cell_maps[P.sheetindex][T];var A=(P.aright-P.aleft+1)+"px",S=(P.abottom-P.atop+1)+"px";A="99%";S="96%";if(crsReport.i_width>0&&false){var L='<div id="'+K+'" style="min-width:450px;min-height:350px;position: absolute;left:'+$(O).offset().left+"; top:"+$(O).offset().top+";width:"+A+"; height:"+S+';z-index:1002;margin: 0 auto"></div>'}else{var L='<div id="'+K+'" style="min-width:450px;min-height:350px;position: absolute;left:'+$(O).offset().left+"; top:"+$(O).offset().top+";width:"+A+";height:"+S+';z-index:1002;margin: 0 auto"></div>'}if(crsReport.i_width<=0&&crsReport.i_height<=0){$(O).html($(L))}else{$("body").append($(L))}L=$("#"+K)}var B=this.get_chart_type(P.chart_type);if(B.s_type=="pie"){$(L).highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:false,style:{fontFamily:"\u5b8b\u4f53",fontSize:"12px"}},title:{text:P.title,style:{fontFamily:"\u5b8b\u4f53",fontSize:"16px",fontweight:"bold"}},xAxis:{labels:{style:{fontFamily:"\u5b8b\u4f53",fontSize:"12px"}}},plotOptions:{pie:{allowPointSelect:true,cursor:"pointer",point:{events:{click:function(){var a=crsReport.crsTableIndex.get_ref_report(crsReport.crsChartCache.obj_series_ref_col[this.series.name+"_"+this.x].col,crsReport.crsChartCache.obj_series_ref_col[this.series.name+"_"+this.x].seq);if(a!=null){window.parent.link_report(a)}}}},dataLabels:{enabled:true,formatter:function(){return"<b>"+this.point.name+"</b>: "+this.y}}}},series:this.get_series(P),credits:{enabled:false},colors:this.arr_colors})}else{if(B.s_type=="gauge"){var R=this.get_series(P);var J=[];if(P.color_span!=""){var W=HandleMemoStr(P.color_span,false).split(",");for(var G=0,F=W.length;G<F;G++){var M={};var I=W[G].indexOf("-");M.from=W[G].substring(1,I);var U=W[G].indexOf("]");M.to=W[G].substring(I+1,U);var V=parseInt(W[G].substr(U+1));M.color=get_color(V);J.push(M)}N=J[0].from;Q=J[F-1].to}else{var E=0.5,C=0.5;var Q=this.f_max_val*(1+C),N=this.f_min_val*(1-E),D=Q-N;if(D==0){D=this.f_max_val}D/=3;J.push({from:N,to:N+D,color:"#DF5353"});J.push({from:N+D,to:N+2*D,color:"#DDDF0D"});J.push({from:N+2*D,to:Q,color:"#55BF3B"})}var H=P.title;if(P.title==""){H=P.series_name}$(L).highcharts({chart:{type:"gauge",plotBackgroundColor:null,plotBackgroundImage:null,plotBorderWidth:0,plotShadow:false,style:{fontFamily:"\u5b8b\u4f53",fontSize:"12px"}},title:{text:H,style:{fontFamily:"\u5b8b\u4f53",fontSize:"16px",fontweight:"bold"}},pane:{startAngle:-120,endAngle:120,background:[{backgroundColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,"#FFF"],[1,"#333"]]},borderWidth:0,outerRadius:"109%"},{backgroundColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,"#333"],[1,"#FFF"]]},borderWidth:1,outerRadius:"107%"},{},{backgroundColor:"#DDD",borderWidth:0,outerRadius:"105%",innerRadius:"103%"}]},plotOptions:{series:{cursor:"pointer",point:{events:{click:function(){var a=crsReport.crsTableIndex.get_ref_report(crsReport.crsChartCache.obj_series_ref_col[this.series.name+"_"+this.x].col,crsReport.crsChartCache.obj_series_ref_col[this.series.name+"_"+this.x].seq);if(a!=null){window.parent.link_report(a)}}}},marker:{lineWidth:1},dataLabels:{enabled:true}}},yAxis:{min:N,max:Q,minorTickInterval:"auto",minorTickWidth:1,minorTickLength:10,minorTickPosition:"inside",minorTickColor:"#666",tickPixelInterval:30,tickWidth:2,tickPosition:"inside",tickLength:10,tickColor:"#666",labels:{step:2,rotation:"auto"},plotBands:J},series:R,credits:{enabled:false},colors:this.arr_colors})}else{if(B.s_type=="polar"){var p=this.get_categories(P);var R=this.get_series(P);$(L).highcharts({chart:{polar:true,type:"line",marginRight:130,marginBottom:25,style:{fontFamily:"\u5b8b\u4f53",fontSize:"12px"}},title:{text:P.title,x:-20,style:{fontFamily:"\u5b8b\u4f53",fontSize:"16px",fontweight:"bold"}},xAxis:{categories:p,labels:{style:{fontFamily:"\u5b8b\u4f53",fontSize:"12px"}}},yAxis:{title:{text:""}},plotOptions:{series:{cursor:"pointer",point:{events:{click:function(){var a=crsReport.crsTableIndex.get_ref_report(crsReport.crsChartCache.obj_series_ref_col[this.series.name+"_"+this.x].col,crsReport.crsChartCache.obj_series_ref_col[this.series.name+"_"+this.x].seq);if(a!=null){window.parent.link_report(a)}}}},marker:{lineWidth:1},dataLabels:{enabled:(p.length*R.length<=10)?true:false}}},legend:{layout:"vertical",align:"right",verticalAlign:"top",x:-10,y:100,borderWidth:0},series:R,credits:{enabled:false},colors:this.arr_colors})}else{var p=this.get_categories(P);var R=this.get_series(P);$(L).highcharts({chart:{type:B.s_type,marginLeft:B.s_type=="bar"?this.i_max_len*13:30,marginBottom:this.b_rotation?this.i_max_len*13:30,style:{fontFamily:"\u5b8b\u4f53",fontSize:"12px"}},title:{text:P.title,x:-20,style:{fontFamily:"\u5b8b\u4f53",fontSize:"16px",fontWeight:"bolder"}},xAxis:{categories:p,labels:{rotation:(this.b_rotation&&B.s_type!="bar")?-40:0,align:"right",style:{fontFamily:"\u5b8b\u4f53",fontSize:"12px"}}},yAxis:{title:{text:""}},plotOptions:{series:{stacking:B.b_stacked?"normal":"",cursor:"pointer",point:{events:{click:function(){var a=crsReport.crsTableIndex.get_ref_report(crsReport.crsChartCache.obj_series_ref_col[this.series.name+"_"+this.x].col,crsReport.crsChartCache.obj_series_ref_col[this.series.name+"_"+this.x].seq);if(a!=null){window.parent.link_report(a)}}}},marker:{lineWidth:1},dataLabels:{enabled:(p.length*R.length<=10)?true:false}}},legend:{layout:"vertical",align:"right",verticalAlign:"top",x:-10,y:100,borderWidth:0,style:{fontFamily:'"\u5b8b\u4f53"',fontSize:"12px"}},series:R,credits:{enabled:false},colors:this.arr_colors})}}}};TCRSChart.prototype.load_chart=function(){this.loadData("#tablecrs_chart");if(!crsReport.b_as_form){if(!this.isEmpty()){crsReport.crsCommon.crsTable.crsCellControler.cache_td(0);var b=this.first();while(!this.EOF()){b.label=getColPlatKId(b.label);b.category_name=HandleMemoStr(b.category_name,false);b.series_name=HandleMemoStr(b.series_name,false);this.draw_chart(b);b=this.next()}}}};TCRSChart.prototype.update_ref=function(n,l,g,h,m){if(!this.isEmpty()){var k=this.first();while(!this.EOF()){k.data_range=update_ref(n,l,g,k.data_range,h,m);k.xrange=update_ref(n,l,g,k.xrange,h,m);k=this.next()}}};TCRSChart.prototype.refresh=function(){if(!this.isEmpty()){var b=this.first();while(!this.EOF()){this.draw_chart(b);b=this.next()}}};TCRSChart.prototype.change_type=function(d){if(!this.isEmpty()){var c=this.first();while(!this.EOF()){c.chart_type=d;this.draw_chart(c);c=this.next()}}};TCRSChart.prototype.set_chart_actions=function(){if(!this.isEmpty()){var b=this.first();while(!this.EOF()){crsReport.crsCommon.add_action_maps(["chart",b.chart_type,(b.xrange=="")?b.category_name:b.xrange,b.series_name,b.data_range,b.orientation]);b=this.next()}}};function TCRSUser(b){this.crsDataSet=b;TCRSDataRecord.call(this,this.crsDataSet,"user","USER_ID,USER_NAME,DEPT_ID,DEPT_ID_OTHER,USER_PRIV,USER_PRIV_OTHER","","")}TCRSUser.prototype=new TCRSDataRecord();TCRSUser.prototype.getUserRoleInfo=function(){this.loadData("#tableuser");info=this.first();res=[];if(!this.EOF()){res.push(info.USER_PRIV);res.push(HandleMemoStr(info.USER_PRIV_OTHER,false));res.push(info.DEPT_ID);res.push(HandleMemoStr(info.DEPT_ID_OTHER,false));res.push(this.userId)}return res};TCRSUser.prototype.get_dept_and_priv=function(f){this.loadData("#tableuser");var e={dept:"",priv:"",other_dept:"",other_priv:""};var d=this.search("USER_ID",f);if(d!=null){e.dept=d.DEPT_ID;e.priv=d.USER_PRIV;e.other_dept=HandleMemoStr(d.DEPT_ID_OTHER,false);e.other_priv=HandleMemoStr(d.USER_PRIV_OTHER,false)}return e};TCRSUser.prototype.get_name_by_id=function(c){this.loadData("#tableuser");var d=this.search("USER_ID",c);if(d==null){var e=this.crsDataSet.get_user_by_id(c);if(e.length>0){var f=this;$.each(e,function(a,b){f.rows.push(b)});d=e[0]}}if(d!=null){return d.USER_NAME}else{return c}};TCRSUser.prototype.get_id_by_name=function(d){this.loadData("#tableuser");var c=this.search("USER_NAME",d);if(c==null){var e=this.crsDataSet.get_user_by_name(d);if(e.length>0){var f=this;$.each(e,function(a,b){f.rows.push(b)});c=e[0]}}if(c!=null){return c.USER_ID}else{return d}};TCRSUser.prototype.get_name_list_by_id=function(h){if(h!=""){var e=h.split(",");h="";for(var g=0,f=e.length;g<f;g++){if(e[g]!=""){h+=this.get_name_by_id(e[g])+","}}}return h};TCRSUser.prototype.get_id_list_by_name=function(h){if(h!=""){var e=h.split(",");h="";for(var g=0,f=e.length;g<f;g++){if(e[g]!=""){h+=this.get_id_by_name(e[g])+","}}}return h};TCRSUser.prototype.get_user_list_by_priv=function(g){this.loadData("#tableuser");var f={};if(!this.isEmpty()){var h=this.first();while(!this.EOF()){var e=","+HandleMemoStr(h.USER_PRIV_OTHER,false)+h.USER_PRIV+",";if(e.indexOf(","+g+",")!=-1){f[h.USER_ID]=h.USER_NAME}h=this.next()}}return f};TCRSUser.prototype.get_user_list_by_dept=function(m,k){var h={};if(!this.isEmpty()){var l=this.first();while(!this.EOF()){var n=","+HandleMemoStr(l.DEPT_ID_OTHER,false)+l.DEPT_ID+",";var g=","+HandleMemoStr(l.USER_PRIV_OTHER,false)+l.USER_PRIV+",";if(n.indexOf(","+m+",")!=-1&&(k==""||in_assign_role(k,g)||crsReport.crsDeptCache.is_dept_manager(l.USER_ID,m,k))){h[l.USER_ID]=l.USER_NAME}l=this.next()}}return h};TCRSUser.prototype.get_long_dept_name=function(e){this.loadData("#tableuser");var b=this.search("USER_ID",e);if(b==null){var c=this.crsDataSet.get_user_by_id(e);if(c.length>0){var d=this;$.each(c,function(a,f){d.rows.push(f)});b=c[0]}}if(b!=null){if(b.long_dept_name==undefined){b.long_dept_name=this.crsDataSet.get_long_dept_name(b.DEPT_ID)}return b.long_dept_name}else{return""}};function TCRSRowProperty(p,m,l,o,r,s,q){this.i_prev_display_seq=m;this.i_display_seq=1;this.obj_col=p;this.obj_col_schema=null;this.s_userid=o;this.s_organid=l;this.s_writetime=r;this.s_title=s;this.s_memo=q;this.b_is_seq_updated=false;this.s_val="";this.arr_col_list=[];this.arr_val_list=[];this.arr_val_pro_list=[];for(var k=0,n=p.rows.length;k<n;k++){this.arr_col_list.push("col"+p.rows[k].id);this.arr_val_list.push("");this.arr_val_pro_list.push("")}}TCRSRowProperty.prototype={constructor:TCRSRowProperty,init:function(){this.b_is_seq_updated=false;this.s_val="";if(this.obj_col_schema==null){this.obj_col_schema=crsReport.crsTableIndex.getAColSchema(this.obj_col.rows[0].kid)}},calc_display_seq:function(l,k,f,h){if(this.b_is_seq_updated){return}if(k==undefined){this.i_display_seq=l}else{var g=rectNameToIndex(l);if(k=="\u4e0d\u6269\u5c55"||k=="\u6309\u884c\u5411\u4e0b"){this.i_display_seq=(h-g[0].y)/(g[1].y-g[0].y+1)+1}else{this.i_display_seq=(f-g[0].x)/(g[1].x-g[0].x+1)+1}}if(!this.b_is_seq_updated){this.b_is_seq_updated=true}if(this.i_prev_display_seq!=0&&this.i_prev_display_seq!=this.i_display_seq){if(this.s_val!=""){this.s_val+=","}this.s_val+="displayseq='"+this.i_display_seq+"'"}this.i_prev_display_seq=this.i_display_seq},add_col_value:function(g,h,e){var f=this.arr_col_list.indexOf(g);if(f!=-1){this.arr_val_list[f]=h;if(e){this.arr_val_pro_list[f]="Y"}}},update_col_value:function(c,d){if(d!=""){d=d.replaceAll("'","#005C`'");d=d.replaceAll(";",CRSSep)}if(this.s_val!=""){this.s_val+=","}if(d=="null"){this.s_val+=c+"=null"}else{this.s_val+=c+"='"+d+"'"}},get_delimited_text:function(){var f="";for(var d=0,e=this.arr_val_list.length;d<e;d++){if(d>0){f+=","}if(typeof this.arr_val_list[d]=="string"){f+="'"+this.arr_val_list[d].replaceAll("'","#005C`'").replaceAll(";",CRSSep)+"'"}else{f+="'"+this.arr_val_list[d]+"'"}}return f},is_blank:function(){var f=false;for(var d=0,e=this.arr_val_list.length;d<e;d++){if(this.arr_val_list[d]!=""&&this.arr_val_list[d]!="null"&&this.arr_val_list[d]!="0"&&(this.arr_val_pro_list[d]==""||this.arr_val_pro_list[d]==undefined)){break}}if(d>=e){f=true}return f},set_write_info:function(k,h,l,f,g){if(this.s_organid!=k){this.update_col_value("organid",k);this.s_organid=k}if(this.s_userid!=h){this.update_col_value("userid",h);this.s_userid=h}if(this.s_writetime!=l){this.update_col_value("writetime",l);this.s_writetime=l}if(this.s_title!=f){this.update_col_value("title",f);this.s_title=f}if(this.s_memo!=g){this.update_col_value("memo",g);this.s_memo=g}}};function TCRSTableProperty(){this.s_err_info="";this.arr_key_list=null;this.arr_must_list=null;this.arr_only_list=null;this.arr_val_list=null}TCRSTableProperty.prototype={constructor:TCRSTableProperty,add_key_col:function(b){if(this.arr_key_list==null){this.arr_key_list=[]}this.arr_key_list.push(b)},add_must_col:function(b){if(this.arr_must_list==null){this.arr_must_list=[]}this.arr_must_list.push(b)},add_only_col:function(b){if(this.arr_only_list==null){this.arr_only_list=[]}this.arr_only_list.push(b)},add_onrepeat_col:function(b){if(this.arr_norepeat_list==null){this.arr_norepeat_list=[]}this.arr_norepeat_list.push(b)},add_row:function(b){if(this.arr_val_list==null){this.arr_val_list=[]}this.arr_val_list.push(b)},do_check:function(K){var H=true;this.s_err_info="";var F=crsReport.crsTableIndex.rows[K];if(F.tabletype=="\u4e3b\u8868"||F.tabletype=="\u4ea4\u53c9\u8868"){if(this.arr_val_list==null){if(this.s_err_info!=""&&crsReport.b_mobile){this.s_err_info+="<br>"}this.s_err_info+="\u3010"+F.label+"\u3011\u672a\u586b\u6570\u636e\uff01\n";H=false;return H}else{if(this.arr_val_list.length>1){if(this.s_err_info!=""&&crsReport.b_mobile){this.s_err_info+="<br>"}this.s_err_info+="\u3010"+F.label+"\u3011\u542b\u591a\u6761\u6570\u636e\uff01\n";H=false;return H}}}if(this.arr_key_list!=null||this.arr_must_list!=null||this.arr_only_list!=null){if(this.arr_val_list!=null){var x=null,v=null;for(var E=0,C=this.arr_val_list.length;E<C;E++){var A=this.arr_val_list[E];if(!A.is_blank()||F.tabletype=="\u4e3b\u8868"){if(this.arr_must_list!=null){var L=false;for(var G=0,I=this.arr_must_list.length;G<I;G++){var B=this.arr_must_list[G];var w=A.arr_col_list.indexOf("col"+B.id);if(!crsReport.crsTableIndex.is_invalid(B.kid,A.i_display_seq)){if((A.arr_val_list[w]==""||A.arr_val_list[w]=="null")){if(crsReport.b_mobile){var s=crsReport.crsTableIndex.getAColSchema(B.kid);var z=s.get_cell_point(A.i_display_seq);var t=crsReport.crsTableIndex.rows[s.row_idx];crsReport.crsCommon.crsForm.set_cell_backgroud_color(t.sheetindex-1,z.x,z.y,"red");this.s_err_info+="\u3010"+F.label+"\u3011\u7b2c\u3010"+A.i_display_seq+"\u3011\u884c\u6216\u5217\u4e4b\u5fc5\u586b\u9879\u3010"+B.columnlabel+"\u3011\uff0c\u672a\u586b \uff01\n";if(!L){L=true}}else{if(this.s_err_info!=""&&crsReport.b_mobile){this.s_err_info+="<br>"}this.s_err_info+="\u3010"+F.label+"\u3011\u7b2c\u3010"+A.i_display_seq+"\u3011\u884c\u6216\u5217\u4e4b\u5fc5\u586b\u9879\u3010"+B.columnlabel+"\u3011\uff0c\u672a\u586b \uff01\n"}}else{if(crsReport.b_mobile){var s=crsReport.crsTableIndex.getAColSchema(B.kid);var z=s.get_cell_point(A.i_display_seq);var t=crsReport.crsTableIndex.rows[s.row_idx];crsReport.crsCommon.crsForm.set_cell_backgroud_color(t.sheetindex-1,z.x,z.y)}}}}if(L){this.s_err_info+="\u6807\u7ea2\u533a\u57df\u4e3a\u5fc5\u586b\uff0c\u8bf7\u586b\u5199\uff01"}}if(this.s_err_info!=""){H=false;return H}if(this.arr_key_list!=null){var D="",u="",y="";for(var G=0,I=this.arr_key_list.length;G<I;G++){var B=this.arr_key_list[G];if(y!=""){y+=","}y+=B.columnlabel;var w=A.arr_col_list.indexOf("col"+B.id);if(!crsReport.crsTableIndex.is_invalid(B.kid,A.i_display_seq)){if(D!=""){D+=" and "}if(A.arr_val_list[w]!="null"){u+=A.arr_val_list[w]+",";D+=A.arr_col_list[w]+"='"+A.arr_val_list[w]+"'"}else{D+=A.arr_col_list[w]+" is null"}}}if(x==null||x.indexOf(u)==-1){if(crsReport.crsDataSet.is_exist_key(F.id,D,crsReport.userId,crsReport.writeTime)){if(this.s_err_info!=""&&crsReport.b_mobile){this.s_err_info+="<br>"}this.s_err_info+="\u3010"+F.label+"\u3011\u7b2c\u3010"+A.i_display_seq+"\u3011\u884c\u6216\u5217\u4e4b\u4e3b\u952e\u3010"+y+"\u3011\u503c\u4e3a\u3010"+u+"\u3011\u5df2\u5b58\u5728\uff0c\u4e0d\u5141\u8bb8\u518d\u6b21\u586b\u5199 \uff01\n"}}if(x!=null&&x.indexOf(u)!=-1){if(this.s_err_info!=""&&crsReport.b_mobile){this.s_err_info+="<br>"}this.s_err_info+="\u3010"+F.label+"\u3011\u7b2c\u3010"+A.i_display_seq+"\u3011\u884c\u6216\u5217\u4e4b\u4e3b\u952e\u3010"+y+"\u3011\u503c\u4e3a\u3010"+u+"\u3011\uff0c\u91cd\u590d\u586b\u5199 \uff01\n"}else{if(x==null){x=[]}x.push(u)}}if(this.s_err_info!=""){H=false;return H}if(this.arr_only_list!=null){var u="",J="";for(var G=0,I=this.arr_only_list.length;G<I;G++){var B=this.arr_only_list[G];if(J!=""){J+=","}J+=B.columnlabel;var w=A.arr_col_list.indexOf("col"+B.id);if(!crsReport.crsTableIndex.is_invalid(B.kid,A.i_display_seq)){if(A.arr_val_list[w]!="null"){u+=A.arr_val_list[w]+","}}}if(v!=null&&v.indexOf(u)!=-1){if(this.s_err_info!=""&&crsReport.b_mobile){this.s_err_info+="<br>"}this.s_err_info+="\u3010"+F.label+"\u3011\u7b2c\u3010"+A.i_display_seq+"\u3011\u884c\u6216\u5217\u4e4b\u4e0d\u91cd\u590d\u9879\u3010"+J+"\u3011\u503c\u4e3a\u3010"+u+"\u3011\uff0c\u91cd\u590d\u586b\u5199 \uff01\n"}else{if(v==null){v=[]}v.push(u)}}if(this.s_err_info!=""){H=false;return H}}}}}if(this.s_err_info!=""){H=false}return H},init:function(){this.arr_val_list=null}};function TCRSWorkflow(c,d){this.crsDataSet=c;this.i_repid=d;TCRSDataRecord.call(this,this.crsDataSet,"crscell.crs_workflow","*","repid='"+d+"'","id")}TCRSWorkflow.prototype=new TCRSDataRecord();TCRSWorkflow.prototype.get_begin_task=function(){this.loadData("#tablecrs_workflow");var d="";var e=this.get_valid_task(crsReport.s_cur_task);if(!this.isEmpty()){var f=this.first();while(!this.EOF()){if(f.is_begin=="\u662f"){d=f.label}if(f.is_end=="\u662f"){if(e==f.label||e==""&&f.is_begin=="\u662f"){crsReport.b_is_endtask=true}}if(d!=""&&crsReport.b_is_endtask){break}f=this.next()}}return d};TCRSWorkflow.prototype.get_valid_task=function(d){var c=d.indexOf("(");if(c!=-1){return d.substr(0,c)}else{return d}};TCRSWorkflow.prototype.getColumnList=function(K,M,H,D,G,J){var N=crsReport.get_valid_cur_task();var I=this.search("label",N);if(I!=null){var v="",L="";var H=","+H+M+",";var G=","+G+D+",";if(I.column_list!=""){var O=HandleMemoStr(I.column_list,false).split("|");var A=5;var w=crsReport.crsReportState.get_prev_writer(crsReport.s_cur_task);for(var B=0,z=O.length/A;B<z;B++){var y=O[B*A],C=O[B*A+1];if(y=="0"){y=crsReport.crsUserCache.get_dept_and_priv(w).dept}if(C=="\u6d41\u7a0b\u53d1\u8d77\u4eba"&&crsReport.s_writer==crsReport.userId){if(O[B*A+4]!=""){if(crsReport.s_read_filter!=""){crsReport.s_read_filter+=" or "}crsReport.s_read_filter+=O[B*A+4]}var x=O[B*A+3];if(x!=""&&x!="--\u5b57\u6bb5\u5217\u8868--"){if(v!=""){v+=","}v+=x}var x=O[B*A+2];if(x!=""&&x!="--\u5b57\u6bb5\u5217\u8868--"){if(L!=""){L+=","}L+=x}}if(C=="\u4e0a\u4e00\u6b65\u6267\u884c\u4eba"){if(w==crsReport.s_writer){if(O[B*A+4]!=""){if(crsReport.s_read_filter!=""){crsReport.s_read_filter+=" or "}crsReport.s_read_filter+=O[B*A+4]}var x=O[B*A+3];if(x!=""&&x!="--\u5b57\u6bb5\u5217\u8868--"){if(v!=""){v+=","}v+=x}var x=O[B*A+2];if(x!=""&&x!="--\u5b57\u6bb5\u5217\u8868--"){if(L!=""){L+=","}L+=x}}}if(C==K+"."||H.indexOf(","+y+",")!=-1||G.indexOf(","+C+",")!=-1||in_assign_user(y,C,crsReport.s_assign_user)){if(C==""||y==""||in_assign_role(C,G)||crsReport.crsDeptCache.is_dept_manager(K,y,C)){if(O[B*A+4]!=""){if(crsReport.s_read_filter!=""){crsReport.s_read_filter+=" or "}crsReport.s_read_filter+=O[B*A+4]}var x=O[B*A+3];if(x!=""&&x!="--\u5b57\u6bb5\u5217\u8868--"){if(v!=""){v+=","}v+=x}var x=O[B*A+2];if(x!=""&&x!="--\u5b57\u6bb5\u5217\u8868--"){if(L!=""){L+=","}L+=x}}}if(is_ref_cell(C)){var F=crsReport.crsTableIndex.get_cell_value(C,1);F=crsReport.crsUserCache.get_id_list_by_name(F);var E=F.split(",");if(E.indexOf(crsReport.s_writer)!=-1){if(O[B*A+4]!=""){if(crsReport.s_read_filter!=""){crsReport.s_read_filter+=" or "}crsReport.s_read_filter+=O[B*A+4]}var x=O[B*A+3];if(x!=""&&x!="--\u5b57\u6bb5\u5217\u8868--"){if(v!=""){v+=","}v+=x}var x=O[B*A+2];if(x!=""&&x!="--\u5b57\u6bb5\u5217\u8868--"){if(L!=""){L+=","}L+=x}}}}}if(L!=""){crsReport.writeColList=L.split(",")}else{crsReport.writeColList=[]}if(v!=""){crsReport.readColList=v.split(",")}}};TCRSWorkflow.prototype.get_role_list_by_organ=function(n,m){var k=this.search("label",n);if(k!=null){if(k.column_list!=""){var g=HandleMemoStr(k.column_list,false).split(",");for(var l=0,h=g.length/5;l<h;l++){if(g[l*5]==m){return g[l*5+1]}}}}return""};TCRSWorkflow.prototype.get_task_candidate=function(x){var p=this.search("label",x);var I=[],y=[];var E=false;if(p==null||p.is_begin=="\u662f"){var t=null;E=true;if(crsReport.s_can_roll_back!="y"){t=crsReport.crsReportState.get_writer_list("")}if(t!=null){y=t.arr_userid;for(var B=0,z=y.length;B<z;B++){if(y[B].indexOf(".")==-1){y[B]+="."+crsReport.crsUserCache.get_name_by_id(y[B])}}}else{if(crsReport.s_write_mode!=""){I=HandleMemoStr(crsReport.s_write_organ,false).split(";");y=HandleMemoStr(crsReport.s_write_role,false).split(";")}}}else{var t=null;if(crsReport.s_can_roll_back!="y"){t=crsReport.crsReportState.get_writer_list(x)}if(t!=null){y=t.arr_userid;for(var B=0,z=y.length;B<z;B++){if(y[B].indexOf(".")==-1){y[B]+="."+crsReport.crsUserCache.get_name_by_id(y[B])}}}else{I=HandleMemoStr(p.priv_organ,false).split(",");y=HandleMemoStr(p.priv_role,false).split(",")}}var w={};if(y.indexOf("\u4e0a\u4e00\u6b65\u6267\u884c\u4eba")!=-1){w[crsReport.s_writer]=crsReport.crsUserCache.get_name_by_id(crsReport.s_writer)}if(y.indexOf("\u6d41\u7a0b\u53d1\u8d77\u4eba")!=-1){if(w[crsReport.userId]==undefined){w[crsReport.userId]=crsReport.crsUserCache.get_name_by_id(crsReport.userId)}}for(var B=0,z=y.length;B<z;B++){var H=y[B].indexOf(".");if(H!=-1){var u=y[B].substr(0,H);if(w[u]==undefined){w[u]=crsReport.crsUserCache.get_name_by_id(u)}}else{if(is_ref_cell(y[B])){var F=crsReport.crsTableIndex.getAColSchema(y[B]);var v=rectNameToIndex(F.col.rows[F.col_idx].cellspan);var C=crsReport.crsCommon.get_cell_value(0,v[0].x,v[0].y);if(C!=""){if(C.charAt(C.length-1)!=","){var u=crsReport.crsUserCache.get_id_by_name(C);if(w[u]==undefined){w[u]=C}}else{var A=C.split(",");for(var B=0,z=A.length-1;B<z;B++){if(w[A[B]]==undefined){w[A[B]]=crsReport.crsUserCache.get_name_by_id(A[B])}}}}}else{var D=crsReport.crsUserCache.get_user_list_by_priv(y[B]);for(s_key in D){if(w[s_key]==undefined){w[s_key]=D[s_key]}}}}}for(var B=0,z=I.length;B<z;B++){var G="";if(E){G=crsReport.crsPrivCache.get_role_list_by_organ(I[B])}else{G=this.get_role_list_by_organ(x,I[B])}var D=null;if(I[B]=="0"){D=crsReport.crsUserCache.get_user_list_by_dept(crsReport.s_writer_organid,G)}else{D=crsReport.crsUserCache.get_user_list_by_dept(I[B],G)}for(s_key in D){if(w[s_key]==undefined){w[s_key]=D[s_key]}}}return w};TCRSWorkflow.prototype.get_schedule=function(d){var f="\u62a2\u5148\u5f0f";this.loadData("#tablecrs_workflow");if(d==""){d=crsReport.s_begin_task}else{d=this.get_valid_task(d)}var e=this.search("label",d);if(e!=null){f=e.schedulemode;if(this.is_begin=="\u662f"){if(crsReport.s_write_mode=="y"){f="\u5e76\u5217\u5f0f"}else{if(crsReport.s_write_mode=="2"){f="\u8865\u5145\u5f0f"}}}}return f};TCRSWorkflow.prototype.get_next_task=function(_b_redirect){var obj_res=null;var s_cur_task=crsReport.s_cur_task;if(crsReport.s_cur_task==""){var s_state=crsReport.crsReportState.get_task_state(crsReport.s_cur_task,crsReport.s_writer);if(s_state!="done"&&crsReport.s_write_mode!=""){if(crsReport.s_write_mode=="y"){if(s_state=="unknown"){var obj_candidate=this.get_task_candidate(crsReport.s_begin_task);if(obj_candidate!=null&&obj_length(obj_candidate)>1){return obj_res}}else{return obj_res}}}}else{s_cur_task=this.get_valid_task(s_cur_task);var row=this.search("label",s_cur_task);if(row!=null){if(row.schedulemode=="\u4f1a\u7b7e\u5f0f"||row.schedulemode=="\u5e76\u5217\u5f0f"||(row.is_begin="\u662f"&&crsReport.s_write_mode=="y")){var s_state=crsReport.crsReportState.get_task_state(crsReport.s_cur_task,crsReport.s_writer);if(s_state==""){return obj_res}}}}if(s_cur_task==""){s_cur_task=crsReport.s_begin_task}if(!this.isEmpty()){var row=this.first();while(!this.EOF()){if(row.is_link=="\u662f"){var s_para=HandleMemoStr(row.para,false);if(s_para!=""){var p=s_para.indexOf(" "),p2=s_para.indexOf(",",p+1),p3=s_para.indexOf(" ",p2+1);var b_task=s_para.substring(0,p),e_task=s_para.substring(p2+1,p3);if(b_task==s_cur_task){var s="1";if(row.convexpr!=""&&row.convexpr!="\u624b\u52a8\u6267\u884c"){var s_where=HandleMemoStr(row.convexpr,false),s_tab="",s_from="";var obj_tab_row=crsReport.crsTableIndex.first();while(!crsReport.crsTableIndex.EOF()){var str="crscell.crs_tabledata"+obj_tab_row.id+"c";var p=s_where.indexOf(str),p2;if(p!=-1){p2=p+str.length;while(is_digit_char(s_where.charAt(p2))){p2++}str=s_where.substring(p,p2);s_tab=crsReport.crsTableIndex.get_cur_tab_name(obj_tab_row.id);if(s_from!=""){s_from+=" join "}s_from+=s_tab;s_where=s_where.replaceAll(str,s_tab)}obj_tab_row=crsReport.crsTableIndex.next()}var s_sql="",s_snapshot_sql="";if(s_from!=""){s_snapshot_sql=crsReport.crsTableIndex.create_cur_table_data(false);s_sql="select 1 as a from "+s_from+" where "+s_where}else{s_sql="select "+s_where+" as a"}s=eval(crsReport.crsDataSet.execQuery(s_sql,undefined,undefined,undefined,s_from.replaceAll(" join ",","),s_snapshot_sql))}if(s!=undefined&&(s=="1"||s.length>0&&s[0].a=="1")){var obj_u=this.get_task_candidate(e_task);if(obj_res==null){obj_res={}}var row2=this.search("label",e_task);if(row2!=null){obj_res[row2.id]={n:e_task,u:obj_u,b_only_redirect:row2.onlyredirect=="\u662f"}}}}}}row=this.next()}}return obj_res};function TCRSReportState(g,f,h,e){this.crsDataSet=g;this.i_repid=f;TCRSDataRecord.call(this,this.crsDataSet,"crscell.crs_reportstate","workflow, organidlist, useridlist, writetimelist, finishtimelist, dataflow, prevtask, prevwriter","repid='"+f+"' and userid='"+h+"' and writetime='"+e+"'","id")}TCRSReportState.prototype=new TCRSDataRecord();TCRSReportState.prototype.get_prev_writer=function(e){this.loadData("#tablecrs_reportstate");var d="";var f=this.search("workflow",e);if(f!=null){d=f.prevwriter}return d};TCRSReportState.prototype.get_task_state=function(r,k){this.loadData("#tablecrs_reportstate");var q="done";var n=this.search("workflow",r);if(n!=null){if(n.useridlist!=""){var m=HandleMemoStr(n.useridlist,false).split(",");var p=HandleMemoStr(n.finishtimelist,false).split(",");if(m.length>p.length){q=""}else{for(var o=0,l=m.length;o<l;o++){if(k!=""&&m[o]==k){continue}if(p[o]==""){q="";break}}}}}else{q="unknown"}return q};TCRSReportState.prototype.get_writer_list=function(d){var e=null;var f=this.search("workflow",d);if(f!=null){e={};e.arr_organid=HandleMemoStr(f.organidlist,false).split(",");e.arr_userid=HandleMemoStr(f.useridlist,false).split(",");e.arr_finishtime=HandleMemoStr(f.finishtimelist,false).split(",")}return e};TCRSReportState.prototype.get_done_task=function(){if(!this.doLoaded&&!crsReport.has_workflow()){this.doLoaded=true}this.loadData("#tablecrs_reportstate");var k=[];if(!this.isEmpty()){var l=this.first();while(!this.EOF()){var n=l.workflow;n=crsReport.crsWorkflow.get_valid_task(n);if(n==crsReport.s_begin_task){n=""}if(k.indexOf(n)==-1){var m=l.useridlist.split(",");var q=l.finishtimelist.split(",");var p=m.length_without_null,r=q.length_without_null;if(n==""){if(crsReport.s_write_mode=="y"){if(p<=r){k.push(n)}}else{if(r>0){k.push(n)}}}else{var o=crsReport.crsWorkflow.get_schedule(n);if(o!="\u62a2\u5148\u5f0f"){if(p<=r){k.push(n)}}else{if(r>0){k.push(n)}}}}l=this.next()}}return(k.length_without_null()<=0)?null:k};TCRSReportState.prototype.get_data_flow=function(c){this.loadData("#tablecrs_reportstate");var d=this.search("workflow",c);if(d!=null){return HandleMemoStr(d.dataflow,false).replaceAll("&gt;",">")}return""};TCRSReportState.prototype.get_prev_tasks=function(c,a){this.loadData("#tablecrs_reportstate");if(a==undefined){a=""}if(a==""){a=crsReport.s_cur_task}var b=this.search("workflow",a);if(b!=null){if(b.prevtask==""&&b.workflow!=""){$(c).append("<li onclick='rollback_report(this)'>"+crsReport.s_begin_task+"<\u521d\u59cb\u586b\u62a5></li>")}else{$(c).append("<li onclick='rollback_report(this)'>"+b.prevtask+"</li>");this.get_prev_tasks(c,b.prevtask)}}};TCRSReportState.prototype.get_write_list=function(d){var e="";var c={};var b=this.search("workflow",d);if(b!=null){c.u=b.useridlist.split(",");c.t=b.finishtimelist.split(",");for(var f=0,a=c.t.length;f<a;f++){if(c.t[f]!=""){e+=c.u[f]+","}}}return e};var CRSAt="#0040`";var CRSDQuote="#0022`";var CRSQuote="#0027`";var CRSSep="#FE54`";var CRSPercent="#0025`";var CRSBlank="#0000`";var CRSLimiter="#_#";var CRSNewLine="#0010`";var CRSEComma="#002C`";var CRSESemiColon="#003B`";var CRSColon="#002E`";var CRSSubSign="#002D`";var CRSGreaterSign="#003E`";var CRSUpRight="#007C`";var CRSUpRight1="#XX7C`";var CRSAnd="#0026`";var CRSLess="#003C`";var CRSDataSetLabel="\u6570\u636e\u6e90_";var CRSLimiter="#_#";var CRS_WRITE_EXEC="\u521d\u59cb\u586b\u62a5\u65f6\u81ea\u52a8\u6267\u884c";var CRS_EDIT_EXEC="\u4fee\u6539\u62a5\u8868\u65f6\u81ea\u52a8\u6267\u884c";var CRS_READ_EXEC="\u67e5\u9605\u62a5\u8868\u65f6\u81ea\u52a8\u6267\u884c";var CRS_CHANGE_EXEC="\u7b5b\u9009\u6761\u4ef6\u6539\u53d8\u540e\u81ea\u52a8\u6267\u884c";var CRS_SAVE_EXEC="\u4fdd\u5b58\u65f6\u81ea\u52a8\u6267\u884c";var CRS_SAVE_EXEC2="\u4fdd\u5b58\u65f6";var CRS_MANUL_EXEC="\u624b\u52a8\u6267\u884c";var CRS_DELETE_EXEC="\u5220\u9664\u65f6";var CRSSelect="LadbvmasSvo";var CRSInsert="NNvc3MeTEOE";var CRSUpdate="fZ7fKKYSyO.";var CRSDelete="0QizsF99v8.";var CRSDrop="BVX1unO7ESA";var CRSCreate="ST9zt7043Pk";String.prototype.replaceAll=stringReplaceAll;function stringReplaceAll(f,e){if(this==undefined||this==null||this==""){return this}var d=new RegExp(f.replace(/([\(\)\[\]\{\}\^\$\+\-\*\?\.\"\'\|\/\\])/g,"\\$1"),"ig");return this.replace(d,e)}String.prototype.trim=function(){return(this.replace(/^(( )|(\u3000)|\r|\n|\t)*/g,"")).replace(/(( )|(\u3000)|\r|\n|\t)*$/g,"")};Array.prototype.indexOf=quick_search;function quick_search(d){var c=new RegExp(d,[""]);return(this.toString().replace(c,"\u2522").replace(/[^,\u2522]/g,"")).indexOf("\u2522")}Array.prototype.length_without_null=length_without_null;function length_without_null(){var f=0;for(var d=0,e=this.length;d<e;d++){if(this[d]!=undefined&&this[d]!=null&&this[d]!=""){f++}}return f}function HandleMemoStr(d,c){if(c==undefined){c=true}if(d==null||d==""){return d}if(c){d=d.replaceAll("@",CRSAt);d=d.replaceAll(" ",CRSBlank);d=d.replaceAll('"',CRSDQuote);d=d.replaceAll("'",CRSQuote);d=d.replaceAll("&",CRSAnd);d=d.replaceAll(";",CRSSep);d=d.replaceAll(".",CRSColon);d=d.replaceAll("%",CRSPercent);d=d.replaceAll("\r",CRSNewLine);d=d.replaceAll("\n",CRSNewLine);d=d.replaceAll(",",CRSEComma);d=d.replaceAll("->",CRSSubSign+CRSGreaterSign);d=d.replaceAll(">",CRSGreaterSign);d=d.replaceAll("<",CRSLess)}else{d=d.replaceAll(CRSAt,"@");d=d.replaceAll(CRSBlank," ");d=d.replaceAll(CRSDQuote,'"');d=d.replaceAll(CRSQuote,"'");d=d.replaceAll(CRSAnd,"&");d=d.replaceAll(CRSSep,";");d=d.replaceAll(CRSColon,".");d=d.replaceAll(CRSPercent,"%");d=d.replaceAll(CRSNewLine,"\r");d=d.replaceAll(CRSNewLine,"\n");d=d.replaceAll(CRSEComma,",");d=d.replaceAll(CRSSubSign+CRSGreaterSign,"->");d=d.replaceAll(CRSGreaterSign,">");d=d.replaceAll(CRSLess,"<");d=d.replaceAll("&gt;",">");d=d.replaceAll("&lt;","<")}return d}function HandleMemoStr2(d,c){if(c==undefined){c=true}if(d==null||d==""){return d}if(c){d=d.replaceAll(">",CRSGreaterSign);d=d.replaceAll("<",CRSLess)}else{d=d.replaceAll(CRSGreaterSign,">");d=d.replaceAll(CRSLess,"<");d=d.replaceAll("&gt;",">");d=d.replaceAll("&lt;","<")}return d}function indexOf(h,g){for(var e=0,f=h.length;e<f;e++){if(h[e]==g){return e}}return -1}function indexOfLetter(d){var c="ABCDEFGHIJKLMNOPQRSTUVWXYZ";return c.indexOf(d)}function intPower(g,h){var e=1;for(var f=1;f<=h;f++){e*=g}return e}function columnIndexByName(f){var d=0;for(var e=f.length;e>=1;e--){d+=intPower(26,f.length-e)*(indexOfLetter(f.charAt(e-1))-indexOfLetter("A")+1)}return --d}function columnNameByIndex(b){return"ABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(b)}function cellNameToIndex(g){g=g.toUpperCase();var e={pg:"",x:-1,y:-1};var f=0;var h=g.indexOf("!");if(h!=-1){e.pg=g.substr(0,h);g=g.substring(h+1,g.length)}while(f<g.length&&g.charAt(f)>="A"&&g.charAt(f)<="Z"){f++}e.x=columnIndexByName(g.substr(0,f));e.y=parseInt(g.substr(f,g.length-f))-1;return e}function cellIndexToName(f){var d=columnNameByIndex(f.x);var e=f.y+1;return d+e}function rectNameToIndex(f){if(f.indexOf(":")==-1){f+=":"+f}var e=f.split(":");var d=[];d.push(cellNameToIndex(e[0]));d.push(cellNameToIndex(e[1]));return d}function rectIndexToName(b){return cellIndexToName(b[0])+":"+cellIndexToName(b[1])}function getColPlatKId(b){return String(b).replaceAll("{","").replaceAll("}","").replaceAll("-","")}function getColRealKId(b){return"{"+b.substr(0,8)+"-"+b.substr(8,4)+"-"+b.substr(12,4)+"-"+b.substr(16,4)+"-"+b.substr(20)+"}"}function format_text(e,d){if(e==undefined||d==""){return d}var f=crsReport.crsTableIndex.getAColSchema(e);if(f.datatype=="\u65e5\u671f\u578b"&&f.displaystyle.length>0){d=format_text_date(d,f)}if(f.datatype=="\u6570\u503c\u578b"&&f.displaystyle.length>0){d=format_text_number(d,f)}if(f.datatype=="\u8d27\u5e01\u578b"&&f.displaystyle.length>0){d=format_text_money(d,f)}if(f.datatype=="\u5b57\u7b26\u578b"&&f.displaystyle.length>0){d=d.trim()}else{if(f.datatype=="\u5b57\u7b26\u578b"){d=d.replaceAll("\n","<br>")}}return d}function format_text_money(h,g){var e="";switch(HandleMemoStr(g.displaystyle,false)){case"_($#,##0_) ($#,##0)":var f=(h>0)?number_format(h):"("+number_format(h.replaceAll("-",""))+")";e="\uffe5"+f;break;case"_($#,##0_) [Red]($#,##0)":var f=(h>0)?number_format(h):'<font color="red">('+number_format(h.replaceAll("-",""))+")</font>";e="\uffe5"+f;break;case"_($#,##0.00_) ($#,##0.00)":var f=(h>0)?number_format(h,2,".",","):"("+number_format(h.replaceAll("-",""),2,".",",")+")";e="\uffe5"+f;break;case"_($#,##0.00_) [Red]($#,##0.00)":var f=(h>0)?number_format(h,2,".",","):'<font color="red">('+number_format(h.replaceAll("-",""),2,".",",")+")</font>";e="\uffe5"+f;break;case'_($* #,##0_) _($* (#,##0) _($* "-"_) _(@_)':var f=(h>0)?number_format(h):"("+number_format(h.replaceAll("-",""))+")";e="\uffe5"+f;break;case'_(* #,##0.00_) _(* (#,##0.00) _(* "-"??_) _(@_)':var f=(h>0)?number_format(h,2,".",","):"("+number_format(h.replaceAll("-",""),2,".",",")+")";e=f;break;case'_($* #,##0.00_) _($* (#,##0.00) _($* "-"??_) _(@_)':var f=(h>0)?number_format(h,2,".",","):"("+number_format(h.replaceAll("-",""),2,".",",")+")";e="\uffe5"+f;break;case"\u5927\u5199":e=(h==0)?"\u96f6\u5706":numToCny(h);break;default:e=h}return e}function format_text_char(d,c){if(HandleMemoStr(c.displaystyle,false)&&is_blank_char(d)){d=d.replace(/\s/g,"");d=d.replace(/<\/?.+?>/g,"");d=d.replace(/[\r\n]/g,"")}return d}function format_text_date(v,q){var u="";var t="";var d="";var y="";if(v.indexOf(":")!=-1){var h=v.split(" ");var z=h[0].split("-");var w=h[1].split(":");u=w[0];t=w[1];d=w[2];y=w[3]}else{if(v.indexOf("-")!=-1){var z=v.split("-")}else{if(v.indexOf(".")!=-1){var z=v.split(".")}else{return v}}}var m=z[0];var x=z[1];var r=z[2];if(x==undefined){x=0}if(r==undefined){r=0}switch(HandleMemoStr(q.displaystyle,false)){case"yyyy\u5e74":v=m;break;case"yyyy\u5e74mm\u6708dd\u65e5":v=m+"\u5e74"+x+"\u6708"+r+"\u65e5";break;case"yyyy\u5e74mm\u6708":v=m+"\u5e74"+x+"\u6708";break;case"yyyy.mm.dd":v=m+"."+x+"."+r;break;case"yyyy.mm":v=m+"."+x;break;case"mm:ss:ms":v=t+"."+d+"."+y;break;case"m/d/yy":x=x>9?x:x.substr(1);r=r>9?r:r.substr(1);m=m.substr(2,3);v=x+"/"+r+"/"+m;break;case"dd/mm/yy":m=m.substr(2,3);v=x+"/"+r+"/"+m;break;case"dd.mmmm.yy":x=is_date_month_str(x);m=m.substr(2,3);v=r+"."+x+"."+m;break;case"d-mmm-y":x=is_date_month_str(x,1);r=r>9?r:r.substr(1);m=m.substr(3);v=r+"-"+x+"-"+m;break;case"d-mmm":x=is_date_month_str(x,1);r=r>9?r:r.substr(1);v=r+"-"+x;break;case"mmmm-yy":x=is_date_month_str(x);m=m.substr(2,3);v=x+"-"+m;break;case"h:mm AM/PM":u=u>9?u:u.substr(1);var s=u<12?"AM":"PM";v=u+":"+t+" "+s;break;case"h:mm:ss AM/PM":u=u>9?u:u.substr(1);var s=u<12?"AM":"PM";v=u+":"+t+":"+d+" "+s;break;case"h:mm":u=u>9?u:u.substr(1);v=u+":"+t;break;case"h:mm:ss":u=u>9?u:u.substr(1);v=u+":"+t+":"+d;break;case"m/d/y h:mm":r=r>9?r:r.substr(1);u=u>9?u:u.substr(1);m=m.substr(3);v=x+"/"+r+"/"+m+" "+u+":"+t+":"+d;break;case"mm:ss":v=t+":"+d;break;case"[h]:mm:ss":u=u>9?u:u.substr(1);v="["+u+"]:"+t+":"+d;break;case"mm:ss.ms":v=t+":"+d+":"+y;break}return v}function format_text_number(m,l){var n="";switch(HandleMemoStr(l.displaystyle,false)){case"0":n=number_format(m,0,".","");break;case"0.0":n=number_format(m,1,".","");break;case"0.00":n=number_format(m,2,".","");break;case"0.000":n=number_format(m,3,".","");break;case"0.0000":n=number_format(m,4,".","");break;case"0.00000":n=number_format(m,5,".","");break;case"0.000000":n=number_format(m,6);break;case"#,##0":n=number_format(m);break;case"#,##0.0":n=number_format(m,1);break;case"#,##0.00":n=number_format(m,2);break;case"#,##0.000":n=number_format(m,3);break;case"#,##0.0000":n=number_format(m,4);break;case"#,##0.00000":n=number_format(m,5);break;case"#,##0.000000":n=number_format(m,6);break;case"0%":n=number_format(m*100,0,".","")+"%";break;case"0.0%":n=number_format(m*100,1,".","")+"%";break;case"0.00%":n=number_format(m*100,2,".","")+"%";break;case"0.00E+00":if(m<0){return""}var p=m.split(".");var k=p[0].length;if(k>3){if(p[0].substr(3,1)>4){var h=p[0].substr(1,1)+(parseInt(p[0].substr(2,1))+1)}else{var h=p[0].substr(1,2)}}else{var h=p[0].substr(1,2)}var o=k-1>10?k-1:"0"+k-1;n=p[0].substr(0,1)+"."+h+"E"+o;break;case"# ?/?":n=m;break;case"# ??/??":n=m;break;case"(#,##0_) (#,##0)":n=(m>0)?number_format(m):"("+number_format(m.replaceAll("-",""))+")";break;case"(#,##0_) [Red](#,##0)":n=(m>0)?number_format(m):'<font color="red">('+number_format(m.replaceAll("-",""))+")</font>";break;case"(#,##0.00_) (#,##0.00)":n=(m>0)?number_format(m,2,".",","):"("+number_format(m.replaceAll("-",""),2,".",",")+")";break;case"(#,##0.00_) [Red](#,##0.00)":n=(m>0)?number_format(m,2,".",","):'<font color="red">('+number_format(m.replaceAll("-",""),2,".",",")+")</font>";break;case'_(* #,##0_) _(* (#,##0) _(* "-"_) _(@_)':n=(m>0)?number_format(m):"("+number_format(m.replaceAll("-",""))+")";break;case"# #0.0E+0":if(m<0){return""}var p=m.split(".");var k=p[0].length;if(k>3){if(p[0].substr(3,1)>4){var h=p[0].substr(1,1)+(parseInt(p[0].substr(2,1))+1)}else{var h=p[0].substr(1,2)}}else{var h=p[0].substr(1,2)}var o=k-1>10?k-1:"0"+k-1;n=number_format(p[0])+"."+h+"E"+o;break;default:n=m}return n}function is_digit_char(b){if(b>="0"&&b<="9"){return true}else{return false}}function is_letter_char(b){if(b.toUpperCase()>="A"&&b.toUpperCase()>="Z"){return true}else{return false}}function is_han_char(b){if(b.charCodeAt(0)>=128){return true}else{return false}}function is_blank_char(b){if(b==" "||b=="\t"||b=="\r"){return true}else{return false}}function is_id_start_char(b){if(is_letter_char(b)||is_han_char(b)||b=="@"){return true}else{return false}}function is_id_other_char(b){if(is_id_start_char(b)||IsDigitChar(b)||b=="_"){return true}else{return false}}function in_assign_user(l,p,t){var m=false;if(t!=""){var q=t.split(",");for(var d=0,o=q.length;d<o;d++){if(q[d]+"."+p){m=true;break}else{var r=crsReport.userCache.get_dept_and_priv(q[d]);var n=","+r.other_dept+r.dept+",",s=","+r.other_priv+r.priv+",";if(n.indexOf(","+l+",")!=-1||s.indexOf(","+p+",")!=-1){m=true;break}}}}return m}function in_assign_role(l,k){var m=false;if(l!=""){var n=l.split(",");for(var g=0,h=n.length;g<h;g++){if(n[g]!=""&&k.indexOf(","+n[g]+",")!=-1){m=true;break}}}return m}function is_ref_cell(b){if(b!=""&&b.charAt(0)=="{"){return true}else{return false}}function is_date_month_str(f,g){var h=["January","February","March","April","May","June","July","August","September","October","November","December"];var e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return g?e[f-1]:h[f-1]}function is_color_position(d){var c=["#000000","#FFFFFF","#FF0000","#00FF00","#0000FF","#FFFF00","#00FFFF","#FF00FF","#008000","#800000","#000080","#808000","#008080","#800080","#C0C0C0","#808080","#9999FF","#339966","#FFFFCC","#FFCCFF","#006666","#80FF80","#6600CC","#CCCCFF","#000080","#00FFFF","#FFFF00","#FF00FF","#008080","#008000","#800080","#0000FF","#CC00FF","#FFCCFF","#FFCCCC","#FFFF99","#CC99FF","#99FFCC","#99CCFF","#CCFF99","#6633FF","#CC33CC","#CC9900","#CCFF00","#99FF00","#66FF00","#666699","#969696","#330066","#993366","#330000","#333300","#339900","#339966","#333399","#333333"];return c[d]}function number_format(o,r,m,p){o=(o+"").replace(/[^0-9+\-Ee.]/g,"");var s=!isFinite(+o)?0:+o,t=!isFinite(+r)?0:Math.abs(r),k=(typeof p==="undefined")?",":p,q=(typeof m==="undefined")?".":m,l="",n=function(c,a){var b=Math.pow(10,a);return""+Math.round(c*b)/b};l=(t?n(s,t):""+Math.round(s)).split(".");if(l[0].length>3){l[0]=l[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,k)}if((l[1]||"").length<t){l[1]=l[1]||"";l[1]+=new Array(t-l[1].length+1).join("0")}return l.join(q)}function numToCny(v){var B="";var k=["\u4e07","\u4ebf","\u4e07","\u5706",""];var t={2:["\u89d2","\u5206",""],4:["\u4edf","\u4f70","\u62fe",""]};var z=["\u96f6","\u58f9","\u8d30","\u53c1","\u8086","\u4f0d","\u9646","\u67d2","\u634c","\u7396"];if(((v.toString()).indexOf(".")>16)||(isNaN(v))){return""}v=((Math.round(v*100)).toString()).split(".");v=(v[0]).substring(0,(v[0]).length-2)+"."+(v[0]).substring((v[0]).length-2,(v[0]).length);v=((Math.pow(10,19-v.length)).toString()).substring(1)+v;var w,s,x,B,y,A,u,q,r=[];for(w=0,s="";w<5;w++,x=w*4+Math.floor(w/4)){B=v.substring(x,x+4);for(y=0,A="",u=B.length;((y<u)&&(parseInt(B.substring(y),10)!=0));y++){r[y%2]=z[B.charAt(y)]+((B.charAt(y)==0)?"":t[u][y]);if(!((r[0]==r[1])&&(r[0]==z[0]))){if(!((r[y%2]==z[0])&&(A=="")&&(s==""))){A+=r[y%2]}}}q=A+((A=="")?"":k[w]);if(!((q==z[0])&&(s==""))){s+=q}}s=(s=="")?z[0]+k[3]:s;return s}function getGuidGenerator(){var b=function(){return(((1+Math.random())*65536)|0).toString(16).substring(1)};return"{"+(b()+b()+"-"+b()+"-"+b()+"-"+b()+"-"+b()+b()+b()).toUpperCase()+"}"}function update_ref(t,A,q,r,z,y){var o="";var w=r.split(",");for(var x=0,u=w.length;x<u;x++){var s=rectNameToIndex(w[x]);if(!y){var p="y"}else{var p="x"}if(z=="ins"){if(s[0][p]>=A){s[0][p]+=q;s[1][p]+=q}else{if(s[1][p]>=A){s[1][p]+=q}}if(o!=""){o+=","}o+=rectIndexToName(s)}else{if(z=="app"){if(s[0][p]>A){s[0][p]+=q;s[1][p]+=q}else{if(s[1][p]>=A){s[1][p]+=q}}if(o!=""){o+=","}o+=rectIndexToName(s)}else{if(z=="del"){if(s[1][p]<A){if(o!=""){o+=","}o+=rectIndexToName(s)}else{if(s[0][p]<A&&s[1][p]<=(A+q-1)){s[1][p]=A-1;if(o!=""){o+=","}o+=rectIndexToName(s)}else{if(s[0][p]<A&&s[1][p]>(A+q-1)){var v=s[1][p];s[1][p]=A-1;if(o!=""){o+=","}o+=rectIndexToName(s);s[1][p]=v;s[0][p]=A+q;s[0][p]-=q;s[1][p]-=q;if(o!=""){o+=","}o+=rectIndexToName(s)}else{if(s[0][p]<=A+q-1&&s[1][p]>(A+q-1)){s[0][p]=A+q;s[0][p]-=q;s[1][p]-=q;if(o!=""){o+=","}o+=rectIndexToName(s)}else{if(s[0][p]>A+q-1){s[0][p]-=q;s[1][p]-=q;if(o!=""){o+=","}o+=rectIndexToName(s)}}}}}}}}}return o}function obj_length(c){var d=0;for(s_key in c){if(c[s_key]!=undefined){d++}}return d}function get_delimiter_key(g,h){var e=0,f="";for(s_key in g){if(e>0){f+=h}f+=s_key;e++}return f}var b_showing=false;function show_hint(b){if(b_showing){return}b_showing=true;if(crsReport.b_mobile){showLoading(b)}else{$("#loading").show()}}function hide_hint(){if(!b_showing){return}b_showing=false;if(crsReport.b_mobile){hideLoading()}else{$("#loading").hide()}}function ajaxFileUpload(f,k,h,e,g){$("#loading").ajaxStart(function(){$(this).show()}).ajaxComplete(function(){$(this).hide()});$.ajaxFileUpload({url:"/general/reportshop/utils/upload.php",secureuri:false,fileElementId:f,dataType:"json",data:{action:"upload",fileid:f,filetype:k,json:1,newid:g},success:function(a,b){h(a.new_name,e)},error:function(b,c,a){crsReport.show_hint(a)},async:false});return false}function MapKey(b){if(b!=""){b=b.replaceAll("select",CRSSelect);b=b.replaceAll("insert",CRSInsert);b=b.replaceAll("update",CRSUpdate);b=b.replaceAll("delete",CRSDelete);b=b.replaceAll("create",CRSCreate);b=b.replaceAll("drop",CRSDrop)}return b}function get_color(h){var g=(h&parseInt("0x0000FF")).toString(16);if(g.length<2){g="0"+g}var e=((h&parseInt("0x00FF00"))>>8).toString(16);if(e.length<2){e="0"+e}var f=((h&parseInt("0xFF0000"))>>16).toString(16);if(f.length<2){f="0"+f}return"#"+g+e+f}function crs_decode(b){var c=base64decode(b);var h=zip_inflate(c);var a=unescape(h);return a}function crs_encode(b){var c=escape(b);var h=zip_deflate(c);var a=base64encode(h);return a}function set_statis(c,d){$.ajax({url:"/general/reportshop/utils/set_statis.php",type:"post",data:{cur_rep:crsReport.s_postfix,begin_time:c,end_time:d,repid:crsReport.repId,userid:crsReport.userId,writetime:crsReport.writeTime,openmode:crsReport.openMode},success:function(a){$("#load_time",window.parent.document).text(a)},async:true})}function getCursorPos(k){k.focus();var g=document.selection.createRange();var f=g.duplicate();k.select();var l=document.selection.createRange();var h=0;while(f.compareEndPoints("StartToStart",l)>0){f.moveStart("character",-1);h++}g.select();return h}function setCursorPos(d,f){var e=d.createTextRange();e.moveStart("character",f);e.collapse(true);e.select()}function addSeal(d,e){try{crsReport.DWebSignSeal.SetCurrUser("admin[admin]")}catch(f){crsReport.show_hint("\u7b7e\u7ae0\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u63a7\u4ef6\u662f\u5426\u6b63\u786e\u5b89\u88c5\uff01")}try{if(crsReport.DWebSignSeal.FindSeal(d+"_seal",2)!=""){crsReport.show_hint("\u60a8\u5df2\u7ecf\u7b7e\u7ae0\uff0c\u8bf7\u5148\u5220\u9664\u5df2\u6709\u7b7e\u7ae0\uff01");return}SetStore();crsReport.DWebSignSeal.SetPosition(200,200,"SIGN_POS_"+d);crsReport.DWebSignSeal.addSeal("",d+"_seal");crsReport.DWebSignSeal.SetSealSignData(d+"_seal",str);crsReport.DWebSignSeal.SetMenuItem(d+"_seal",261)}catch(f){crsReport.show_hint("\u7b7e\u7ae0\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u63a7\u4ef6\u662f\u5426\u6b63\u786e\u5b89\u88c5\uff01")}}function handWrite(e,f){try{if(typeof(f)=="string"){f=Number(f)}if(crsReport.DWebSignSeal.FindSeal(e+"_hw",2)!=""){crsReport.show_hint("\u60a8\u5df2\u7ecf\u7b7e\u7ae0\uff0c\u8bf7\u5148\u5220\u9664\u5df2\u6709\u7b7e\u7ae0\uff01");return}var g=SetStore(e);crsReport.DWebSignSeal.SetPosition(0,0,"SIGN_POS_"+e);crsReport.DWebSignSeal.HandWrite(0,f,e+"_hw");crsReport.DWebSignSeal.SetSealSignData(e+"_hw",g);crsReport.DWebSignSeal.SetMenuItem(e+"_hw",261)}catch(h){crsReport.show_hint("\u7b7e\u7ae0\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u63a7\u4ef6\u662f\u5426\u6b63\u786e\u5b89\u88c5\uff01")}}function GetDataStr(n){var q="";var m=$("#SIGN_POS_"+n);var r=$(m).attr("sign_check");if(r!=""){var k=r.split(",");for(var p=0,l=k.length;p<l;p++){if(k[p]!=""){var o=crsReport.crsCommon.get_row_seq($(m).parent("td"));q+=crsReport.crsCommon.get_cell_value(k[p],o)+"\u2522"}}}return q}function SetStore(e){try{var f=GetDataStr(e);crsReport.DWebSignSeal.SetSignData("-");crsReport.DWebSignSeal.SetSignData("+DATA:"+f)}catch(d){}return f}function TCRSCommon(b,c){this.b_as_form=b;this.b_mobile=c;this.obj_cur_editor=null;this.arr_action_maps=null;if(this.b_mobile){this.crsForm=new TCRSMobileView()}else{if(this.b_as_form){this.crsForm=new TCRSFormView()}else{this.crsTable=new TCRSTableView()}}this.b_has_excel_func=true;this.b_set_chart_actions=false;this.obj_sign_seals={}}TCRSCommon.prototype={constructor:TCRSCommon,_get_container_height:function(d){var c=crsReport.crsTableIndex.rows[d.row_idx];var b=d.get_cell_rect(1);var a="sheet"+(parseInt(c.sheetindex)-1);var f=0;for(var e=b[0].y;e<=b[1].y;e++){f+=$("#"+a).find("tr:eq("+(e)+")").height()}return f},add_action_maps:function(b){if(this.arr_action_maps==null){this.arr_action_maps=b}else{this.arr_action_maps=this.arr_action_maps.concat(b)}},draw:function(f){if(crsReport.b_has_sign_seal){$('<object classid="CLSID:77709A87-71F9-41AE-904F-886976F99E3E" style="position:absolute;width:0px;height:0px;left:0px;top:0px;display:none;" codebase="/module/websign/WebSign_trial.dll#version=4,5,0,0"></object>').appendTo($("body"));crsReport.DWebSignSeal=$("object[classid='CLSID:77709A87-71F9-41AE-904F-886976F99E3E']")[0];crsReport.DWebSignSeal.SetCurrUser(crsReport.s_writer+"["+crsReport.crsUserCache.get_name_by_id(crsReport.s_writer)+"]")}if(this.b_as_form){this.crsForm.draw_form(f)}else{this.crsTable.loadData(f)}if(crsReport.b_has_sign_seal){for(s_k in this.obj_sign_seals){crsReport.DWebSignSeal.SetStoreData(this.obj_sign_seals[s_k])}crsReport.DWebSignSeal.ShowWebSeals();var g=crsReport.DWebSignSeal.FindSeal("",0);while(g!=""){var e="";if(g.indexOf("_hw")>0){e=g.substring(0,g.indexOf("_hw"))}else{if(g.indexOf("_seal")>0){e=g.substring(0,g.indexOf("_seal"))}}if(e!=""){var h=GetDataStr(e);crsReport.DWebSignSeal.SetSealSignData(g,h);if($("#SIGN_POS_"+e).find("input[type='button']").length==0){crsReport.DWebSignSeal.SetMenuItem(g,4)}else{crsReport.DWebSignSeal.SetMenuItem(g,261)}}g=crsReport.DWebSignSeal.FindSeal(g,0)}}},get_row_seq:function(f){var h=1;if(this.b_as_form){h=this.crsForm._get_row_seq($(f).parent("tr"))}else{var g=this.crsTable.crsCellControler.get_cell_point(f);var e=crsReport.crsTableIndex.getAColSchema($(f).attr("cid"));h=e.get_display_seq(g.x,g.y)}return h},get_cell_attr:function(l,g,k,h){var f="";if(this.b_as_form){f=this.crsForm.get_cell_attr(l,g,k,h)}else{f=this.crsTable.crsCellControler.get_cell_attr(l,g,k,h)}return f},get_cell_value:function(q,n,r,s){if(s==undefined){s=false}if(r!=undefined){if(this.b_as_form){var o=this.crsForm._get_td_and_schema_by_coord(q,n,r);var l=o.td}else{var l=crsReport.crsCommon.crsTable.crsCellControler.get_cell(q,n,r)}}else{if(n!=undefined){var m=crsReport.crsTableIndex.getAColSchema(q);var k=m.get_cell_point(n);return this.get_cell_value(0,k.x,k.y)}else{var l=q}}if(l!=undefined){if(s){if($(l).children(":eq(0)").attr("type")!="hidden"){var p=$(l).children(":eq(0)").val()}else{var p=$(l).children(":eq(1)").val()}}else{var p=$(l).attr("val");if(p==undefined){p=$(l).attr("val2")}}}else{if(n!=undefined){var t=o.schema.get_display_seq(n,r);p=crsReport.crsTableIndex.get_hidden_cell_value(o.schema.kid,t)}}return p!=undefined?p:""},set_cell_value:function(s,o,q,r,l){var n={},t=false;if(q==undefined){n=s;r=o;if(this.b_as_form){l=crsReport.crsTableIndex.getAColSchema(this.crsForm._get_cid_by_td(s));t=l.col.rows[l.col_idx].has_inline_calcu=="y"}else{if(l==undefined){l=crsReport.crsTableIndex.getAColSchema($(n).attr("cid"))}t=$(n).attr("func")!=undefined}s=parseInt(crsReport.crsTableIndex.rows[l.row_idx].sheetindex)-1;var k=this.get_row_seq(n);var u=l.get_cell_point(k);o=u.x;q=u.y}else{if(this.b_as_form){n=this.crsForm._get_td_and_schema_by_coord(s,o,q);if(l==undefined){l=n.schema}n=n.td;if(crsReport.b_mobile&&$("#select_page").hasClass("in")&&$("#select_page").attr("page")=="page2"){n=$("#page2").find("div[cid='"+l.kid+"']")}t=l.col.rows[l.col_idx].has_inline_calcu=="y"}else{n=crsReport.crsCommon.crsTable.crsCellControler.get_cell(s,o,q);if(l==undefined){if($(n).attr("cid")==undefined){$(n).text(r);return}l=crsReport.crsTableIndex.getAColSchema($(n).attr("cid"))}t=$(n).attr("func")!=undefined}}if($(n).length>0){if(r!=""&&l.datatype=="\u4ee3\u7801\u578b"){if(l.codeid==-10){if(r!=""&&r.charAt(r.length-1)!=","){r=crsReport.crsDeptCache.get_id_by_name(r)+","}if($(n).children().eq(0).val()!=r){if(l.canread&&l.canwrite){if(crsReport.b_mobile){$(n).children().eq(1).text(crsReport.crsDeptCache.get_name_list_by_id(r))}else{$(n).children().eq(1).val(crsReport.crsDeptCache.get_name_list_by_id(r))}}else{}}}else{if(l.codeid==-11){if(r!=""&&r.charAt(r.length-1)!=","){r=crsReport.crsUserCache.get_id_by_name(r)+","}if($(n).children().eq(0).val()!=r){if(l.canread&&l.canwrite){if(crsReport.b_mobile){$(n).children().eq(1).text(crsReport.crsUserCache.get_name_list_by_id(r))}else{$(n).children().eq(1).val(crsReport.crsUserCache.get_name_list_by_id(r))}}else{}}}}}if(l.canread){$(n).attr("val",r)}else{$(n).attr("val2",r)}$(n).children().eq(0).val(format_text(l.kid,r));if(r!=""&&l.datatype=="\u4ee3\u7801\u578b"){if(l.codeid==-10){r=crsReport.crsDeptCache.get_name_list_by_id(r)}else{if(l.codeid==-11){r=crsReport.crsUserCache.get_name_list_by_id(r)}}}if(crsReport.b_mobile&&$("#select_page").hasClass("in")&&$("#select_page").attr("page")=="page2"){return}if(l.canread){var p=l.col.rows[l.col_idx].refrepid;if(crsReport.b_mobile&&crsReport.crsTableIndex.rows[l.row_idx].tabletype=="\u660e\u7ec6\u8868"){$(n).parent().find("em[cid='"+l.kid+"']").text(l.col.rows[l.col_idx].columnlabel+"\uff1a"+format_text(l.kid,r))}else{if(r!=""&&p!=""&&p!="0"){var m="";if(!l.canwrite){m="return;"}$(n).html("<a href='javascript:' target='_blank' onclick='crsReport.on_dblclick(event); return false;' style='text-decoration: underline' onmouseover='"+m+"crsReport.show_edit(this)'>"+format_text(l.kid,r)+"</a>")}else{if(!l.canwrite){$(n).children().eq(0).val(format_text(l.kid,r))}}}}else{}if(!t){this.add_action_maps(["set",s,o,q,r])}$(n).children().each(function(){if($(this).attr("title")!=undefined){if(l.col.rows[l.col_idx].info==""){$(this).attr("title",l.col.rows[l.col_idx].columnlabel+"\uff1a"+r)}else{$(this).attr("title",l.col.rows[l.col_idx].columnlabel+"\uff1a"+r+"\uff0c"+l.col.rows[l.col_idx].info)}}})}else{this.crsForm.set_hidden_cell_value(s,o,q,r)}},set_cell_pvalue:function(e,g,f,h){if(this.b_as_form){this.crsForm.set_cell_pvalue(e,g,f,h)}else{this.crsTable.crsCellControler.set_cell_pvalue(e,g,f,h)}},set_hidden_cell_value:function(g,h,f,e){},set_hidden_cell_pvalue:function(g,h,f,e){},set_cell_backgroud_color:function(l,n,g,k,m){if(this.b_as_form){var h=this.crsForm._get_td_by_coord(l,n,g)}else{var h=crsReport.crsCommon.crsTable.crsCellControler.get_cell(l,n,g)}if($(h).length>0){if($(h).hasClass("hide")){$(h).parent().find("em[cid='"+$(h).attr("cid")+"']").css("background-color",k!=undefined?k:"")}else{if(k!=undefined){$(h).children().css("background-color",k)}else{$(h).children().css("background-color","")}}}},clear_cell:function(f,d,e){if(this.b_as_form){this.crsForm.clear_cell(f,d,e)}else{this.crsTable.crsCellControler.clear_cell(f,d,e)}},add_option:function(c,d){this._add_option(c,d)},blur_handler:function(b){$(document).triggerHandler("click")},calculate:function(d,c){if(d==undefined){d=false}if(c==undefined){c=false}if(!c&&!crsReport.b_has_inline_calcu){return}if(this.arr_action_maps==null){return}crsReport.crsDataSet.calculate(this.arr_action_maps,this.fill_calculate_val,this,!d,c);this.arr_action_maps=null},fill_calculate_val:function(d,f,e){f.arr_action_maps=null;if(e!=undefined&&e){crsReport.crsDataSet.save_as_excel(crsReport.s_repname)}$.each(d,function(b,a){if(a!=undefined){f.set_cell_value(a.pg,a.x,a.y,a.val)}})},save_as_excel:function(){if(!this.b_set_chart_actions){this.b_set_chart_actions=true;if(crsReport.has_chart()){}}if(this.arr_action_maps==null){crsReport.crsDataSet.save_as_excel(crsReport.s_repname)}else{this.calculate(false,true)}},begin_update:function(){},end_update:function(){this.calculate();crsReport.crsChartCache.refresh()},resize:function(){if(this.b_as_form){this.crsForm.resize()}},get_cid_by_td:function(c){var d="";if(this.b_as_form){d=this.crsForm._get_cid_by_td(c)}else{d=$(c).attr("cid")}return d},get_rid_by_td:function(c){var d="";if(this.b_as_form){d=this.crsForm._get_rid_by_td(c)}else{d=$(c).parent("tr").attr("rid")}return d},get_rid_and_cid:function(f){var e="";if(this.b_as_form){e=this.crsForm._get_rid_by_td(f)+this.crsForm._get_cid_by_td(f)}else{var d=$(f).parent("tr").attr("rid");if(d==undefined){d=$(f).attr("rid")}e=d+$(f).attr("cid")}return getColPlatKId(e)},_id:function(m){if($(m).attr("id")==undefined){return}var h="td";if(crsReport.b_mobile){h="div"}var f=$(m).parent(h);if(f.length<1){f=$(m).parent().parent(h)}var g=$.md5(this.get_rid_and_cid(f));var l=$(m).attr("id");var k=l.indexOf("_t");if(k!=-1){l=l.substr(0,k)}else{k=l.indexOf("S_");if(k!=-1){l=l.substr(k+2)}}if(l!=g){$(f).children().each(function(){if($(this).attr("id")!=undefined){$(this).attr("id",$(this).attr("id").replaceAll(l,g))}if($(this).attr("name")!=undefined){$(this).attr("name",$(this).attr("name").replaceAll(l,g))}if($(this).attr("onclick")!=undefined){$(this).attr("onclick",$(this).attr("onclick").replaceAll(l,g))}if($(this).attr("href")!=undefined){$(this).attr("href",$(this).attr("href").replaceAll(l,g))}if($(this).attr("src")!=undefined){$(this).attr("src",$(this).attr("src").replaceAll(l,g))}if($(this).attr("onchange")!=undefined){$(this).attr("onchange",$(this).attr("onchange").replaceAll(l,g))}})}},_change_children:function(c,f,b){var e=this;$(c).children().each(function(){if($(this).attr("id")!=undefined){$(this).attr("id",$(this).attr("id").replaceAll(f,b))}if($(this).attr("name")!=undefined){$(this).attr("name",$(this).attr("name").replaceAll(f,b))}if($(this).attr("onclick")!=undefined){$(this).attr("onclick",$(this).attr("onclick").replaceAll(f,b))}if($(this).attr("href")!=undefined){$(this).attr("href",$(this).attr("href").replaceAll(f,b))}if($(this).attr("src")!=undefined){$(this).attr("src",$(this).attr("src").replaceAll(f,b))}if($(this).attr("onchange")!=undefined){$(this).attr("onchange",$(this).attr("onchange").replaceAll(f,b))}e._change_children(this,f,b)})},_get_editor:function(S,B,G){if(G==undefined){G={val:""}}var N=B.col.rows[B.col_idx];if(!B.canwrite&&!B.canread){if(N.datatype=="\u81ea\u52a8\u7f16\u53f7"){if(G!=undefined&&G.val==""){G.val=crsReport.crsAutoCode.get_next_autocode(N.codeid,true)}}if(N.codeid=="-10"){if(G.val!=""){if(G.val.charAt(G.val.length-1)==","){}else{G.val+=",";G.val=crsReport.crsDeptCache.get_id_list_by_name(G.val)}}}else{if(N.codeid=="-11"){if(G.val!=""){if(G.val.charAt(G.val.length-1)==","){}else{G.val+=",";G.val=crsReport.crsUserCache.get_id_list_by_name(G.val)}}}}return""}var A="";if(B.canread&&G!=undefined){A=G.val;if(A!=""){A=format_text(N.kid,A)}}if(N.info!=""){var K=N.info}else{var K=(A==""?N.columnlabel:N.columnlabel+"\uff1a"+A)}var V="";var T=$.md5(getColPlatKId(S+N.kid));if(B.canwrite){if(N.datatype=="\u65e5\u671f\u578b"){var M="yyyy-MM-dd";if(N.displaystyle=="yyyy\u5e74mm\u6708dd\u65e5"||N.displaystyle=="yyyy-mm-dd"||N.displaystyle=="yyyy.mm.dd"){}else{if(N.displaystyle=="yyyy\u5e74mm\u6708"||N.displaystyle=="yyyy-mm"||N.displaystyle=="yyyy.mm"){M="yyyy-MM"}else{if(N.displaystyle=="yyyy\u5e74"){M="yyyy"}else{if(N.displaystyle=="h:mm:ss"){M="HH:mm:ss"}else{if(N.displaystyle=="mm"){M="MM"}else{if(N.displaystyle=="dd"){M="dd"}else{M="yyyy-MM-dd HH:mm:ss"}}}}}}var P="";if(this.b_mobile){P="readonly"}V+='<input title="'+K+'" class="InputField Width90 dateField" onclick="if(crsReport.crsCommon._do_editor_active2(this)){WdatePicker({dateFmt:\''+M+"'});WdatePicker({dateFmt:'"+M+'\'});}" onfocus="$(this).addClass(\'InputFocus\');" onblur="$(this).removeClass(\'InputFocus\');" type="text" value="'+A+'" '+P+">"}else{if(N.datatype=="\u4ee3\u7801\u578b"){if(N.codeid=="-10"){if(A!=""){if(A.charAt(A.length-1)==","){A=crsReport.crsDeptCache.get_name_list_by_id(A)}else{A+=",";G.val=crsReport.crsDeptCache.get_id_list_by_name(A)}}if(this.b_mobile){V+='<input value="'+G.val+'" name="'+T+'" type="hidden" id="'+T+'" onchange="crsReport.crsCommon._do_editor_deactive(this);"/><span id="'+T+'_text">'+A+'</span><span></span><button type="button" action="selectdept" >\u9009\u62e9</button>'}else{V+='<input type="hidden" name="'+T+'" id="'+T+'" value="'+G.val+'" onchange="crsReport.crsCommon._do_editor_deactive(this);"/><input type="text" name="'+T+'_text" id="'+T+'_text" value="'+A+'" class="InputField Width90 userField" onmouseenter="crsReport.crsCommon._id(this);"onfocus="$(this).addClass(\'InputFocus\');" onblur="$(this).removeClass(\'InputFocus\');$(this).parent(\'td\').children().eq(0).change();"onclick="SelectDept(\'\', \''+T+"', '"+T+"_text', '', this.form.name);\" title=\""+K+'" readonly" ><a href="javascript:" onclick="document.getElementById(\''+T+"').value = '';document.getElementById('"+T+"_text').value='';$(this).parent('td').children().eq(0).change();return false;\" class=\"ref-delete-handle inline-block\"></a>"}}else{if(N.codeid=="-11"){if(A!=""){if(A.charAt(A.length-1)==","){A=crsReport.crsUserCache.get_name_list_by_id(A)}else{A+=",";G.val=crsReport.crsUserCache.get_id_list_by_name(A)}}if(this.b_mobile){V+='<input value="'+G.val+'" name="'+T+'" type="hidden" id="'+T+'" onchange="crsReport.crsCommon._do_editor_deactive(this);"/><span id="'+T+'_text">'+A+'</span><span></span><button type="button" action="selectuser" >\u9009\u62e9</button>'}else{V+='<input type="hidden" name="'+T+'" id="'+T+'" value="'+G.val+'" onchange="crsReport.crsCommon._do_editor_deactive(this);"/><input type="text" name="'+T+'_text" id="'+T+'_text" value="'+A+"\" class=\"InputField Width90 userField\" onmouseenter=\"crsReport.crsCommon._id(this);\"onfocus=\"$(this).addClass('InputFocus');\" onblur=\"$(this).removeClass('InputFocus');$(this).parent('td').children().eq(0).change();\"onclick=\"SelectUser('', '', '"+T+"', '"+T+"_text', '', this.form.name);\" title=\""+K+'" readonly" ><a href="javascript:" onclick="document.getElementById(\''+T+"').value = '';document.getElementById('"+T+"_text').value='';$(this).parent('td').children().eq(0).change();return false;\" class=\"ref-delete-handle inline-block\" ></a>"}}else{if(parseInt(N.codeid)>0){var F=crsReport.crsCodeIndex.get_select(N.codeid,A);if(F==""){var O="";if(crsReport.crsCodeIndex.is_readonly(N.codeid)){O="readOnly"}var L=crsReport.crsCodeIndex.get_display_text_by_value(N.codeid,A);V+='<input type="hidden" name="'+T+'" id="'+T+'" value="'+A+'" onchange="crsReport.crsCommon._do_editor_deactive(this);"/><input class="InputField Width90 userField" onmouseenter="crsReport.crsCommon._id(this);" onfocus="$(this).addClass(\'InputFocus\');" onblur="$(this).removeClass(\'InputFocus\');"'+O+' id="'+T+'_text" name="" size="20" class="BigInput" value="'+L+'" onclick="crsReport.crsCodeIndex.get_tree('+N.codeid+", '', 0, 1, 0, '', '"+T+"', this);\" onchange=\"$(this).parent('td').children().eq(0).val($(this).val());$(this).parent('td').children().eq(0).change();\" ><a href=\"javascript:\" onclick=\"$('#"+T+"').val('');$('#"+T+"_text').val('');$(this).parent('td').children().eq(0).change();\" class=\"ref-delete-handle inline-block\" ></a>"}else{V+='<select onchange="crsReport.crsCommon._do_editor_deactive(this);">'+F+"</select>"}}else{if(N.codeid!=""){var X=HandleMemoStr(N.codeid,false).split("|");var R="";var E=false;for(var Q=0,H=X.length;Q<H;Q++){if(Q==0&&X[0]!=""){R+="<option value=''></option><option value='<\u8f93\u5165...>'><\u8f93\u5165...></option>"}var O=HandleMemoStr(X[Q],false);if(O==A){if(!E){E=true}R+="<option value='"+O+"' selected>"+O+"</option>"}else{R+="<option value='"+O+"'>"+O+"</option>"}}if(!E&&A!=""){R+="<option value='"+A+"' selected>"+A+"</option>"}V+='<select onchange="crsReport.crsCommon._do_editor_deactive(this);">'+R+"</select>"}}}}}else{if(N.datatype=="\u903b\u8f91\u578b"){var U="";if(B.col.arr_radio_group!=undefined){for(var J=0,H=B.col.arr_radio_group.length;J<H;J++){if(B.col.arr_radio_group[J].indexOf(N.kid)!=-1){U=B.col.arr_radio_group[J];break}}}if(U!=""){V+='<input type="radio" name="'+S+U+'" title="'+N.columnlabel+'" id="'+T+'" '+((A=="\u221a")?"checked":"")+">"+N.columnlabel+"</input>"}else{V+='<input type="checkbox" title="'+N.columnlabel+'" id="'+T+'" '+((A=="\u221a")?"checked":"")+' onchange="crsReport.crsCommon._do_editor_deactive(this)">'+N.columnlabel+"</input>"}}else{if(N.datatype=="\u81ea\u52a8\u7f16\u53f7"){if(G.val==""){G.val=crsReport.crsAutoCode.get_next_autocode(N.codeid,true);if(B.canread){A=G.val}}V+='<input title="'+K+'" class="InputField Width90 " onfocus="$(this).addClass(\'InputFocus\')" type="text" maxlength="100" onblur="$(this).removeClass(\'InputFocus\');" readonly value=\''+A+"'>"}else{if(N.datatype=="\u9644\u4ef6\u578b"){if(A!=""){var s=A.indexOf("_");var I=A.substr(s+1);G.val=I;if(this.b_mobile){if(0&&crsReport.mobilestyle==1){V+="<a id='"+T+"' href='javascript:' target='_blank' title='\u5355\u51fb\u6253\u5f00\u9644\u4ef6' onclick='view_attachment(\"/attachment/reportshop/attachment/"+A+"\")'>"+I+'</a><button type="button" action="addfile">\u4e0a\u4f20\u9644\u4ef6</button>'}else{V+="<a id='"+T+"' href='/attachment/reportshop/attachment/"+A+"' target='_blank' title='\u5355\u51fb\u6253\u5f00\u9644\u4ef6'>"+I+'</a><button type="button" action="addfile">\u4e0a\u4f20\u9644\u4ef6</button>'}}else{V+="<a href='/attachment/reportshop/attachment/"+A+"' target='_blank' title='\u5355\u51fb\u6253\u5f00\u9644\u4ef6' onmouseover='crsReport.show_delete(this)' >"+I+"</a>"}}else{if(this.b_mobile){V+='<a id="'+T+'" href="javascript:" target="_blank"></a><button type="button" action="addfile">\u4e0a\u4f20\u9644\u4ef6</button>'}else{V+='<a class="addfile" href="javascript:;">\u9009\u62e9\u9644\u4ef6<input class="addfile" hidefocus="true" type="file" size="1" id="'+T+'" name="'+T+'" onchange="crsReport.submit_attach(\''+T+"', $(this).parent().parent(), '"+getColPlatKId(S+N.kid)+'\');" onclick="crsReport.crsCommon._id(this);"></a>'}}}else{if(N.datatype=="\u56fe\u7247\u578b"){if(A!=""){var Y=A.split(" ");var C=parseInt(Y[4])-parseInt(Y[2]),W=parseInt(Y[5])-parseInt(Y[3]);if(crsReport.openMode!="read"){C-=20}if(this.b_mobile){V+='<img id="'+T+'" class="uploadimg" src="/attachment/reportshop/images/'+Y[0]+'"><button type="button" action="addimg">\u4e0a\u4f20\u56fe\u7247</button>'}else{V+="<img src='/attachment/reportshop/images/"+Y[0]+"' width='"+C+"' height='"+W+"' ondblclick='window.parent.float_image(this)' title='\u53cc\u51fb\u653e\u5927\u9884\u89c8' onmouseover='crsReport.show_delete(this)' />"}G.val=Y[0]}else{if(this.b_mobile){V+='<img id="'+T+'" class="uploadimg"><button type="button" action="addimg">\u4e0a\u4f20\u56fe\u7247</button>'}else{V+='<a class="addfile" href="javascript:;">\u9009\u62e9\u56fe\u7247<input class="addfile" hidefocus="true" type="file" size="1" id="'+T+'" name="'+T+'" accept="image/*" onchange="crsReport.submit_picture(\''+T+'\', $(this).parent().parent());" onclick="crsReport.crsCommon._id(this);"></a>'}}}else{if(N.datatype=="\u624b\u5199\u7b7e\u7ae0"){V+=this._get_sign_seal(T,HandleMemoStr(N.radiogroup,false),B.canwrite);if(A!=""){this.obj_sign_seals[T]=A}}else{var D=N.refrepid;if(A!=""&&D!=""&&D!="0"){V+="<a href='javascript:' target='_blank' onclick='crsReport.on_dblclick(event); return false;' style='text-decoration: underline' onmouseover='crsReport.show_edit(this)'>"+A+"</a>"}else{if(N.datatype=="\u6587\u672c\u578b"){var t=this._get_container_height(B);t=Math.floor(t/15);if(t<1){t=1}V+='<textarea title="'+K+'" class="InputField Width90 " onfocus="$(this).addClass(\'InputFocus\');crsReport.crsCommon._do_editor_active(this);" onblur="$(this).removeClass(\'InputFocus\');crsReport.crsCommon._do_editor_deactive(this);" rows='+t+">"+A+"</textarea>"}else{V+='<input title="'+K+'" class="InputField Width90 " onfocus="$(this).addClass(\'InputFocus\');crsReport.crsCommon._do_editor_active(this);" type="text" maxlength="100" value="'+A+'" onblur="$(this).removeClass(\'InputFocus\');crsReport.crsCommon._do_editor_deactive(this);" '+(B.ismust?'placeholder="\u5fc5\u586b"':"")+">"}}}}}}}}}}else{if(N.datatype=="\u81ea\u52a8\u7f16\u53f7"&&G!=undefined&&G.val==""){G.val=crsReport.crsAutoCode.get_next_autocode(N.codeid,true);if(B.canread){A=G.val}}if(N.datatype=="\u903b\u8f91\u578b"){V+='<input type="checkbox" title="'+N.columnlabel+'" '+(this.b_mobile?'style="border-bottom:0px;padding-top:6px;"':"")+((A=="\u221a")?"checked":"")+" disabled>"+N.columnlabel+"</input>"}else{if(A!=""){if(N.datatype=="\u9644\u4ef6\u578b"){var s=A.indexOf("_");var I=A.substr(s+1);G.val=I;if(0&&crsReport.b_mobile&&crsReport.mobilestyle==1){V+="<a href='javascript:' target='_blank' title='\u5355\u51fb\u6253\u5f00\u9644\u4ef6' onclick='view_attachment(\"/attachment/reportshop/attachment/"+A+"\")'>"+I+"</a>"}else{V+="<a href='/attachment/reportshop/attachment/"+A+"' target='_blank' title='\u5355\u51fb\u6253\u5f00\u9644\u4ef6'>"+I+"</a>"}}else{if(N.datatype=="\u56fe\u7247\u578b"){var Y=A.split(" ");var C=parseInt(Y[4])-parseInt(Y[2]),W=parseInt(Y[5])-parseInt(Y[3]);G.val=Y[0];V+="<img src='/attachment/reportshop/images/"+Y[0]+"' width='"+C+"' height='"+W+"' ondblclick='window.parent.float_image(this)' title='\u53cc\u51fb\u653e\u5927\u9884\u89c8'/>"}else{if(N.datatype=="\u624b\u5199\u7b7e\u7ae0"){V+=this._get_sign_seal(T,HandleMemoStr(N.radiogroup,false),B.canwrite);this.obj_sign_seals[T]=A}else{if(N.datatype=="\u4ee3\u7801\u578b"){if(N.codeid=="-10"){if(A!=""){if(A.charAt(A.length-1)==","){A=crsReport.crsDeptCache.get_name_list_by_id(A)}else{A+=",";G.val=crsReport.crsDeptCache.get_id_list_by_name(A)}}}else{if(N.codeid=="-11"){if(A.charAt(A.length-1)==","){A=crsReport.crsUserCache.get_name_list_by_id(A)}else{A+=",";G.val=crsReport.crsUserCache.get_id_list_by_name(A)}}else{if(parseInt(N.codeid)>0){A=crsReport.crsCodeIndex.get_display_text_by_value(N.codeid,A)}}}V+='<input title="'+K+'" class="InputField Width90 " type="text" maxlength="100" value="'+A+'"  readOnly '+(this.b_mobile?'style="border-bottom:0px;padding-top:6px;"':"")+">"}else{var D=N.refrepid;if(A!=""&&D!=""&&D!="0"){V+="<a href='javascript:' target='_blank' onclick='crsReport.on_dblclick(event); return false;' style='text-decoration: underline'>"+A+"</a>"}else{if(N.datatype=="\u6587\u672c\u578b"){var t=this._get_container_height(B);t=Math.floor(t/15);if(t<1){t=1}V+='<textarea title="'+K+'" class="InputField Width90" rows='+t+">"+A+"</textarea>"}else{V+='<input title="'+K+'" class="InputField Width90" type="text" maxlength="100" value="'+A+'"  readOnly '+(this.b_mobile?'style="border-bottom:0px;padding-top:6px;"':"")+">"}}}}}}}else{V+='<input title="'+K+'" class="InputField Width90 " type="text" maxlength="100" readOnly '+(this.b_mobile?'style="border-bottom:0px;padding-top:6px;"':"")+">"}}}return V},_add_option:function(l,h,m){if(m==undefined){m=false}var k=false;var g=0;$(l).children().each(function(){if($(this).text()==h){k=true;return false}g++});if(!k){var n="<option value='"+h+"'>"+h+"</option>";$(l).append(n);if(m){$(l)[0].selectedIndex=$(l).children().length-1}}},_do_editor_active2:function(b){if(b.tagName!=undefined&&b.tagName.toLowerCase()=="input"){this._do_editor_active(b);this.obj_cur_editor=b;$(document).one("click",function(a){crsReport.crsCommon._do_editor_deactive(crsReport.crsCommon.obj_cur_editor);crsReport.crsCommon.obj_cur_editor=null});window.event.cancelBubble=true;return true}},_do_editor_deactive2:function(b){},_do_editor_active:function(d){if(null!=this.obj_cur_editor&&d!=this.obj_cur_editor){$(document).triggerHandler("click")}var a=$(d).parent();if($(a).attr("val")!=undefined){if($(a).attr("val")!=$(d).val()){$(d).val($(a).attr("val"))}else{}}},_do_editor_deactive:function(q){if(q==undefined){return}var A=$(q).parent();var w=$(A).parent();var v="input";if(typeof q=="string"){}else{if(q.tagName!=undefined){v=q.tagName.toLowerCase()}}if(v=="input"||v=="select"||v=="textarea"){var y="";if(typeof q=="string"){y=q}else{if($(q).attr("type")=="radio"||$(q).attr("type")=="checkbox"){y=q.checked?"\u221a":""}else{if(v=="textarea"){y=$(q).text()}else{y=$(q).val();if(y==""){y=$(q).attr("val");if(y==undefined){y=""}}}}if(y=="<\u8f93\u5165...>"){$(q).hide();var p='<input class="InputField Width90" onfocus="this.className=\'InputFocus Width90\'" onblur="this.className=\'InputField Width90\';crsReport.crsCommon._do_editor_deactive(this);crsReport.crsCommon._add_option($(this).parent(\'td,div\').children().eq(0), $(this).val(), true);$(this).parent(\'td,div\').children().eq(0).show();$(this).remove();" size="20" class="BigInput" value="'+(($(A).attr("val")==undefined)?"":$(A).attr("val"))+'">';$(A).append(p);return}}var t=$(A).attr("cid");if(t==undefined){t=$(A).attr("aria-describedby");if(t!=undefined){var B=t.indexOf("{");if(B==-1){}t=t.substr(B)}}var r=crsReport.crsTableIndex.getAColSchema(t);var u=r.check_value(y);if(u!=""){crsReport.show_hint(u);return}var z=false;if($(A).attr("val")==undefined||$(A).attr("val")!=y){z=true}var x=crsReport.crsTableIndex.rows[r.row_idx];var s=format_text(t,y);$(q).val(s);if($(q).attr("title")!=undefined){if(r.col.rows[r.col_idx].info==""){$(q).attr("title",r.col.rows[r.col_idx].columnlabel+"\uff1a"+s)}else{$(q).attr("title",r.col.rows[r.col_idx].columnlabel+"\uff1a"+s+"\uff0c"+r.col.rows[r.col_idx].info)}}if(crsReport.b_mobile&&$(q).parents("#page2").length>0){$(A).attr("val",y);return}if(crsReport.b_as_form){var C=crsReport.crsCommon.crsForm._get_row_seq(w);var D=r.get_cell_point(C)}else{var D=crsReport.crsCommon.crsTable.crsCellControler.get_cell_point(A);var C=r.get_display_seq(D.x,D.y)}this.set_cell_value(parseInt(x.sheetindex)-1,D.x,D.y,y);if(z){crsReport.crsFormulasCache.execute_formulas(crsReport.get_valid_cur_task(),CRS_CHANGE_EXEC,0,t,C,"",false,false,false);crsReport.crsFormulasCache.execute_formulas(crsReport.get_valid_cur_task(),CRS_CHANGE_EXEC,0,t,C,"",true,false,false)}}},_get_sign_seal:function(f,d,e){if(e){return'<div class="websign" id="SIGN_POS_'+f+'" sign_check="'+d+'" onmouseenter="crsReport.crsCommon._id(this)"><div id="'+f+'_hw"></div><textarea class="BigStatic Width90" wrap="yes" readonly style="vertical-align:middle;"></textarea>&nbsp;<input class="SmallButtonA" onclick="addSeal(\''+f+'\');" type="button" value="\u76d6\u7ae0"><input class="SmallButtonA" onclick="handWrite(\''+f+'\',\'0x0000FF\');" type="button" value="\u624b\u5199"></div>'}else{return'<div class="websign" id="SIGN_POS_'+f+'" sign_check="'+d+'" onmouseenter="crsReport.crsCommon._id(this)"><div id="'+f+'_hw"></div><textarea class="BigStatic Width90" wrap="yes" readonly style="vertical-align:middle;"></textarea></div>'}}};function TCRSMobileView(b){this.obj_detail_dump_row={};this.arr_action_maps=null;this.obj_coord_to_kid_map=null;this.obj_cur_editor=null;this.i_default_height=200;this.obj_next=null}TCRSMobileView.prototype={constructor:TCRSMobileView,set_coord_to_kid_map:function(){this.obj_coord_to_kid_map={};if(!crsReport.crsTableIndex.isEmpty()){var l=crsReport.crsTableIndex.first();while(!crsReport.crsTableIndex.EOF()){if(this.obj_coord_to_kid_map[l.sheetindex-1]==undefined){this.obj_coord_to_kid_map[l.sheetindex-1]={}}var o=crsReport.crsTableIndex.getColumn(l.id);if(l.tabletype=="\u4e3b\u8868"){if(this.obj_coord_to_kid_map[l.sheetindex-1]["m"]==undefined){this.obj_coord_to_kid_map[l.sheetindex-1]["m"]={}}if(!o.isEmpty()){var k=o.first();while(!o.EOF()){var p=crsReport.crsTableIndex.getAColSchema(k.kid);var m=p.display_rect;this.obj_coord_to_kid_map[l.sheetindex-1]["m"][m[0].x+"_"+m[0].y]=p;k=o.next()}}}else{if(l.tabletype=="\u660e\u7ec6\u8868"){if(this.obj_coord_to_kid_map[l.sheetindex-1]["d"]==undefined){this.obj_coord_to_kid_map[l.sheetindex-1]["d"]=[]}if(!o.isEmpty()){var k=o.first();while(!o.EOF()){var p=crsReport.crsTableIndex.getAColSchema(k.kid);var m=p.display_rect;var h={};if(l.expandtype=="\u6309\u884c\u5411\u4e0b"||l.expandtype=="\u4e0d\u6269\u5c55"){var n=m[1].y-m[0].y+1;h={x1:m[0].x,y1:m[0].y,x2:m[1].x,y2:m[1].y+(l.initcz-1)*n,col:p}}this.obj_coord_to_kid_map[l.sheetindex-1]["d"].push(h);k=o.next()}}this.auto_increment(l,o)}}l=crsReport.crsTableIndex.next()}}},_get_td_by_coord:function(s,o,p,v){var n=null,q=null;if(v==undefined){v=false}if(this.obj_coord_to_kid_map!=undefined){if(this.obj_coord_to_kid_map[s]!=undefined){if(this.obj_coord_to_kid_map[s]["m"]!=undefined){q=this.obj_coord_to_kid_map[s]["m"][o+"_"+p];if(q!=undefined){if(v){return q}var r=crsReport.crsTableIndex.rows[q.row_idx];n=$("#main_tab_"+r.id+" div[cid='"+q.kid+"']")}}if(n==null){if(this.obj_coord_to_kid_map[s]["d"]!=undefined){for(var u=0,t=this.obj_coord_to_kid_map[s]["d"].length;u<t;u++){var w=this.obj_coord_to_kid_map[s]["d"][u];if(w.x1<=o&&w.x2>=o&&w.y1<=p&&w.y2>=p){q=w.col;if(v){return q}var y=q.get_display_seq(o,p);var r=crsReport.crsTableIndex.rows[q.row_idx];var x=$("#detail_tab_"+r.id).children("div.tag-RListField").eq(y-1);n=$(x).children("div[cid='"+q.kid+"']");break}}}}}}return n},_get_td_and_schema_by_coord:function(q,m,n){var k={};if(this.obj_coord_to_kid_map!=undefined){if(this.obj_coord_to_kid_map[q]!=undefined){if(this.obj_coord_to_kid_map[q]["m"]!=undefined){k.schema=this.obj_coord_to_kid_map[q]["m"][m+"_"+n];if(k.schema!=undefined){var p=crsReport.crsTableIndex.rows[k.schema.row_idx];k.td=$("#main_tab_"+p.id+" div[cid='"+k.schema.kid+"']")}}if(k.schema==undefined){if(this.obj_coord_to_kid_map[q]["d"]!=undefined){for(var r=0,o=this.obj_coord_to_kid_map[q]["d"].length;r<o;r++){var s=this.obj_coord_to_kid_map[q]["d"][r];if(s.x1<=m&&s.x2>=m&&s.y1<=n&&s.y2>=n){k.schema=s.col;if($("#page2").css("display")!="none"){k.td=$("#page2").find("div[cid='"+s.col.kid+"']")}else{var u=k.schema.get_display_seq(m,n);var p=crsReport.crsTableIndex.rows[k.schema.row_idx];var t=$("#page1 #detail_tab_"+p.id).children("div.tag-RListField").eq(u-1);k.td=$(t).children("div[cid='"+s.col.kid+"']")}break}}}}}}if(k.td!=undefined&&k.td.length<1){k.td=undefined}return k},_add_action_maps:function(b){if(!crsReport.b_has_inline_calcu){return}if(this.arr_action_maps==null){this.arr_action_maps=b}else{this.arr_action_maps=this.arr_action_maps.concat(b)}},calculate:function(d,c){if(d==undefined){d=false}if(this.arr_action_maps==null){return}d=!d;crsReport.crsDataSet.calculate(this.arr_action_maps,this._fill_calculate_val,this,d,c);this.arr_action_maps=null},_fill_calculate_val:function(d,f,e){f.arr_action_maps=null;if(e!=undefined&&e){crsReport.crsDataSet.save_as_excel(crsReport.s_repname)}$.each(d,function(b,a){if(a!=undefined){f._set_cell_value(a.pg,a.x,a.y,a.val,true)}})},_set_cell_value:function(q,l,n,o,p){var s=this._get_td_and_schema_by_coord(q,l,n);var k=s.td;if($(k).length>0){if(o!=""&&s.schema.datatype=="\u4ee3\u7801\u578b"){if(s.schema.codeid==-11){var r=crsReport.crsUserCache.get_id_by_name(o);$(k).children().eq(1).val(o);o=r}}var m=s.schema.col.rows[s.schema.col_idx].refrepid;if(o!=""&&m!=""&&m!="0"){$(k).html("<a href='javascript:' target='_blank' onclick='crsReport.on_dblclick(event); return false;' style='text-decoration: underline'>"+format_text(s.schema.kid,o)+"</a>")}else{$(k).children().eq(0).val(format_text(s.schema.kid,o))}this.set_cell_value(q,l,n,o,k,s.schema.kid,p)}},set_cell_pvalue:function(l,h,f,k){var g=this._get_td_by_coord(l,h,f);if($(g).length>0){$(g).attr("pval",k)}},get_cell:function(d,e,f){return this._get_td_by_coord(d,e,f)},get_cell_attr:function(k,l,n,m){var o=this._get_td_and_schema_by_coord(k,l,n);var r=o.td;var q="";if(r!=undefined){q=$(r).attr(m);if(q==undefined&&m=="cid"){q=$(r).attr("aria-describedby");if(q!=undefined){var p=q.indexOf("{");if(p==-1){}q=q.substr(p)}}}else{if(m=="cid"){q=o.schema.kid}}return q!=undefined?q:""},get_cell_value:function(q,n,r){if(r!=undefined){var p=this._get_td_and_schema_by_coord(q,n,r);var l=p.td}else{if(n!=undefined){var m=crsReport.crsTableIndex.getAColSchema(q);var k=m.get_cell_point(n);return this.get_cell_value(0,k.x,k.y)}else{var l=q}}if(l!=undefined){var o=$(l).attr("val");if(o==undefined){o=$(l).attr("val2")}}else{if(n!=undefined){var s=p.schema.get_display_seq(n,r);o=crsReport.crsTableIndex.get_hidden_cell_value(p.schema.kid,s)}}return o!=undefined?o:""},set_cell_value:function(p,m,h,n,o,l,k){if(o==undefined){o=this._get_td_by_coord(p,m,h)}if(k==undefined){k=false}if($(o).attr("val")!=n){$(o).attr("val",n);if(!k){crsReport.crsCommon.add_action_maps(["set",p,m,h,n])}}},set_cell_value2:function(p,m,h,n,o,l,k){if(o==undefined){o=this._get_td_by_coord(p,m,h)}if(k==undefined){k=false}if($(o).attr("val2")!=n){$(o).attr("val2",n);if(!k){crsReport.crsCommon.add_action_maps(["set",p,m,h,n])}}},set_hidden_cell_value:function(g,k,h,l){var m=this._get_td_by_coord(g,k,h,true);var n=m.get_display_seq(k,h);crsReport.crsTableIndex.set_hidden_cell_value(m.kid,n,l)},set_hidden_cell_pvalue:function(g,k,h,l){var m=this._get_td_by_coord(g,k,h,true);var n=m.get_display_seq(k,h);crsReport.crsTableIndex.set_hidden_cell_value(m.kid,n,l,true)},_get_cid:function(b){return $(b).attr("id")},_get_rid:function(d){var c=$(d).parent().siblings().eq(0);c=$(c).text();return c},_get_cid_by_td:function(e){var f=$(e).attr("cid");if(f==undefined){f=$(e).attr("aria-describedby");var d=f.indexOf("{");if(d==-1){return""}f=f.substr(d)}return f},_get_rid_by_td:function(d){var c=$(d).siblings().eq(0);c=$(c).text();return c},_get_row_seq:function(m){var n=$(m).parent().children("div.read_detail");var g=$(m).attr("rid");var l=1;for(var h=n.length;l<=h;l++){var k=$(n[l-1]).attr("rid");if(k==g){break}}return l},_add_row:function(f,m,e){if(e==undefined){e=false}var n=this;if(f.data!=undefined){f.stopPropagation();n=f.data.me;f=f.data.tabid}var g=crsReport.crsTableIndex.getColumn(f);var k=crsReport.crsTableIndex.create_row_kid(g.rows[0].kid);var h=crsReport.crsTableIndex.search("id",f);if(crsReport.crsTableIndex.arr_hidden_rows!=null&&crsReport.crsTableIndex.arr_hidden_rows[h.id]!=undefined){if(crsReport.crsTableIndex.arr_hidden_rows[h.id]["dat"][k]==undefined){crsReport.crsTableIndex.arr_hidden_rows[h.id]["dat"][k]=[]}}if(h.canwrite==undefined&&h.canread==undefined){return""}var l='<div class="read_detail clearfix tag-RListField" rid="'+k+'"';if(crsReport.openMode!="read"&&!crsReport.b_is_query){if(h!=undefined&&h.canwrite!=undefined){l+=' onclick="crsReport.crsCommon.crsForm._draw_detail('+f+', this)"'}}l+=">";if(!e){l+=this.obj_detail_dump_row["tab_"+f][0]}l+="</div>";if($("#page1 #detail_tab_"+f).length<1){return l}if(m!=undefined){$(l).insertBefore($("#page1 #detail_tab_"+f).children("div.read_detail").eq(m-1))}else{$(l).appendTo($("#page1 #detail_tab_"+f))}setTimeout(function(){if(crsReport.openMode!="read"&&!crsReport.b_is_query&&h.canwrite!=undefined){Swiped.init({query:"#content .list-item",list:true,right:120})}},500)},_delete_row:function(c,k){window.event.stopPropagation();var h=crsReport.crsTableIndex.search("id",c);if(h.initcz==1){crsReport.show_hint("\u660e\u7ec6\u8868\u6700\u540e\u4e00\u6761\u8bb0\u5f55\u4e0d\u80fd\u5220\u9664\uff01");return}var e=$(k).parent().parent();var m=this._get_row_seq(e);var l=$(e).children("div.hide:eq(0)").attr("cid");crsReport.crsTableIndex.delete_row_kid($(e).attr("rid"));this._update_cell_refer(l,m,"del");$(e).remove();h.initcz=parseInt(h.initcz)-1;this.set_coord_to_kid_map()},_get_real_row_size:function(a){var b=$("#detail_tab_"+a).children("div.read_detail").length},_insert_row:function(e,l,c){if(c==undefined){c=false}var k=$(l);var n=this._get_row_seq(k);var m=$(k).children("div.hide:eq(0)").attr("cid");var h=crsReport.crsTableIndex.search("id",e);this._update_cell_refer(m,n,"ins");this._add_row(e,n,c);h.initcz=parseInt(h.initcz)+1;this.set_coord_to_kid_map()},_get_position:function(e,f){var h=crsReport.crsTableIndex.getAColSchema(e);var g=h.get_cell_rect(f);return g},_update_cell_refer:function(l,r,k,o){if(o==undefined){o=1}var n=crsReport.crsTableIndex.getAColSchema(l);var q=crsReport.crsTableIndex.rows[n.row_idx];var p=n.col.rows[n.col_idx];var s=n.get_cell_rect(r);var m=s[1].y-s[0].y+1;if(k=="ins"||k=="app"){crsReport.crsCommon.add_action_maps([k,parseInt(q.sheetindex)-1,s[0].y,o*m,m])}else{crsReport.crsCommon.add_action_maps([k,parseInt(q.sheetindex)-1,s[0].y,o*m])}crsReport.crsChartCache.update_ref(parseInt(q.sheetindex),s[0].y,o*m,k,false);crsReport.crsTableIndex.update_cell_refer(parseInt(q.sheetindex),q.expandtype,s,o,k=="ins"||k=="app")},auto_increment:function(l,n){if(l.tabletype=="\u660e\u7ec6\u8868"){var o=parseInt(l.sheetindex)-1;if(!n.isEmpty()){var m=n.first();while(!n.EOF()){if(m.datatype=="\u81ea\u589e\u578b"){var k=rectNameToIndex(m.cellspan);if(l.expandtype=="\u6309\u884c\u5411\u4e0b"||l.expandtype=="\u4e0d\u6269\u5c55"){var p=k[1].y-k[0].y+1;for(var h=0;h<l.initcz;h++){this._set_cell_value(o,k[0].x,k[1].y+h*p,h+1)}}}m=n.next()}}}},append_record:function(m,o,k,h){if(h==undefined){h=false}var p=this;if(m.data!=undefined){m.stopPropagation();p=m.data.me;o=m.data.obj_col;m=m.data.obj_tab}if(k==undefined){k=1}if(m.expandtype=="\u6309\u884c\u5411\u4e0b"){var q=o.get_cell_rect(m.initcz);var n=q[1].y-q[0].y+1;p._update_cell_refer(o.kid,m.initcz,"app",k);for(var l=0;l<k;l++){p._add_row(m.id,undefined,h)}m.initcz=parseInt(m.initcz)+k;p.set_coord_to_kid_map()}},clear_cell:function(p,n,q){var o=this._get_td_and_schema_by_coord(p,n,q);var k=o.td;if(k!=undefined){var h=o.schema;var m=crsReport.crsTableIndex.rows[h.row_idx];if(m.tabletype=="\u660e\u7ec6\u8868"){var l=$(k).parent();$(l).find("em[cid='"+h.kid+"']").text("");$(k).attr("val","").attr("pval","")}else{$(k).attr("val2","");$(k).attr("val","");$(k).empty();if($(k).html().indexOf("</select>")!=-1){$($(k).html()).attr("selectedIndex",0)}else{$(k).html(crsReport.crsCommon._get_editor(this._get_rid_by_td(k),h))}}}else{var r=o.schema.get_display_seq(n,q);crsReport.crsTableIndex.clear_hidden_cell_value(o.schema.kid,r)}crsReport.crsCommon.add_action_maps(["set",p,n,q,""])},delete_record:function(o,q,n,r){var p=this._get_td_and_schema_by_coord(q,n,r);var l=p.td,m=p.schema.kid,s;var k;if(l!=undefined){s=this._get_row_seq($(l).parent("div"));k=$(l).parent("div").attr("rid");$($(l).parent()).remove()}else{s=p.schema.get_display_seq(n,r);k=crsReport.crsTableIndex.delete_hidden_row(m,s)}this._update_cell_refer(m,s,"del");crsReport.crsTableIndex.delete_row_kid(k);o.initcz=parseInt(o.initcz)-1;this.set_coord_to_kid_map()},set_cell_backgroud_color:function(m,f,l,k){var h=this._get_td_and_schema_by_coord(m,f,l);var g=h.td;if($(g).hasClass("hide")){$(g).parent().find("em[cid='"+h.schema.kid+"']").css("background-color",k)}else{$(g).children("").each(function(){if(k!=undefined){$(this).css("background-color",k)}else{$(this).css("background-color","")}})}},_draw_a_td:function(v,s,x,o,r,q,z){if(o.ismust){var u="Red"}else{var u=""}var t="";if(v&&z!=undefined){var y=o.col.obj_data_cache.get_nth_by_col_name("col"+q.id);t=HandleMemoStr(z[y],false);if(t=="null"){t=""}if((q.datatype=="\u8d27\u5e01\u578b"||q.datatype=="\u6570\u503c\u578b")&&parseFloat(t)==0||q.datatype=="\u65e5\u671f\u578b"&&(t=="0"||t=="0000-00-00 00:00:00"||t=="0000-00-00"||t=="00:00:00")){t=""}}else{t=crsReport.get_val_from_para(o.kid);if(t==""){t=q.defaultval}}var p={val:""};if(o.canread){p.val=t}var n=crsReport.crsCommon._get_editor(x,o,p);if(p.val!=t){t=p.val}if(q.has_inline_calcu!="y"){var m=rectNameToIndex(q.cellspan);crsReport.crsCommon.add_action_maps(["set",parseInt(r.sheetindex)-1,m[0].x,m[0].y,t])}var w=" tag-RTextField";if(q.datatype=="\u4ee3\u7801\u578b"){if(q.codeid=="-10"){w=" tag-RDeptField"}else{if(q.codeid=="-11"){w=" tag-RUserField"}else{w=" tag-RSelectField"}}}s+='<div class="read_detail clearfix'+w+(o.canwrite?(o.ismust?" field-must":" field-editable"):"")+'" rid="'+x+'"><em>'+q.columnlabel+'</em><div class="field" style="height:auto;" cid="'+q.kid+'"'+((v)?(' pval="'+t+'"'):"")+' val="'+t+'">'+n+"</div></div>";return s},draw_form:function(ao){if(ao){var aj=crsReport.crsTableIndex.getFirstTable();while(aj!=null){var au=aj[1]-1;var an=rectNameToIndex(aj[5]);if(aj[3]<1){aj[3]=1}if(aj[0]=="\u660e\u7ec6\u8868"){if(aj[2]=="\u6309\u884c\u5411\u4e0b"){if(aj[4]>aj[3]){crsReport.crsTableIndex.update_cell_refer(parseInt(au)+1,aj[2],an,aj[4]-aj[3],true);crsReport.crsCommon.add_action_maps(["app",au,an[0].y,(aj[4]-aj[3])*(an[1].y-an[0].y+1),(an[1].y-an[0].y+1)])}}else{if(aj[2]=="\u6309\u5217\u5411\u53f3"){if(aj[4]>aj[3]){crsReport.crsTableIndex.update_cell_refer(parseInt(au)+1,aj[2],an,aj[4]-aj[3],true);crsReport.crsCommon.add_action_maps(["app",au,an[0].x,(aj[4]-aj[3])*(an[1].x-an[0].x+1),(an[1].x-an[0].x+1)])}}}}aj=crsReport.crsTableIndex.getNextTable()}}this.set_coord_to_kid_map();$('<div id="page1" class="page in"><form name="my_form" method="post" enctype="multipart/form-data" action="" target=""><div id="content"></div></form></div>').appendTo($("body"));var ak=this;if(!crsReport.crsTableIndex.isEmpty()){var G=3;var ae,av;var K=crsReport.crsTableIndex.first();while(!crsReport.crsTableIndex.EOF()){var aq=crsReport.crsTableIndex.getColumn(K.id);var ac,ar,V;if(K.tabletype=="\u4e3b\u8868"&&aq.length()>0){var s="";var U=0,R=0;var aw="",al=aq.arr_output_cols.length,t=0;if(ao){V=aq.obj_data_cache.rows[0];ac=aq.obj_data_cache.get_nth_by_col_name("kid");aw=V[ac]}else{aw=crsReport.crsTableIndex.create_row_kid(aq.rows[0].kid)}if(!aq.isEmpty()){if(K.canwrite!=undefined||K.canread!=undefined){s='<div id="main_tab_'+K.id+'" class="reportBlock report-block-header clearfix"><h3>'+(ao&&crsReport.crsTableIndex.cursor==0&&crsReport.s_title!=""?crsReport.s_title:K.label)+"</h3>"}var k=aq.first();while(!aq.EOF()){var e=crsReport.crsTableIndex.getAColSchema(k.kid);if(!e.canwrite&&!e.canread){if(crsReport.crsTableIndex.arr_hidden_rows[K.id]["dat"][aw]==undefined){crsReport.crsTableIndex.arr_hidden_rows[K.id]["dat"][aw]=[]}if(ao){ac=aq.obj_data_cache.get_nth_by_col_name("col"+k.id);ar=HandleMemoStr(V[ac],false);crsReport.crsTableIndex.arr_hidden_rows[K.id]["dat"][aw][k.kid]={val:ar,pval:ar}}else{crsReport.crsTableIndex.arr_hidden_rows[K.id]["dat"][aw][k.kid]={val:"",pval:""}}}else{s=this._draw_a_td(ao,s,aw,e,K,k,V)}k=aq.next()}if(s!=""){s+="</div>"}}if(s!=""){$(s).appendTo($("body form > div"))}}else{if(K.tabletype=="\u660e\u7ec6\u8868"){if(!aq.isEmpty()){var r,r,J="",T="";av=aq.first();var S="",aa="",Y="";while(!aq.EOF()){ae=crsReport.crsTableIndex.getAColSchema(av.kid);if(!ae.canwrite&&!ae.canread){}else{if(J==""){J='<div id="detail_tab_'+K.id+'" class="reportBlock report-block-header clearfix deletePriv"><h3>'+(ao&&crsReport.crsTableIndex.cursor==0&&crsReport.s_title!=""?crsReport.s_title:K.label)+"</h3>"+(crsReport.openMode!="read"&&!crsReport.b_is_query&&K.canwrite!=undefined?'<div class="report-block-header-op"><a class="report-list-icon-create" href="javascript:void(0);" onclick="crsReport.crsCommon.crsForm._draw_detail('+K.id+')"></a><a class="report-list-icon-tableview" href="/mobile/reportshop/report/read_detail_info.php" style="display: none"></a></div>':"");ak.obj_detail_dump_row["tab_"+K.id]=[];ak.obj_detail_dump_row["tab_"+K.id][0]=""}if(ae.canread&&av.defaultval!=""){ar=av.defaultval}else{ar=""}Y+='<div class="hide" cid="'+av.kid+'" val="'+ar+'"/>';if(aa==""){aa='<h6 class="clearfix"><em cid="'+av.kid+'">'+ar+"</em>";aa+="</h6>"}else{S+='<em cid="'+av.kid+'">'+ar+"</em>"}ak.obj_detail_dump_row["tab_"+K.id][av.kid]=this._draw_a_td(false,"","",ae,K,av)}av=aq.next()}if(ak.obj_detail_dump_row["tab_"+K.id]!=undefined){if(crsReport.openMode!="read"&&!crsReport.b_is_query&&K.canwrite!=undefined){ak.obj_detail_dump_row["tab_"+K.id][0]+='<div class="clearfix list-item" style="-webkit-transition: -webkit-transform 200ms; transition: -webkit-transform 200ms; -webkit-transform: translate3d(0px, 0px, 0px);">'+aa+S+'</div><div class="read_detail_add"><span class="addItem" onclick="crsReport.crsCommon.crsForm._draw_detail('+K.id+', this, true)"></span></div><div class="read_detail_delete"><span onclick="crsReport.crsCommon.crsForm._delete_row('+K.id+', this)">\u5220\u9664</span></div>'+Y}else{ak.obj_detail_dump_row["tab_"+K.id][0]+=aa+S+Y}}if(crsReport.openMode=="write"){for(var w=0;w<K.initcz;w++){J+=ak._add_row(K.id)}}else{var ag=aq.obj_data_cache;if(!ag.isEmpty()){var V=ag.first();var ad=ag.get_nth_by_col_name("kid"),ai=0;while(!ag.EOF()){if(K.canwrite!=undefined||K.canread!=undefined){J+='<div class="read_detail clearfix tag-RListField" rid="'+V[ad]+'"'+(crsReport.openMode!="read"&&!crsReport.b_is_query&&K.canwrite!=undefined?'onclick="crsReport.crsCommon.crsForm._draw_detail('+K.id+', this)"':"")+">";if(crsReport.openMode!="read"&&!crsReport.b_is_query&&K.canwrite!=undefined){J+='<div class="clearfix list-item" style="-webkit-transition: -webkit-transform 200ms; transition: -webkit-transform 200ms; -webkit-transform: translate3d(0px, 0px, 0px);">'}}ai++;var at=null,ah={},S="",aa="",Y="";av=aq.first();while(!aq.EOF()){ae=crsReport.crsTableIndex.getAColSchema(av.kid);if(!ae.canwrite&&!ae.canread){if(crsReport.crsTableIndex.arr_hidden_rows[K.id]["dat"][V[ad]]==undefined){crsReport.crsTableIndex.arr_hidden_rows[K.id]["dat"][V[ad]]=[]}ac=ag.get_nth_by_col_name("col"+av.id);ar=HandleMemoStr(V[ac],false);crsReport.crsTableIndex.arr_hidden_rows[K.id]["dat"][V[ad]][av.kid]={val:ar,pval:ar}}else{if(ae.canread){ac=ag.get_nth_by_col_name("col"+av.id);ar=HandleMemoStr(V[ac],false);if(ar=="null"){ar=""}if((av.datatype=="\u8d27\u5e01\u578b"||av.datatype=="\u6570\u503c\u578b")&&parseFloat(ar)==0||av.datatype=="\u65e5\u671f\u578b"&&(ar=="0"||ar=="0000-00-00 00:00:00"||ar=="0000-00-00"||ar=="00:00:00")){ar=""}}else{ar=""}if(av.datatype=="\u81ea\u589e\u578b"){ar=ai}Y+='<div class="hide" cid="'+av.kid+'" val="'+ar+'" '+(ao?('pval="'+ar+'"'):"")+"/>";if(av.has_inline_calcu!="y"){var W=ae.get_cell_rect(parseInt(V[10]));crsReport.crsCommon.add_action_maps(["set",parseInt(K.sheetindex)-1,W[0].x,W[0].y,ar])}if(ar!=""){if(av.datatype=="\u81ea\u589e\u578b"){}else{if(av.datatype=="\u9644\u4ef6\u578b"){var ab=ar.indexOf("_");var X=ar.substr(ab+1);ar="<a href='/attachment/reportshop/attachment/"+ar+"' target='_blank' title='\u5355\u51fb\u6253\u5f00\u9644\u4ef6'>"+X+"</a>"}else{if(av.datatype=="\u56fe\u7247\u578b"){var am=ar.split(" ");var Z=parseInt(am[4])-parseInt(am[2]),af=parseInt(am[5])-parseInt(am[3]);ar="<img src='/attachment/reportshop/images/"+aw[0]+"' width='"+Z+"' height='"+af+"' ondblclick='window.parent.float_image(this)' title='\u53cc\u51fb\u653e\u5927\u9884\u89c8'/>"}else{ar=format_text(av.kid,ar)}}}}if(ar==""){ar="-"}if(aa==""){aa='<h6 class="clearfix"><em cid="'+av.kid+'">'+ar+"</em>";aa+="</h6>"}else{S+='<em cid="'+av.kid+'">'+av.columnlabel+"\uff1a"+ar+"</em>"}}av=aq.next()}if(K.canwrite!=undefined||K.canread!=undefined){J+=aa+S;if(K.canwrite!=undefined&&crsReport.openMode!="read"&&!crsReport.b_is_query){J+='</div><div class="read_detail_add"><span class="addItem" onclick="crsReport.crsCommon.crsForm._draw_detail('+K.id+', this, true)"></span></div><div class="read_detail_delete"><span onclick="crsReport.crsCommon.crsForm._delete_row('+K.id+', this)">\u5220\u9664</span></div>'}J+=Y;J+="</div>"}var V=ag.next()}}}if(J!=""){J+="</div>";$(J).appendTo($("body form > div"))}}}}K=crsReport.crsTableIndex.next()}}if(!crsReport.crsChartCache.isEmpty()){J="",T="";var ap=crsReport.crsChartCache.first();while(!crsReport.crsChartCache.EOF()){var F=getColPlatKId(ap.label);ap.label=F;ap.category_name=HandleMemoStr(ap.category_name,false);ap.series_name=HandleMemoStr(ap.series_name,false);J+='<li><a href="#'+F+'">'+ap.title+"</a></li>";T+='<div id="'+F+'" style="min-width:450px;min-height:350px;"></div>';ap=crsReport.crsChartCache.next()}if(crsReport.crsChartCache.length()>1){if($("#detail_tabs").length>0){$("#detail_tabs").before($('<div id="chart_tabs" align="center"><ul>'+J+"</ul>"+T+"</div>"))}else{$('<div id="chart_tabs" align="center"><ul>'+J+"</ul>"+T+"</div>").appendTo($("body > form"))}try{if($("#chart_tabs").length>0){$("#chart_tabs").tabs()}}catch(o){}}else{if($("#detail_tabs").length>0){$("#detail_tabs").before($('<div id="chart_tabs" align="center">'+T+"</div>"))}else{$('<div id="chart_tabs" align="center">'+T+"</div>").appendTo($("body > form"))}}var ap=crsReport.crsChartCache.first();while(!crsReport.crsChartCache.EOF()){crsReport.crsChartCache.draw_chart(ap);ap=crsReport.crsChartCache.next()}}$('<div style="text-align: center;" id="tool_page"><div class="reportBlock" style="text-align: center;margin-bottom: 0px;border-bottom: 0px;">'+(crsReport.openMode!="read"&&!crsReport.b_is_query?'<button id="save" type="button" class="reportbtn" onclick="crsReport.crsCommon.crsForm._fill_report();">\u4fdd\u5b58</button>':"")+"</div></div>").appendTo($("body form"));$('<div id="page2" class="page">            <div class="container"></div>            <div class="reportBlock" style="text-align: center;margin-bottom: 0px;border-bottom: 0px;">            <button type="button" class="reportbtn saveturn" onclick="javascript:crsReport.crsCommon.crsForm._save();" >\u786e\u5b9a</button>            <button type="button" class="reportbtn closeturn" onclick="javascript:crsReport.crsCommon.crsForm._back();" >\u8fd4\u56de</button>            </div></div>').appendTo($("body"));if(crsReport.openMode!="read"&&!crsReport.b_is_query){Swiped.init({query:"#content .list-item",list:true,right:120});$('<div id="page3" class="page"><div class="container"></div>'+(crsReport.has_workflow()?'<div id="next_container"></div>':"")+'<div class="reportBlock" style="text-align: center;margin-bottom: 0px;border-bottom: 0px;">            <button type="button" class="reportbtn" onclick="javascript:crsReport.crsCommon.crsForm.save_data();" >\u4fdd\u5b58</button>'+(crsReport.has_workflow()?'<button type="button" class="reportbtn" onclick="javascript:crsReport.crsCommon.crsForm.submit_it();" >\u63d0\u4ea4</button>':"")+'<button type="button" class="reportbtn closeturn" onclick="javascript:crsReport.crsCommon.crsForm._back();" >\u8fd4\u56de</button>            </div></div>').appendTo($("body"));$('<div id="select_page" class="page"><div class="container"></div>            <div class="reportBlock" style="text-align: center;margin-bottom: 0px;border-bottom: 0px;">            <button type="button" class="reportbtn closeturn" onclick="javascript:crsReport.crsCommon.crsForm._back();" >\u8fd4\u56de</button></div></div>').appendTo("body");$('<div class="reportBlock report-block-header clearfix">  <h3>\u586b\u62a5\u4fe1\u606f</h3><div class="read_detail clearfix tag-RTextField field-editable"><em>\u6807\u9898:</em>  <div class="field"> <input value="'+crsReport.s_title+'" id="title" name="title" type="text"></div></div><div class="read_detail clearfix tag-RDeptField"> <em>\u586b\u62a5\u90e8\u95e8:</em><div class="field"><span id="organid">'+crsReport.crsDeptCache.get_name_by_id(crsReport.organId)+'</span><input value="'+crsReport.organId+'" name="organid" type="hidden" id="organidvalue"></div></div><div class="read_detail clearfix tag-RUserField"><em>\u586b\u62a5\u4eba\u5458:</em><div class="field"><span id="userid">'+crsReport.crsUserCache.get_name_by_id(crsReport.userId)+'</span><input value="'+crsReport.userId+'" name="userid" type="hidden" id="useridvalue">    </div></div><div class="read_detail clearfix tag-RDateField">  <em>\u586b\u62a5\u65f6\u95f4:</em>  <div class="field"><span>'+crsReport.writeTime+'</span><input value="'+crsReport.writeTime+'" name="writetime" type="hidden" readonly=""></div></div><div class="read_detail clearfix tag-RRichtextField field-editable">  <em>\u5907\u6ce8:</em>  <div class="field" style="height:auto;"><div class="clearfix"></div><textarea id="memo" name="memo">'+crsReport.s_memo+"</textarea></div></div></div>").appendTo($("#page3 > div.container"));if(crsReport.has_workflow()){$('<link rel="stylesheet" type="text/css" href="/general/workflow/list/turn/turn_style.css">').append("body")}$('button[action="selectuser"]').bind("click",function(){var a=$(this).siblings(":eq(0)").attr("id");if(crsReport.mobilestyle==1){document.location="selectuser:"+a}else{window.Android.selectAddress("selectuser",a)}});$('button[action="selectdept"]').bind("click",function(){var a=$(this).siblings(":eq(0)").attr("id");if(crsReport.mobilestyle==1){document.location="selectdept:"+a}else{window.Android.selectDept("selectdept",a)}});$('button[action="addfile"]').bind("click",function(){crsReport.crsCommon._id($(this).siblings(":eq(0)"));var b=$(this).siblings(":eq(0)").attr("id");var a=$(this).parent("div").parent("div").attr("rid");a=a+$(this).parent("div").attr("cid");a=getColPlatKId(a);if(crsReport.mobilestyle==1){document.location="addfile:"+b+":"+a}else{window.Android.selectfile("addfile",b,a)}});$('button[action="addimg"]').bind("click",function(){crsReport.crsCommon._id($(this).siblings(":eq(0)"));var b=$(this).siblings(":eq(0)").attr("id");var a=$(this).parent("div").parent("div").attr("rid");a=a+$(this).parent("div").attr("cid");a=getColPlatKId(a);if(crsReport.mobilestyle==1){document.location="addimg:"+b+":"+a}else{window.Android.selectimg("addimg",b,a)}})}},show_hint:function(b){var a=$("#select_page");a.children("div.container").html(b);a.attr("page",$("div.in").attr("id"));$("div.page").removeClass("in");a.addClass("in")},_fill_report:function(){crsReport.handle_before_save();if(!crsReport.save_data(false)){return}if($("#title").val()==""||$("#title").val()=="undefined"){$("#title").val(crsReport.crsTableIndex.get_auto_code())}var b="";this.obj_next=crsReport.crsWorkflow.get_next_task(false);if(this.obj_next!=null){b='<div class="reportWrapper">';for(i in this.obj_next){if(typeof(this.obj_next[i])=="function"){break}if(this.obj_next[i].b_only_redirect){continue}b+='<div class="reportBlock"><div class="read_detail clearfix "><em><input type="checkbox" style="display:;" id="PRCS_CHECK_'+i+'" checked name="PRCS_CHECK_'+i+'"/>\u4e0b\u4e00\u6b65\u9aa4\uff1a</em><div class="field"><span class="turn-title">'+this.obj_next[i].n+'</span></div></div><div class="read_detail clearfix "><em>\u529e\u7406\u4eba\uff1a</em><div class="field userlist">';var a="";if(this.obj_next[i].u!=undefined){for(j in this.obj_next[i].u){if(typeof(this.obj_next[i].u[j])=="function"){break}b+='<em userid="'+j+'">'+this.obj_next[i].u[j]+'<span class="delicon"></span></em>';a+='<li class="active" q_name="'+this.obj_next[i].u[j]+'" q_user_id="'+j+'" ><h3>'+this.obj_next[i].u[j]+'</h3><p class="grapc">\u90e8\u95e8\uff1a'+crsReport.crsUserCache.get_long_dept_name(j)+'</p><i class="checkicon"></i></li>'}}b+='</div></div><div class="read_detail userarea clearfix "><div class="search_box"><div class="input_box"><input type="text" class="search" name="USER_NAME" value=""></div></div><ul class="comm-list comm-pic-list USER_PLIST">'+a+'</ul><div class="nousertip" class="nousertip">\u6ca1\u6709\u7b26\u5408\u6761\u4ef6\u7684\u4eba\u5458</div></div></div>'}if(b!='<div class="reportWrapper">'){b+='<div class="read_detail clearfix "><em><input class="smsremind" name="sms" type="checkbox" checked />\u4e8b\u52a1\u63d0\u9192\u4e0a\u8ff0\u6267\u884c\u4eba</em></div>'}b+="</div>"}$("#page3 > #next_container").html(b);$("#page1").removeClass("in");$("#page3").addClass("in");if(b!=""){$(".USER_PLIST li").on("click",function(){var e=$(this),d=e.parents(".reportWrapper");$userlist=d.find(".userlist");e.toggleClass("active");var c=e.attr("q_user_id"),f=e.attr("q_name");if(e.hasClass("active")){if($userlist.children("em[userid='"+c+"']").length>0){}else{$('<em userid="'+c+'" class="">'+f+'<span class="delicon"></span></em>').appendTo($userlist)}}else{$userlist.find("em[userid='"+c+"']").remove()}});$(".userlist").delegate("em","touchstart",function(){$(this).toggleClass("active")});$(".userlist").delegate(".delicon","touchstart",function(){var c=$(this).parent("em").attr("userid"),d=$(this).parents(".reportWrapper");$(this).parent("em").remove();d.find(".USER_PLIST").find('li[q_user_id="'+c+'"]').removeClass("active")});$(".search").on("keyup",function(){var g=$(this),f=g.parents(".reportWrapper"),c=f.find(".USER_PLIST");var e=$(this).val();if(e!=""){var d=false;c.find("li").each(function(){var k=$(this).attr("q_name"),h=$(this).attr("q_user_id");if(k.indexOf(e)!=-1||h.indexOf(e)!=-1){$(this).removeClass("hide");d=true}else{$(this).addClass("hide")}});if(d){f.find(".nousertip").hide()}else{f.find(".nousertip").show()}}else{c.find("li").removeClass("hide");f.find(".nousertip").hide()}})}},save_data:function(){crsReport.s_title=$("#title").val();crsReport.s_memo=$("#memo").val();crsReport.save_data()},submit_it:function(){if(this.obj_next!=null){var b="";for(e in this.obj_next){if(this.obj_next[e].b_only_redirect){page.crsReport.s_only_redirect_task+=";"+this.obj_next[e].n+"["+get_delimiter_key(this.obj_next[e].u,",")+"]"}else{if($("#PRCS_CHECK_"+e).attr("checked")){var g="";$("#PRCS_CHECK_"+e).parents("div.reportBlock").find("em[userid]").each(function(){if(!$(this).hasClass("active")){g+=$(this).attr("userid")+","}});if(g==""){crsReport.show_hint("\u8bf7\u6307\u5b9a "+this.obj_next[e].n+" \u529e\u7406\u4eba\uff01");return}b+=this.obj_next[e].n+"["+g+"];"}}}crsReport.s_next_task=b}if(crsReport.s_next_task==""&&!crsReport.b_is_endtask){crsReport.show_hint("\u6ca1\u6709\u4e0b\u4e00\u6b65\u6b65\u9aa4\uff0c\u4e0d\u5141\u8bb8\u63d0\u4ea4\uff01");return}crsReport.b_submit=true;this.save_data();if(!crsReport.b_saved){return}var c=crsReport.free();if(c!=""){var f=screen.availWidth;var h=screen.availHeight;var a=c.split("|");for(var e=0,d=a.length/6;e<d;e++){if(a[e*6+3]==""){window.open("./index.php?repid="+a[e*6]+"&openmode=write&userid="+page.crsReport.s_writer,"_blank","status=1,resizable=1,left=0,top=0,width="+f+",height="+h)}else{window.open("./index.php?repid="+a[e*6]+"&openmode=edit&userid="+a[e*6+3]+"&writetime="+a[e*6+4]+"&writer="+page.crsReport.s_writer+"&curtask="+a[e*6+5],"_blank","status=1,resizable=1,left=0,top=0,width="+f+",height="+h)}}}crsReport.free=undefined;submit_it()},_save:function(){var e=$("#page2 > div > div");var b=e.attr("id").replace("detail_tab_","");var o=e.attr("to_insert")!=undefined;var l=e.children("div:eq(0)");var c=$(l).attr("rid");if(!o&&c!=undefined&&c!=""){var m=$("#page1 #detail_tab_"+b+" > div[rid='"+c+"']");var a=""}else{var f=crsReport.crsTableIndex.search("id",b);var p=crsReport.crsTableIndex.getAColSchema($(l).find("div.field").eq(0).attr("cid"));if(o){var n=$("#page1 #detail_tab_"+b+" > div[rid='"+c+"']");this._insert_row(b,n,true);var m=$(n).prev()}else{this.append_record(f,p,1,true);var m=$("#page1 #detail_tab_"+b+" > div").last()}}var d="",h="",k="";var g=this;var a=g._get_row_seq(m);$("#page2 div.field").each(function(){var v=$(this).attr("cid");var u=crsReport.crsTableIndex.getAColSchema(v);var q=u.col.rows[u.col_idx];var r=$(this).children(":eq(0)").val();var t=$(this).children(":eq(1)");if(t.length>0){var w=$(t)[0].tagName;if(w!=undefined&&w.toLowerCase()=="span"){r=$(t).text()}else{r=t.val()}}if(r=="on"){r="\u221a"}var s=u.get_cell_point(a);crsReport.crsCommon.add_action_maps(["set",parseInt(crsReport.crsTableIndex.rows[u.row_idx].sheetindex)-1,s.x,s.y,$(this).attr("val")]);if(h==""){h='<h6 class="clearfix"><em cid="'+u.kid+'">'+r+"</em></h6>"}else{d+='<em cid="'+u.kid+'">'+q.columnlabel+"\uff1a"+r+"</em>"}k+='<div class="hide" cid="'+u.kid+'" val="'+$(this).attr("val")+'" '+($(this).attr("pval")!=undefined?('pval="'+$(this).attr("pval")+'"'):"")+"/>"});if(false&&$(m).children("div.report-block-header-op").length>0){$(m).html(h+d+k+'<div class="report-block-header-op hide">'+$(m).children("div.report-block-header-op").html()+"</div>")}else{$(m).html('<div class="clearfix list-item" style="-webkit-transition: -webkit-transform 200ms; transition: -webkit-transform 200ms; -webkit-transform: translate3d(0px, 0px, 0px);">'+h+d+'</div><div class="read_detail_add"><span class="addItem" onclick="crsReport.crsCommon.crsForm._draw_detail('+b+', this, true)"></span></div><div class="read_detail_delete"><span onclick="crsReport.crsCommon.crsForm._delete_row('+b+', this)">\u5220\u9664</span></div>'+k)}setTimeout(function(){Swiped.init({query:"#content .list-item",list:true,right:120})},500);this._back();$("#page2 div.field").each(function(){var q=$(this).attr("cid");crsReport.crsFormulasCache.execute_formulas(crsReport.get_valid_cur_task(),CRS_CHANGE_EXEC,0,q,a,"",false,false,false);crsReport.crsFormulasCache.execute_formulas(crsReport.get_valid_cur_task(),CRS_CHANGE_EXEC,0,q,a,"",true,false,false)})},_back:function(){var b=$("div.in");var a=b.attr("page")!=undefined?b.attr("page"):"page1";b.removeClass("in").attr("page",undefined);$("#"+a).addClass("in")},_draw_detail:function(s,c,o){window.event.stopPropagation();if(c!=undefined){if(o!=undefined){c=$(c).parent().parent().attr("rid")}else{c=$(c).attr("rid")}}if(o==undefined){o=false}var r=crsReport.crsTableIndex.search("id",s);var h='<div id="detail_tab_'+r.id+'" class="reportBlock report-block-header clearfix"'+(o?" to_insert":"")+"><h3>"+r.label+"</h3></div>";$("#page2 > div.container").html(h);for(s_key in this.obj_detail_dump_row["tab_"+s]){if(s_key!=0&&typeof(this.obj_detail_dump_row["tab_"+s][s_key])!="function"){$(this.obj_detail_dump_row["tab_"+s][s_key]).appendTo("#page2 > div.container > div");var q=$("#page2 > div.container > div > div").last();if(c!=undefined){$(q).attr("rid",c)}if(c!=undefined&&!o){var k="";var b=$("#page1 #detail_tab_"+r.id+" > div[rid='"+c+"']");var e=b.children("div[cid='"+s_key+"']");var d=$(e).attr("val");d=d=="-"?"":d;var l=$(q).children("div.field");l.attr("val",d);var k=b.find("em[cid='"+s_key+"']").text();k=k=="-"?"":k;var a=k.indexOf("\uff1a");if(a!=-1){k=k.substr(a+1)}var g=$(l).children("select");if($(g).length>0){var m=0;$(g).children().each(function(){if($(this).text()==k){$(g)[0].selectedIndex=m;return false}m++})}else{var n=crsReport.crsTableIndex.getAColSchema(s_key);if(n.datatype=="\u903b\u8f91\u578b"){if(d=="\u221a"){$(l).children("input[type='checkbox']").attr("checked",true)}}else{if(n.datatype=="\u4ee3\u7801\u578b"){if(n.codeid=="-10"||n.codeid=="-11"){$(l).children().eq(0).val(d);$(l).children().eq(1).text(k)}else{if(n.codeid=="-11"){$(l).children().eq(0).val(d);$(l).children().eq(1).text(k)}else{}}}else{$(l).children().val(k)}}}}h+=q}}$('button[action="selectuser"]').bind("click",function(){var f=$(this).siblings(":eq(0)").attr("id");if(crsReport.mobilestyle==1){document.location="selectuser:"+f}else{window.Android.selectAddress("selectuser",f)}});$('button[action="selectdept"]').bind("click",function(){var f=$(this).siblings(":eq(0)").attr("id");if(crsReport.mobilestyle==1){document.location="selectdept:"+f}else{window.Android.selectDept("selectdept",f)}});$('button[action="addfile"]').bind("click",function(){crsReport.crsCommon._id($(this).siblings(":eq(0)"));var p=$(this).siblings(":eq(0)").attr("id");var f=$(this).parent("div").parent("div").attr("rid");f=f+$(this).parent("div").attr("cid");f=getColPlatKId(f);if(crsReport.mobilestyle==1){document.location="addfile:"+p+":"+f}else{window.Android.selectfile("addfile",p,f)}});$('button[action="addimg"]').bind("click",function(){crsReport.crsCommon._id($(this).siblings(":eq(0)"));var p=$(this).siblings(":eq(0)").attr("id");var f=$(this).parent("div").parent("div").attr("rid");f=f+$(this).parent("div").attr("cid");f=getColPlatKId(f);if(crsReport.mobilestyle==1){document.location="addimg:"+p+":"+f}else{window.Android.selectimg("addimg",p,f)}});$("#page1").removeClass("in");$("#page2").addClass("in")},_open_href:function(a){var b='<iframe src="'+a+'"/>';this.show_hint(b)},begin_update:function(){},end_update:function(){this.calculate();crsReport.crsChartCache.refresh()},resize:function(){}};function TCRSTableView(){this.crsCellControler=new TCRSCellControler();this.op='<i align=\'right\'><img title="\u6dfb\u52a0" onclick="crsReport.crsCommon.crsTable.append_record(this)" src="/static/modules/reportshop/images/green_plus.gif" border="0" style="cursor:pointer"><img title="\u63d2\u5165" onclick="crsReport.crsCommon.crsTable.insert_record(this)" src="/static/modules/reportshop/images/green_arrow.gif" border="0" style="cursor:pointer"><img title="\u5220\u9664" onclick="crsReport.crsCommon.crsTable.delete_record(this)" src="/static/modules/reportshop/images/green_minus.gif" border="0" style="cursor:pointer"></i>'}TCRSTableView.prototype={constructor:TCRSTableView,loadData:function(K){var U=crsReport.crsTableIndex.get_sheet_sz();for(var Z=0;Z<U;Z++){this.crsCellControler.cache_td(Z)}if(K){var am=crsReport.crsTableIndex.getFirstTable();while(am!=null){var ae=am[1]-1;var ag=rectNameToIndex(am[5]);if(am[3]<1){am[3]=1}if(am[0]=="\u660e\u7ec6\u8868"){if(am[2]=="\u6309\u884c\u5411\u4e0b"){if(am[4]>am[3]){crsReport.crsTableIndex.update_cell_refer(parseInt(ae)+1,am[2],ag,am[4]-am[3],true);var Q=ag[1].y-ag[0].y+1;ag[0].y+=Q*(am[3]-1);ag[1].y+=Q*(am[3]-1);this.crsCellControler.insert_row(this.crsCellControler.get_cell(ae,ag[0].x,ag[0].y),ae,ag[0].y,(am[4]-am[3]));this.crsCellControler.cache_td(ae)}}else{if(am[2]=="\u6309\u5217\u5411\u53f3"){if(am[4]>am[3]){crsReport.crsTableIndex.update_cell_refer(parseInt(ae)+1,am[2],ag,am[4]-am[3],true);var Q=ag[1].x-ag[0].x+1;ag[0].x+=Q*(am[3]-1);ag[1].x+=Q*(am[3]-1);this.crsCellControler.insert_column(this.crsCellControler.get_cell(ae,ag[0].x,ag[0].y),ae,ag[0].x,(am[4]-am[3]));this.crsCellControler.cache_td(ae)}}}}am=crsReport.crsTableIndex.getNextTable()}}if(crsReport.openMode=="write"&&crsReport.s_dataflow!=""){crsReport.openMode="edit"}if(crsReport.openMode=="edit"||crsReport.openMode=="read"||crsReport.openMode=="copynew"){if(crsReport.openMode=="read"){me2=crsReport;if(!crsReport.b_is_query){crsReport.b_is_query=true}}var Y=14;var ad=crsReport.crsTableIndex.getFirstTable();while(ad!=null){var ae=ad[1]-1;var y=crsReport.crsTableIndex.get_first_data_item();var aa=null;var x=1;while(y!=null){if(aa==null){aa=y.schema;y=y.data}for(var Z=0,V=aa.length/Y;Z<V;Z++){if(crsReport.openMode=="copynew"&&Z==0){y[aa[Z*Y+8]]=crsReport.crsTableIndex.create_row_kid(aa[Z*Y+6])}var W=aa[Z*Y+1],ab=aa[Z*Y+2];var ag=rectNameToIndex(aa[Z*Y+10]);if(x>1){if(ad[2]=="\u6309\u884c\u5411\u4e0b"||Z*Y+[2]=="\u4e0d\u6269\u5c55"){ab+=(ag[1].y-ag[0].y+1)*(x-1)}else{W+=(ag[1].x-ag[0].x+1)*(x-1)}}var T="row"+ab+"column"+W;var P=crsReport.obj_cell_maps[ae][T];if(ad[2]=="\u6309\u884c\u5411\u4e0b"||Z*Y+[2]=="\u4e0d\u6269\u5c55"){$(P).parent("#row"+ab).attr("rid",y[aa[Z*Y+8]])}else{$(P).attr("rid",y[aa[Z*Y+8]])}$(P).attr("cid",aa[Z*Y+6]);if((crsReport.openMode=="copynew"&&(crsReport.writeColList==null||crsReport.writeColList.indexOf(aa[Z*Y+6])!=-1)||crsReport.openMode!="copynew"&&(crsReport.readColList==null||crsReport.readColList.indexOf(aa[Z*Y+6])!=-1))&&(aa[Z*Y+12]!="\u662f"||$(P).html()==""||$(P).html()==undefined)){var aj="";if(y[aa[Z*Y+7]]=="null"){aj=""}else{aj=HandleMemoStr(y[aa[Z*Y+7]],false)}$(P).attr("pval",aj);if(aa[Z*Y+12]=="\u662f"){var S={val:aj};var X=crsReport.crsTableIndex.getAColSchema(aa[Z*Y+6]);crsReport.crsCommon._get_editor(y[aa[Z*Y+8]],X,S);$(P).attr("val2",S.val);$(P).attr("pval",S.val);this.crsCellControler.set_cell_value(ae,W,ab,S.val)}else{if(aa[Z*Y+4]=="\u65e5\u671f\u578b"||aa[Z*Y+4]=="\u8d27\u5e01\u578b"||aa[Z*Y+4]=="\u6570\u503c\u578b"){if((aa[Z*Y+4]=="\u8d27\u5e01\u578b"||aa[Z*Y+4]=="\u6570\u503c\u578b")&&parseFloat(aj)==0||aj=="0"||aj=="0000-00-00 00:00:00"||aj=="0000-00-00"||aj=="00:00:00"){aj="";$(P).attr("pval",aj)}}else{if(aa[Z*Y+4]=="\u81ea\u589e\u578b"){aj=x;$(P).attr("pval",aj)}else{if(aa[Z*Y+4]=="\u4ee3\u7801\u578b"){}else{if(aa[Z*Y+4]=="\u56fe\u7247\u578b"){if(aj!=""){var am=aj.split(" ");$(P).attr("val2",am[0])}}else{if(aa[Z*Y+4]=="\u9644\u4ef6\u578b"){if(aj){$(P).attr("val2",aj)}}}}}}var S={val:aj};var X=crsReport.crsTableIndex.getAColSchema(aa[Z*Y+6]);var an=crsReport.crsCommon._get_editor(y[aa[Z*Y+8]],X,S);if(crsReport.openMode!="read"&&!crsReport.b_is_query&&Z==V-1&&(ad[2]=="\u6309\u884c\u5411\u4e0b"||ad[2]=="\u6309\u5217\u5411\u53f3")){$(P).html(an+this.op)}else{$(P).html(an)}if(aa[Z*Y+4]!="\u903b\u8f91\u578b"){$(P).children("input").width($(P).width()-32)}if(crsReport.openMode!="read"&&!crsReport.b_is_query&&Z==V-1&&(ad[2]=="\u6309\u884c\u5411\u4e0b"||ad[2]=="\u6309\u5217\u5411\u53f3")){var R=$(P).children("input").width()-50;if(R>10){$(P).children("input").width(R)}}if(aa[Z*Y+4]!="\u56fe\u7247\u578b"&&aa[Z*Y+4]!="\u9644\u4ef6\u578b"){this.crsCellControler.set_cell_value(ae,W,ab,aj)}if(aa[Z*Y+5]!=""&&aa[Z*Y+5]!="0"&&$(P).html()!=""){$(P).html('<a onclick="crsReport.on_dblclick(event); return false;" href="#">'+$(P).html()+"</a>")}if(S.val!=aj){if($(P).attr("val")!=null&&$(P).attr("val")==aj){$(P).attr("val",S.val)}if($(P).attr("pval")!=null&&$(P).attr("pval")==aj){$(P).attr("pval",S.val)}if($(P).attr("val2")!=null&&$(P).attr("val2")==aj){$(P).attr("val2",S.val)}}}}else{var aj="";if(y[aa[Z*Y+7]]=="null"){aj=""}else{aj=HandleMemoStr(y[aa[Z*Y+7]],false)}var S={val:aj};var X=crsReport.crsTableIndex.getAColSchema(aa[Z*Y+6]);crsReport.crsCommon._get_editor(y[aa[Z*Y+8]],X,S);if($(P).html()!=""&&$(P).html()!=undefined){$(P).attr("pval",S.val);this.crsCellControler.set_cell_value(ae,W,ab,S.val)}}}y=crsReport.crsTableIndex.get_next_data_item();x++}ad=crsReport.crsTableIndex.getNextTable()}}if(crsReport.openMode!="read"){y=crsReport.crsTableIndex.GetFirstWritableCellList(crsReport.writeColList);var af=15;while(y!=null&&y.length>0){var O=y[5];var al=y[4];var ae=y[2]-1;if(ae>0){this.crsCellControler.cache_td(ae)}for(var M=0;M<O;M++){var Q=0;if(O>1){if(al=="\u6309\u5217\u5411\u53f3"||al=="\u4e0d\u6269\u5c55\uff08\u6309\u5217\u5411\u53f3\uff09"){var Q=y[0].arr_cell_rect[1].x-y[0].arr_cell_rect[0].x+1}else{var Q=y[0].arr_cell_rect[1].y-y[0].arr_cell_rect[0].y+1}}var N="";var Z=0,ak=y.length/af;for(;Z<ak;Z++){var L=y[Z*af].arr_cell_rect;var ai=L[0].x,ah=L[0].y;if(M>0){if(al=="\u6309\u5217\u5411\u53f3"||al=="\u4e0d\u6269\u5c55\uff08\u6309\u5217\u5411\u53f3\uff09"){ai+=Q*M}else{ah+=Q*M}}var T="row"+ah+"column"+ai;var P=crsReport.obj_cell_maps[ae][T];if($(P).attr("cid")!=undefined){break}if($(P).attr("cid")==undefined){$(P).attr("cid",y[Z*af+13])}if(al=="\u6309\u5217\u5411\u53f3"||al=="\u4e0d\u6269\u5c55\uff08\u6309\u5217\u5411\u53f3\uff09"){if(N==""){N=crsReport.crsTableIndex.create_row_kid(y[Z*af+13])}if($(P).attr("rid")==undefined){$(P).attr("rid",N)}}else{if($(P).parent("#row"+ah).attr("rid")==undefined){if(N==""){N=crsReport.crsTableIndex.create_row_kid(y[Z*af+13])}$(P).parent("#row"+ah).attr("rid",N)}}var aj=this.crsCellControler.get_cell_value(ae,ai,ah);if(y[Z*af+6]=="\u81ea\u589e\u578b"){y[Z*af+7]=M+1}var ac=crsReport.get_val_from_para(y[Z*af+13]);if(ac!=""){y[Z*af+7]=ac}if(aj==""){aj=$(P).html();if(aj==undefined){aj=""}if(aj!=""){aj=aj.decodeHtml();this.crsCellControler.set_cell_value(ae,ai,ah,aj);if(s_title_schema.name!=""){if(title_schema==""){title_schema=s_title_schema.name.replaceAll(y[Z*af+13],format_text(y[Z*af+13],aj))}else{title_schema=title_schema.replaceAll(y[Z*af+13],format_text(y[Z*af+13],aj))}}if(crsReport.s_subtitle_schema!=""){if(subtitle_schema==""){subtitle_schema=crsReport.s_subtitle_schema.replaceAll(y[Z*af+13],format_text(y[Z*af+13],aj))}else{subtitle_schema=subtitle_schema.replaceAll(y[Z*af+13],format_text(y[Z*af+13],aj))}}}}if(aj==""&&y[Z*af+7]!=""){aj=y[Z*af+7];if(y[Z*af+8]!="\u662f"){this.crsCellControler.set_cell_value(ae,ai,ah,y[Z*af+7])}else{$(P).attr("val2",y[Z*af+7])}if(s_title_schema.name!=""){if(title_schema==""){title_schema=s_title_schema.name.replaceAll(y[Z*af+13],format_text(y[Z*af+13],y[Z*af+7]))}else{title_schema=title_schema.replaceAll(y[Z*af+13],format_text(y[Z*af+13],y[Z*af+7]))}}if(crsReport.s_subtitle_schema!=""){if(subtitle_schema==""){subtitle_schema=crsReport.s_subtitle_schema.replaceAll(y[Z*af+13],format_text(y[Z*af+13],y[Z*af+7]))}else{subtitle_schema=subtitle_schema.replaceAll(y[Z*af+13],format_text(y[Z*af+13],y[Z*af+7]))}}}var S={val:aj};var X=crsReport.crsTableIndex.getAColSchema(y[Z*af+13]);var an=crsReport.crsCommon._get_editor(N,X,S);if(S.val!=aj){if($(P).attr("val")!=null&&$(P).attr("val")==aj){$(P).attr("val",S.val)}if($(P).attr("pval")!=null&&$(P).attr("pval")==aj){$(P).attr("pval",S.val)}if($(P).attr("val2")!=null&&$(P).attr("val2")==aj){$(P).attr("val2",S.val)}}if(!crsReport.b_is_query&&Z==ak-1&&(al=="\u6309\u884c\u5411\u4e0b"||al=="\u6309\u5217\u5411\u53f3")){$(P).html(an+this.op)}else{$(P).html(an)}if(y[Z*af+6]!="\u903b\u8f91\u578b"){$(P).children("input").width($(P).width()-32)}if(!crsReport.b_is_query&&Z==ak-1&&(al=="\u6309\u884c\u5411\u4e0b"||al=="\u6309\u5217\u5411\u53f3")){var R=$(P).children("input").width()-50;if(R>10){$(P).children("input").width(R)}}}}y=crsReport.crsTableIndex.GetNextWritableCellList(crsReport.writeColList)}}if(crsReport.openMode=="edit"&&crsReport.s_data_flow!=""){crsReport.openMode="write"}},append_record:function(w){var s=$(w).parent().parent("td");if(crsReport.crsTableIndex!=null){var t=crsReport.crsTableIndex.can_append(s,true);if(t.b_can_append){var u="";crsReport.crsCommon.blur_handler();if(t.expandtype=="\u6309\u884c\u5411\u4e0b"){var r=rectNameToIndex(t.def_rect);var A=this.crsCellControler.get_sheet_index_by_cell(s);u=$(s).attr("cid");crsReport.crsTableIndex.update_cell_refer(parseInt(A)+1,t.expandtype,r,1,true);var q=r[1].y-r[0].y+1;this.crsCellControler.insert_row(s,A,r[0].y+q*(t.initcz-1),1);this.crsCellControler.cache_td(A);var D=r[0].y+q*t.initcz;var C="row"+D+"column"+r[0].x;$(crsReport.obj_cell_maps[A][C]).parent("#row"+D).attr("rid",crsReport.crsTableIndex.create_row_kid(u));if(t.arr_noclear!=undefined){for(var y=0,v=t.arr_noclear.length;y<v;y++){var E=rectNameToIndex(t.arr_noclear[y]);var z=crsReport.crsCommon.get_cell_value(A,E[0].x,r[0].y);crsReport.crsCommon.set_cell_value(A,E[0].x,r[0].y+q,z)}}if(t.arr_defaultval!=undefined){for(var y=0,v=t.arr_defaultval/2;y<v;y++){var E=rectNameToIndex(t.arr_defaultval[y*2]);this.crsCellControler.crsCommon(A,E[0].x,r[0].y+q,t.arr_defaultval[y*2+1])}}}else{if(t.expandtype=="\u6309\u5217\u5411\u53f3"){var r=rectNameToIndex(t.def_rect);var A=this.crsCellControler.get_sheet_index_by_cell(s);u=$(s).attr("cid");crsReport.crsTableIndex.update_cell_refer(parseInt(A)+1,t.expandtype,r,1,true);var q=r[1].x-r[0].x+1;this.crsCellControler.insert_column(A,r[0].x+q*(t.initcz-1),1);this.crsCellControler.cache_td(A);var D=r[0].x+q*t.initcz;var B=crsReport.crsTableIndex.create_row_kid(u);for(var y=r[0].y;y<=r[1].y;){var C="row"+y+"column"+D;var x=$(crsReport.obj_cell_maps[A][C]);x.attr("rid",B);if(x.attr("rowspan")!=undefined){y+=parseInt(x.attr("rowspan"))}else{y+=1}}if(t.arr_noclear!=undefined){for(var y=0,v=t.arr_noclear.length;y<v;y++){var E=rectNameToIndex(t.arr_noclear[y]);var z=this.crsCellControler.get_cell_value(A,r[0].x,E[0].y);this.crsCellControler.set_cell_value(A,r[0].x+q,E[0].y,z)}}if(t.arr_defaultval!=undefined){for(var y=0,v=t.arr_defaultval/2;y<v;y++){var E=rectNameToIndex(t.arr_defaultval[y*2]);this.crsCellControler.set_cell_value(A,r[0].x+q,E[0].y,t.arr_defaultval[y*2+1])}}}}if(u!=""){crsReport.crsTableIndex.auto_increment(u)}}}},insert_record:function(v){var q=$(v).parent().parent("td");if(crsReport.crsTableIndex!=null){var s=crsReport.crsTableIndex.can_append(q,true);if(s.b_can_append){var t="";crsReport.crsCommon.blur_handler();if(s.expandtype=="\u6309\u884c\u5411\u4e0b"){var p=rectNameToIndex(s.def_rect);var z=this.crsCellControler.get_sheet_index_by_cell(q);t=$(q).attr("cid");var r=this.crsCellControler.get_cell_point(q);crsReport.crsTableIndex.update_cell_refer(parseInt(z)+1,s.expandtype,p,1,true);this.crsCellControler.insert_row(q,z,r.y,1,true);this.crsCellControler.cache_td(z);var B="row"+r.y+"column"+ +r.x;$(crsReport.obj_cell_maps[z][B]).parent("#row"+r.y).attr("rid",crsReport.crsTableIndex.create_row_kid(t));if(s.arr_noclear!=undefined){for(var x=0,u=s.arr_noclear.length;x<u;x++){var C=rectNameToIndex(s.arr_noclear[x]);var y=crsReport.crsCommon.get_cell_value(z,C[0].x,p[0].y);crsReport.crsCommon.set_cell_value(z,C[0].x,p[0].y+i_sz,y)}}if(s.arr_defaultval!=undefined){for(var x=0,u=s.arr_defaultval/2;x<u;x++){var C=rectNameToIndex(s.arr_defaultval[x*2]);crsReport.crsCommon.set_cell_value(z,C[0].x,p[0].y+i_sz,s.arr_defaultval[x*2+1])}}}else{if(s.expandtype=="\u6309\u5217\u5411\u53f3"){var p=rectNameToIndex(s.def_rect);var z=this.crsCellControler.get_sheet_index_by_cell(q);var r=this.crsCellControler.get_cell_point(q);t=$(q).attr("cid");crsReport.crsTableIndex.update_cell_refer(parseInt(z)+1,s.expandtype,p,1,true);this.crsCellControler.insert_column(z,r.x,1,true);this.crsCellControler.cache_td(z);var A=crsReport.crsTableIndex.create_row_kid(t);for(var x=p[0].y;x<=p[1].y;){var B="row"+x+"column"+r.x;var w=$(crsReport.obj_cell_maps[z][B]);w.attr("rid",A);if(w.attr("rowspan")!=undefined){x+=parseInt(w.attr("rowspan"))}else{x+=1}}if(s.arr_noclear!=undefined){for(var x=0,u=s.arr_noclear.length;x<u;x++){var C=rectNameToIndex(s.arr_noclear[x]);var y=this.crsCellControler.get_cell_value(z,C[0].x,p[0].y);this.crsCellControler.set_cell_value(z,C[0].x+i_sz,p[0].y,y)}}if(s.arr_defaultval!=undefined){for(var x=0,u=s.arr_defaultval/2;x<u;x++){var C=rectNameToIndex(s.arr_defaultval[x*2]);this.crsCellControler.set_cell_value(z,C[0].x+i_sz,p[0].y,s.arr_defaultval[x*2+1])}}}}if(t!=""){crsReport.crsTableIndex.auto_increment(t)}}}},delete_record:function(o,l){if(l==undefined){l=$(o).parent().parent("td")}if(crsReport.crsTableIndex!=null){var p=crsReport.crsTableIndex.can_delete(l,true);if(p.b_can_delete){if(p.b_all){crsReport.show_hint("\u660e\u7ec6\u8868\u6700\u540e\u4e00\u6761\u8bb0\u5f55\u4e0d\u80fd\u5220\u9664\uff01");return}var m="";crsReport.blur_handler();if(p.expandtype=="\u6309\u884c\u5411\u4e0b"){var q=rectNameToIndex(p.def_rect);var r=this.crsCellControler.get_sheet_index_by_cell(l);m=$(l).attr("cid");var k=this.crsCellControler.get_cell_point(l);crsReport.crsTableIndex.update_cell_refer(parseInt(r)+1,p.expandtype,q,1,false);crsReport.crsTableIndex.delete_row_kid($(l).parent("#row"+k.y).attr("rid"));this.crsCellControler.delete_row(l,r,k.y,1);this.crsCellControler.cache_td(r);var n=k.y-1;l=crsReport.obj_cell_maps[r]["row"+n+"column"+k.x]}else{if(p.expandtype=="\u6309\u5217\u5411\u53f3"){var q=rectNameToIndex(p.def_rect);var r=this.crsCellControler.get_sheet_index_by_cell(l);var k=this.crsCellControler.get_cell_point(l);crsReport.crsTableIndex.update_cell_refer(parseInt(r)+1,p.expandtype,q,1,false);crsReport.crsTableIndex.delete_row_kid($(l).attr("rid"));this.crsCellControler.delete_column(r,k.x,1);this.crsCellControler.cache_td(r);var n=k.x-1;l=crsReport.obj_cell_maps[r]["row"+k.y+"column"+n]}}if(m!=""){crsReport.crsTableIndex.auto_increment(m)}}}}};function TCRSCellControler(){}TCRSCellControler.prototype={constructor:TCRSCellControler,insert_row:function(B,s,y,z,t){var v=1;y=parseInt(y),z=parseInt(z);if($(B).attr("rowspan")!=undefined){v=parseInt($(B).attr("rowspan"))}if(t==undefined||!t){crsReport.crsCommon.add_action_maps(["app",s,y,z*v,v]);crsReport.crsChartCache.update_ref(s,y,z*v,"app",false)}else{crsReport.crsCommon.add_action_maps(["ins",s,y,z*v,v]);crsReport.crsChartCache.update_ref(s,y,z*v,"ins",false)}var e=$("#sheet"+s+" tr").last();var u=e.attr("id").replace("row","");var w=(t==undefined||!t)?y+v:y;for(var D=u;D>=w;D--){var F=parseInt(D)+parseInt(z)*v;$("#sheet"+s+" tr:eq("+D+")").attr("id","row"+F)}var x=this;for(var D=z;D>0;D--){for(var E=0;E<v;E++){var A=$("#sheet"+s+" tr:eq("+(y+E)+")");if(t==undefined||!t){var F=y+D*v+E}else{var F=w+(z-D)*v+E}$(A).children().each(function(){var b=1,c=1;if($(this).attr("rowspan")!=undefined){b=parseInt($(this).attr("rowspan"))}if($(this).attr("colspan")!=undefined){c=parseInt($(this).attr("colspan"))}if(b>1||c>1){var a=$(this).attr("class").indexOf(" ");if(a==-1){a=$(this).attr("class").length}var d=$(this).attr("class").substr(0,a);var d=parseInt(d.replace("column",""));crsReport.crsCommon.add_action_maps(["merge",s,d,F,(d+c-1),(F+b-1)])}});var C=$(A).clone(true,true).attr("id","row"+F);this.clear_tr(C);if(t==undefined||!t){$("#sheet"+s+" tr:eq("+(y+v-1+E)+")").after($(C))}else{$("#sheet"+s+" tr:eq("+y+")").before($(C));y++}}}},delete_row:function(s,n,q,r){var p=1;if($(s).attr("rowspan")!=undefined){p=parseInt($(s).attr("rowspan"))}q=parseInt(q),r=parseInt(r);for(var t=0;t<r;t++){for(var u=0;u<p;u++){var v=q+t*p+u;$("#row"+v).remove()}}var m=$("#sheet"+n+" tr").last();var o=m.attr("id").replace("row","");p=r*p;for(var t=q+p;t<=o;t++){var v=t-p;$("#row"+t).attr("id","row"+v);$("#sheet"+n+" tr:eq("+v+")").find("td").each(function(){var e=$(this).attr("func");if(false&&e!=undefined){if(e.substr(0,1)=="="){var k=e.substring(1)}var f=crsReport.crsCalculation._parseFormula(k);var d=e;for(var b=0;b<f.length;b++){var a=f[b].value;var g=f[b].stype;if(g=="Cell Reference"&&a.length>1&&a.indexOf("$")==-1){var h=cellNameToIndex(a);if(q<h.y){h.y-=parseInt(r)*p;var c=cellIndexToName(h);d=d.replace(a,c);$(this).attr("func",d)}}}}})}crsReport.crsCommon.add_action_maps(["del",n,q,r*p]);crsReport.crsChartCache.update_ref(n,q,r*p,"del",false)},insert_column:function(q,l,n,r,m){var o=1;n=parseInt(n),r=parseInt(r);if($(q).attr("colspan")!=undefined){o=parseInt($(q).attr("colspan"))}if(m==undefined||!m){crsReport.crsCommon.add_action_maps(["app",l,n+o,r*o]);crsReport.crsChartCache.update_ref(l,n,r*o,"app",true)}else{crsReport.crsCommon.add_action_maps(["ins",l,n,r*o]);crsReport.crsChartCache.update_ref(l,n,r*o,"ins",true)}var k=(m==undefined||!m)?n+o:n;var s=$("#sheet"+l+" tr:eq(0)").find("td:last").index();$("#sheet"+l+" tr").each(function(){if($(this).attr("rid")){for(var b=s;b>=k;b--){var a=parseInt(b)+parseInt(r)*o;var d=$(this).find("td:eq("+b+")");var c=d.attr("class").replace("column"+b,"column"+a);d.attr("class",c)}if(r>1){$("#sheet"+l).css("width","")}}});var p;$("#sheet"+l+" tr").each(function(){if($(this).attr("rid")){for(var g=r;g>0;g--){if(r>1){p=n+r-g}else{p=n}var e=$(this).find("td:eq("+p+")");if(m==undefined||!m){var a=p+o}else{var a=k}var f=$(e).attr("class").indexOf(" ");if(f==-1){f=$(e).attr("class").length}var b=$(e).attr("class").substr(0,f);var c=$(e).clone(false);var d=$(c).attr("class").replace(b,"column"+a);$(c).attr("class",d);$(c).text("");if($(c).attr("val")!=undefined){$(c).attr("val","")}if($(c).attr("val2")!=undefined){$(c).attr("val2","")}if($(c).attr("pval")!=undefined){$(c).attr("pval","")}if(m==undefined||!m){$(this).find("td:eq("+(p)+")").after($(c))}else{$(this).find("td:eq("+(p)+")").before($(c))}}}});$("#sheet"+l+" tr").find("td").each(function(){var f=$(this).attr("func");if(false&&f!=undefined){if(f.substr(0,1)=="="){var a=f.substring(1)}var g=crsReport.crsCalculation._parseFormula(a);var e=f;for(var c=0;c<g.length;c++){var b=g[c].value;var h=g[c].stype;if(h=="Cell Reference"&&b.length>1&&b.indexOf("$")==-1){var t=cellNameToIndex(b);if(n<=t.x){t.x+=parseInt(r)*o;var d=cellIndexToName(t);e=e.replace(b,d);$(this).attr("func",e)}}}}})},delete_column:function(o,l,m,r){var n=1;if($(o).attr("colspan")!=undefined){n=parseInt($(o).attr("colspan"))}m=parseInt(m),r=parseInt(r);var s=$("#sheet"+l+" tr").children("td:last").index();for(var p=0;p<r;p++){for(var q=0;q<n;q++){var t=m+p*n+q;$("#sheet"+l+" tr").find("td:eq("+t+")").remove()}}n=r*n;$("#sheet"+l+" tr").each(function(){for(var z=m;z<s;z++){var C=$(this).find("td:eq("+z+")");var e=C.attr("class").indexOf(" ");if(e==-1){e=C.attr("class").length}var a=C.attr("class").substr(0,e);var g=C.attr("class").replace(a,"column"+z);C.attr("class",g);var c=C.attr("func");if(false&&c!=undefined){if(c.substr(0,1)=="="){var k=c.substring(1)}var d=crsReport.crsCalculation._parseFormula(k);var b=c;for(var B=0;B<d.length;B++){var A=d[B].value;var f=d[B].stype;if(f=="Cell Reference"&&A.length>1&&A.indexOf("$")==-1){var h=cellNameToIndex(A);if(m<h.x){h.x-=parseInt(r)*n;var D=cellIndexToName(h);b=b.replace(A,D);C.attr("func",b)}}}}}});crsReport.crsCommon.add_action_maps(["del",l,m,r*n]);crsReport.crsChartCache.update_ref(l,m,r*n,"del",false)},clear_tr:function(b){$(b).children("td").each(function(){var g=$(this).children(":eq(0)");if(g.length>0){var e=g[0].tagName.toLowerCase();if(e=="img"||e=="a"){var f=crsReport.crsTableIndex.getAColSchema($(this).attr("cid"));var a=$(this).children("i").length>0?"<i align='right'>"+$(this).children("i").html()+"</i>":"";$(this).html(crsReport.crsCommon._get_editor($(this).parent().attr("rid"),f)+a)}else{$(this).children().val("")}}if($(this).attr("val")!=undefined){$(this).attr("val","")}if($(this).attr("val2")!=undefined){$(this).attr("val2","")}if($(this).attr("pval")!=undefined){$(this).attr("pval","")}})},cache_td:function(g){var f=this;var l=crsReport;if(l.obj_cell_maps.length<1){l.obj_cell_maps=null;l.obj_cell_maps={}}var h=false;var k=l.obj_cell_maps[g]==undefined;l.obj_cell_maps[g]=[];$("#sheet"+g+" td").each(function(){var a=$(this).attr("class").indexOf(" ");if(a==-1){a=$(this).attr("class").length}var c=$(this).attr("class").substr(0,a);if(k){var b=$(this).text();if(b!=""&&b.charAt(0)=="="){$(this).attr("func",b);$(this).text("");if(!h){h=true}}}l.obj_cell_maps[g][$(this).parent("tr").attr("id")+c]=this});if(!this.b_has_excel_func&&h){this.b_has_excel_func=true}},set_cell_value:function(r,n,k,o,l){var q;if(k!=undefined){var p="row"+k+"column"+n;q=crsReport.obj_cell_maps[r][p]}else{o=n;q=r;r=this.get_sheet_index_by_cell(q);var m=this.get_cell_point(q);n=m.x;k=m.y}if(l==undefined){l=format_text($(q).attr("cid"),o)}if($(q).attr("val")!=o){$(q).attr("val",o);if($(q).attr("func")==undefined){crsReport.crsCommon.add_action_maps(["set",r,n,k,o])}}},set_cell_value2:function(h,m,k,n){var p;if(k!=undefined){var o="row"+k+"column"+m;var p=crsReport.obj_cell_maps[h][o]}else{n=m;p=h;h=this.get_sheet_index_by_cell(p);var l=this.get_cell_point(p);m=l.x;k=l.y}if($(p).attr("val2")!=n){$(p).attr("val2",n);if($(p).attr("func")==undefined){crsReport.crsCommon.add_action_maps(["set",h,m,k,n])}}},get_cell:function(f,g,h){var k="row"+h+"column"+g;var l=crsReport.obj_cell_maps[f][k];return l},get_cell_point:function(h){var g=$(h).attr("class").indexOf(" ");if(g==-1){g=$(h).attr("class").length}var f=$(h).attr("class").substr(0,g);var e={x:f.replace("column",""),y:$(h).parent().attr("id").replace("row","")};return e},get_cell_rect:function(k){var h=$(k).attr("class").indexOf(" ");if(h==-1){h=$(k).attr("class").length}var g=$(k).attr("class").substr(0,h);var f={x:g.replace("column",""),y:$(k).parent().attr("id").replace("row","")};var l={x:f.x,y:f.y};if($(k).attr("rowspan")!=undefined){l.y=parseInt(l.y)+$(k).attr("rowspan")-1}if($(k).attr("colspan")!=undefined){l.x=parseInt(l.x)+$(k).attr("colspan")-1}return new Array(f,l)},get_sheet_index_by_cell:function(d){var f=$(d).parent();f=$(f).parent();f=$(f).parent();var e=$(f).attr("id");return e.replace("sheet","")},get_cell_value:function(g,h,k){var l="row"+k+"column"+h;var n=crsReport.obj_cell_maps[g][l];var m=$(n).attr("val");if(m==undefined){m=$(n).attr("val2")}return m!=undefined?m:""},get_cell_attr:function(h,k,m,l){var n="row"+m+"column"+k;var p=crsReport.obj_cell_maps[h][n];var o=$(p).attr(l);return o!=undefined?o:""},set_cell_backgroud_color:function(h,k,m,l,p){var n="row"+m+"column"+k;var o=crsReport.obj_cell_maps[h][n];if(l==undefined&&$(o).attr("prev-background-color")!=undefined){l=$(o).attr("prev-background-color")}if(l!=undefined){if(p&&$(o).attr("prev-background-color")==undefined){$(o).attr("prev-background-color",$(o).css("background-color"))}$(o).css("background-color",l)}},set_cell_pvalue:function(g,k,h,l){var m="row"+h+"column"+k;var n=crsReport.obj_cell_maps[g][m];$(n).attr("pval",l)},clear_cell:function(r,k,n){var o="row"+n+"column"+k;var p=crsReport.obj_cell_maps[r][o];$(p).attr("val2","");$(p).attr("val","");var q=crsReport.crsTableIndex.getAColSchema($(p).attr("cid"));var l=crsReport.crsTableIndex.rows[q.row_idx];if($(p).html().indexOf("</select>")!=-1){$($(p).html()).attr("selectedIndex",0)}else{if($(p).html().indexOf("green_plus.gif")!=-1){var m=$(p).children("input").width();$(p).html(crsReport.crsCommon._get_editor($(p).parent("tr").attr("rid"),q)+crsReport.crsCommon.crsTable.op);$(p).children("input").width(m)}else{$(p).html(crsReport.crsCommon._get_editor($(p).parent("tr").attr("rid"),q))}}if($(p).attr("func")==undefined){crsReport.crsCommon.add_action_maps(["set",r,k,n,""])}}};function TCRSFormView(b){this.obj_detail_dump_row={};this.arr_action_maps=null;this.obj_coord_to_kid_map=null;this.obj_cur_editor=null;this.i_default_height=200}TCRSFormView.prototype={constructor:TCRSFormView,set_coord_to_kid_map:function(){this.obj_coord_to_kid_map={};if(!crsReport.crsTableIndex.isEmpty()){var l=crsReport.crsTableIndex.first();while(!crsReport.crsTableIndex.EOF()){if(this.obj_coord_to_kid_map[l.sheetindex-1]==undefined){this.obj_coord_to_kid_map[l.sheetindex-1]={}}var o=crsReport.crsTableIndex.getColumn(l.id);if(l.tabletype=="\u4e3b\u8868"){if(this.obj_coord_to_kid_map[l.sheetindex-1]["m"]==undefined){this.obj_coord_to_kid_map[l.sheetindex-1]["m"]={}}if(!o.isEmpty()){var k=o.first();while(!o.EOF()){var p=crsReport.crsTableIndex.getAColSchema(k.kid);var m=p.display_rect;this.obj_coord_to_kid_map[l.sheetindex-1]["m"][m[0].x+"_"+m[0].y]=p;k=o.next()}}}else{if(l.tabletype=="\u660e\u7ec6\u8868"){if(this.obj_coord_to_kid_map[l.sheetindex-1]["d"]==undefined){this.obj_coord_to_kid_map[l.sheetindex-1]["d"]=[]}if(!o.isEmpty()){var k=o.first();while(!o.EOF()){var p=crsReport.crsTableIndex.getAColSchema(k.kid);var m=p.display_rect;var h={};if(l.expandtype=="\u6309\u884c\u5411\u4e0b"||l.expandtype=="\u4e0d\u6269\u5c55"){var n=m[1].y-m[0].y+1;h={x1:m[0].x,y1:m[0].y,x2:m[1].x,y2:m[1].y+(l.initcz-1)*n,col:p}}this.obj_coord_to_kid_map[l.sheetindex-1]["d"].push(h);k=o.next()}}this.auto_increment(l,o)}}l=crsReport.crsTableIndex.next()}}},_get_td_by_coord:function(u,q,r,x){var p=null,s=null;if(x==undefined){x=false}if(this.obj_coord_to_kid_map!=undefined){if(this.obj_coord_to_kid_map[u]!=undefined){if(this.obj_coord_to_kid_map[u]["m"]!=undefined){s=this.obj_coord_to_kid_map[u]["m"][q+"_"+r];if(s!=undefined){if(x){return s}var t=crsReport.crsTableIndex.rows[s.row_idx];p=$("#main_tab_"+t.id+" td[cid='"+s.kid+"']")}}if(p==null){if(this.obj_coord_to_kid_map[u]["d"]!=undefined){for(var w=0,v=this.obj_coord_to_kid_map[u]["d"].length;w<v;w++){var y=this.obj_coord_to_kid_map[u]["d"][w];if(y.x1<=q&&y.x2>=q&&y.y1<=r&&y.y2>=r){s=y.col;if(x){return s}var A=s.get_display_seq(q,r);var t=crsReport.crsTableIndex.rows[s.row_idx];var z=$("#detail_tab_"+t.id).children().eq(0).children("tr").eq(A);var o="detail_tab_"+t.id+"_"+s.kid;p=$(z).children("td[aria-describedby='"+o+"']");break}}}}}}return p},_get_td_and_schema_by_coord:function(s,o,p){var m={};if(this.obj_coord_to_kid_map!=undefined){if(this.obj_coord_to_kid_map[s]!=undefined){if(this.obj_coord_to_kid_map[s]["m"]!=undefined){m.schema=this.obj_coord_to_kid_map[s]["m"][o+"_"+p];if(m.schema!=undefined){var r=crsReport.crsTableIndex.rows[m.schema.row_idx];m.td=$("#main_tab_"+r.id+" td[cid='"+m.schema.kid+"']")}}if(m.schema==undefined){if(this.obj_coord_to_kid_map[s]["d"]!=undefined){for(var t=0,q=this.obj_coord_to_kid_map[s]["d"].length;t<q;t++){var u=this.obj_coord_to_kid_map[s]["d"][t];if(u.x1<=o&&u.x2>=o&&u.y1<=p&&u.y2>=p){m.schema=u.col;var w=m.schema.get_display_seq(o,p);var r=crsReport.crsTableIndex.rows[m.schema.row_idx];var v=$("#detail_tab_"+r.id).children().eq(0).children("tr").eq(w);var n="detail_tab_"+r.id+"_"+m.schema.kid;m.td=$(v).children("td[aria-describedby='"+n+"']");break}}}}}}if(m.td!=undefined&&m.td.length<1){m.td=undefined}return m},_add_action_maps:function(b){if(!crsReport.b_has_inline_calcu){return}if(this.arr_action_maps==null){this.arr_action_maps=b}else{this.arr_action_maps=this.arr_action_maps.concat(b)}},calculate:function(d,c){if(d==undefined){d=false}if(this.arr_action_maps==null){return}d=!d;crsReport.crsDataSet.calculate(this.arr_action_maps,this._fill_calculate_val,this,d,c);this.arr_action_maps=null},_fill_calculate_val:function(d,f,e){f.arr_action_maps=null;if(e!=undefined&&e){crsReport.crsDataSet.save_as_excel(crsReport.s_repname)}$.each(d,function(b,a){if(a!=undefined){f._set_cell_value(a.pg,a.x,a.y,a.val,true)}})},_set_cell_value:function(q,l,n,o,p){var s=this._get_td_and_schema_by_coord(q,l,n);var k=s.td;if($(k).length>0){if(o!=""&&s.schema.datatype=="\u4ee3\u7801\u578b"){if(s.schema.codeid==-11){var r=crsReport.crsUserCache.get_id_by_name(o);$(k).children().eq(1).val(o);o=r}}var m=s.schema.col.rows[s.schema.col_idx].refrepid;if(o!=""&&m!=""&&m!="0"){$(k).html("<a href='javascript:' target='_blank' onclick='crsReport.on_dblclick(event); return false;' style='text-decoration: underline'>"+format_text(s.schema.kid,o)+"</a>")}else{$(k).children().eq(0).val(format_text(s.schema.kid,o))}this.set_cell_value(q,l,n,o,k,s.schema.kid,p)}},set_cell_pvalue:function(l,h,f,k){var g=this._get_td_by_coord(l,h,f);if($(g).length>0){$(g).attr("pval",k)}},get_cell:function(d,e,f){return this._get_td_by_coord(d,e,f)},get_cell_attr:function(k,l,n,m){var o=this._get_td_and_schema_by_coord(k,l,n);var r=o.td;var q="";if(r!=undefined){q=$(r).attr(m);if(q==undefined&&m=="cid"){q=$(r).attr("aria-describedby");if(q!=undefined){var p=q.indexOf("{");if(p==-1){}q=q.substr(p)}}}else{if(m=="cid"){q=o.schema.kid}}return q!=undefined?q:""},get_cell_value:function(q,n,r){if(r!=undefined){var p=this._get_td_and_schema_by_coord(q,n,r);var l=p.td}else{if(n!=undefined){var m=crsReport.crsTableIndex.getAColSchema(q);var k=m.get_cell_point(n);return this.get_cell_value(0,k.x,k.y)}else{var l=q}}if(l!=undefined){var o=$(l).attr("val");if(o==undefined){o=$(l).attr("val2")}}else{if(n!=undefined){var s=p.schema.get_display_seq(n,r);o=crsReport.crsTableIndex.get_hidden_cell_value(p.schema.kid,s)}}return o!=undefined?o:""},set_cell_value:function(p,m,h,n,o,l,k){if(o==undefined){o=this._get_td_by_coord(p,m,h)}if(k==undefined){k=false}if($(o).attr("val")!=n){$(o).attr("val",n);if(!k){crsReport.crsCommon.add_action_maps(["set",p,m,h,n])}}},set_cell_value2:function(p,m,h,n,o,l,k){if(o==undefined){o=this._get_td_by_coord(p,m,h)}if(k==undefined){k=false}if($(o).attr("val2")!=n){$(o).attr("val2",n);if(!k){crsReport.crsCommon.add_action_maps(["set",p,m,h,n])}}},set_hidden_cell_value:function(g,k,h,l){var m=this._get_td_by_coord(g,k,h,true);var n=m.get_display_seq(k,h);crsReport.crsTableIndex.set_hidden_cell_value(m.kid,n,l)},set_hidden_cell_pvalue:function(g,k,h,l){var m=this._get_td_by_coord(g,k,h,true);var n=m.get_display_seq(k,h);crsReport.crsTableIndex.set_hidden_cell_value(m.kid,n,l,true)},_get_cid:function(b){return $(b).attr("id")},_get_rid:function(d){var c=$(d).parent().siblings().eq(0);c=$(c).text();return c},_get_cid_by_td:function(e){var f=$(e).attr("cid");if(f==undefined){f=$(e).attr("aria-describedby");var d=f.indexOf("{");if(d==-1){return""}f=f.substr(d)}return f},_get_rid_by_td:function(d){var c=$(d).siblings().eq(0);c=$(c).text();return c},_get_row_seq:function(m){var n=$(m).parent().children();var g=$(m).attr("id");var l=1;for(var h=n.length;l<h;l++){var k=$(n[l]).attr("id");if(k==g){break}}return l},_add_row:function(e,k){var l=this;if(e.data!=undefined){e.stopPropagation();l=e.data.me;e=e.data.tabid}var f=crsReport.crsTableIndex.getColumn(e);var h=crsReport.crsTableIndex.create_row_kid(f.rows[0].kid);var g=crsReport.crsTableIndex.search("id",e);if(crsReport.crsTableIndex.arr_hidden_rows!=null&&crsReport.crsTableIndex.arr_hidden_rows[g.id]!=undefined){if(crsReport.crsTableIndex.arr_hidden_rows[g.id]["dat"][h]==undefined){crsReport.crsTableIndex.arr_hidden_rows[g.id]["dat"][h]=[]}}if(g.canwrite==undefined&&g.canread==undefined){return""}if(l.obj_detail_dump_row["tab_"+e]!=undefined){l.obj_detail_dump_row["tab_"+e]["kid"]=h;if(k!=undefined){$("#detail_tab_"+e).jqGrid("addRowData",l.obj_detail_dump_row["tab_"+e]["kid"],l.obj_detail_dump_row["tab_"+e],"before",k)}else{$("#detail_tab_"+e).jqGrid("addRowData",l.obj_detail_dump_row["tab_"+e]["kid"],l.obj_detail_dump_row["tab_"+e],"last")}}if(l.obj_default_val!=undefined&&l.obj_default_val["tab_"+e]!=undefined){$("table[id='detail_tab_"+e+"'] tr[id='"+l.obj_detail_dump_row["tab_"+e]["kid"]+"'] td").each(function(){var b=$(this).attr("aria-describedby");var a=b.indexOf("{");if(a!==-1){b=b.substr(a);if(l.obj_default_val["tab_"+e][b]!=undefined){$(this).attr("val",l.obj_default_val["tab_"+e][b])}}})}},_delete_row:function(h,l){var k=crsReport.crsTableIndex.search("id",h);if(k.initcz==1){crsReport.show_hint("\u660e\u7ec6\u8868\u6700\u540e\u4e00\u6761\u8bb0\u5f55\u4e0d\u80fd\u5220\u9664\uff01");return}var o=this._get_row_seq($(l).parent().parent());var m=$(l).parent().siblings().eq(2).attr("aria-describedby");var n=m.indexOf("{");m=m.substr(n);this._update_cell_refer(m,o,"del");crsReport.crsTableIndex.delete_row_kid($(l).parent().parent().attr("id"));var p=$(l).parent().siblings().eq(0);p=$(p).text();$("#detail_tab_"+h).jqGrid("delRowData",p);k.initcz=parseInt(k.initcz)-1;this.set_coord_to_kid_map()},_insert_row:function(h,l){var p=$(l).parent().siblings().eq(0);p=$(p).text();var o=this._get_row_seq($(l).parent().parent());var m=$(l).parent().siblings().eq(2).attr("aria-describedby");var n=m.indexOf("{");m=m.substr(n);var k=crsReport.crsTableIndex.search("id",h);this._update_cell_refer(m,o,"ins");this._add_row(h,p);k.initcz=parseInt(k.initcz)+1;this.set_coord_to_kid_map()},_get_position:function(e,f){var h=crsReport.crsTableIndex.getAColSchema(e);var g=h.get_cell_rect(f);return g},_update_cell_refer:function(l,r,k,o){if(o==undefined){o=1}var n=crsReport.crsTableIndex.getAColSchema(l);var q=crsReport.crsTableIndex.rows[n.row_idx];var p=n.col.rows[n.col_idx];var s=n.get_cell_rect(r);var m=s[1].y-s[0].y+1;if(k=="ins"||k=="app"){crsReport.crsCommon.add_action_maps([k,parseInt(q.sheetindex)-1,s[0].y,o*m,m])}else{crsReport.crsCommon.add_action_maps([k,parseInt(q.sheetindex)-1,s[0].y,o*m])}crsReport.crsChartCache.update_ref(parseInt(q.sheetindex),s[0].y,o*m,k,false);crsReport.crsTableIndex.update_cell_refer(parseInt(q.sheetindex),q.expandtype,s,o,k=="ins"||k=="app")},auto_increment:function(l,n){if(l.tabletype=="\u660e\u7ec6\u8868"){var o=parseInt(l.sheetindex)-1;if(!n.isEmpty()){var m=n.first();while(!n.EOF()){if(m.datatype=="\u81ea\u589e\u578b"){var k=rectNameToIndex(m.cellspan);if(l.expandtype=="\u6309\u884c\u5411\u4e0b"||l.expandtype=="\u4e0d\u6269\u5c55"){var p=k[1].y-k[0].y+1;for(var h=0;h<l.initcz;h++){this._set_cell_value(o,k[0].x,k[1].y+h*p,h+1)}}}m=n.next()}}}},append_record:function(l,n,h){var o=this;if(l.data!=undefined){l.stopPropagation();o=l.data.me;n=l.data.obj_col;l=l.data.obj_tab}if(h==undefined){h=1}if(l.expandtype=="\u6309\u884c\u5411\u4e0b"){var p=n.get_cell_rect(l.initcz);var m=p[1].y-p[0].y+1;o._update_cell_refer(n.kid,l.initcz,"app",h);for(var k=0;k<h;k++){o._add_row(l.id)}l.initcz=parseInt(l.initcz)+h;o.set_coord_to_kid_map()}},clear_cell:function(q,o,r){var p=this._get_td_and_schema_by_coord(q,o,r);var m=p.td;if(m!=undefined){$(m).attr("val2","");$(m).attr("val","");$(m).empty();var l=this._get_cid_by_td(m);var k=p.schema;var n=crsReport.crsTableIndex.rows[k.row_idx];if($(m).html().indexOf("</select>")!=-1){$($(m).html()).attr("selectedIndex",0)}else{$(m).html(crsReport.crsCommon._get_editor(this._get_rid_by_td(m),k))}}else{var s=p.schema.get_display_seq(o,r);crsReport.crsTableIndex.clear_hidden_cell_value(p.schema.kid,s)}crsReport.crsCommon.add_action_maps(["set",q,o,r,""])},delete_record:function(p,r,o,s){var q=this._get_td_and_schema_by_coord(r,o,s);var m=q.td,n=q.schema.kid,t;var k="";if(m!=undefined){t=this._get_row_seq($(m).parent("tr"));k=$(m).parent("tr").attr("id");var l=$(m).siblings().eq(0);l=$(l).text();$("#detail_tab_"+p.id).jqGrid("delRowData",l)}else{t=q.schema.get_display_seq(o,s);crsReport.crsTableIndex.delete_hidden_row(n,t)}this._update_cell_refer(n,t,"del");crsReport.crsTableIndex.delete_row_kid(k);p.initcz=parseInt(p.initcz)-1;this.set_coord_to_kid_map()},set_cell_backgroud_color:function(l,f,k,h){var g=this._get_td_by_coord(l,f,k);$(g).children("input").each(function(){if(h!=undefined){$(this).css("background-color",h)}else{$(this).css("background-color","")}})},_draw_a_td:function(v,s,w,o,r,q,y){if(o.ismust){var u="Red"}else{var u=""}var t="";if(v){var x=o.col.obj_data_cache.get_nth_by_col_name("col"+q.id);t=HandleMemoStr(y[x],false);if(t=="null"){t=""}if((q.datatype=="\u8d27\u5e01\u578b"||q.datatype=="\u6570\u503c\u578b")&&parseFloat(t)==0||q.datatype=="\u65e5\u671f\u578b"&&(t=="0"||t=="0000-00-00 00:00:00"||t=="0000-00-00"||t=="00:00:00")){t=""}}else{t=crsReport.get_val_from_para(o.kid);if(t==""){t=q.defaultval}}var p={val:""};if(o.canread){p.val=t}var n=crsReport.crsCommon._get_editor(w,o,p);if(p.val!=t){t=p.val}if(q.has_inline_calcu!="y"){var m=rectNameToIndex(q.cellspan);crsReport.crsCommon.add_action_maps(["set",parseInt(r.sheetindex)-1,m[0].x,m[0].y,t])}s+='<td width="150" class="TableLabel" nowrap=""><span title="" class="TableContent '+u+'">'+q.columnlabel+'</span></td><td class="TableData Width40" cid="'+q.kid+'"'+((v)?(' pval="'+t+'"'):"")+' val="'+t+'">'+n+"</td>";return s},draw_form:function(ap){if(ap){var ak=crsReport.crsTableIndex.getFirstTable();while(ak!=null){var av=ak[1]-1;var ao=rectNameToIndex(ak[5]);if(ak[3]<1){ak[3]=1}if(ak[0]=="\u660e\u7ec6\u8868"){if(ak[2]=="\u6309\u884c\u5411\u4e0b"){if(ak[4]>ak[3]){crsReport.crsTableIndex.update_cell_refer(parseInt(av)+1,ak[2],ao,ak[4]-ak[3],true);crsReport.crsCommon.add_action_maps(["app",av,ao[0].y,(ak[4]-ak[3])*(ao[1].y-ao[0].y+1),(ao[1].y-ao[0].y+1)])}}else{if(ak[2]=="\u6309\u5217\u5411\u53f3"){if(ak[4]>ak[3]){crsReport.crsTableIndex.update_cell_refer(parseInt(av)+1,ak[2],ao,ak[4]-ak[3],true);crsReport.crsCommon.add_action_maps(["app",av,ao[0].x,(ak[4]-ak[3])*(ao[1].x-ao[0].x+1),(ao[1].x-ao[0].x+1)])}}}}ak=crsReport.crsTableIndex.getNextTable()}}this.set_coord_to_kid_map();$('<form name="my_form" method="post" enctype="multipart/form-data" action="" target=""/>').appendTo($("body"));$('<div id="id_select" style="width: 250px;height:250px;background-color: #ffffff;overflow:auto;z-index: 1999;position: absolute;display:none;"></div>').appendTo($("body"));var al=this;if(!crsReport.crsTableIndex.isEmpty()){var U=3;var af,aw;var X=crsReport.crsTableIndex.first();while(!crsReport.crsTableIndex.EOF()){var ar=crsReport.crsTableIndex.getColumn(X.id);var ad,at,ab;if(X.tabletype=="\u4e3b\u8868"&&ar.length()>0){var r="";var aa=0,Y=0;var ax="",an=ar.arr_output_cols.length,s=0;if(ap){ab=ar.obj_data_cache.rows[0];ad=ar.obj_data_cache.get_nth_by_col_name("kid");ax=ab[ad]}else{ax=crsReport.crsTableIndex.create_row_kid(ar.rows[0].kid)}if(ar.arr_hidden_cols!=null){if(crsReport.crsTableIndex.arr_hidden_rows[X.id]["dat"][ax]==undefined){crsReport.crsTableIndex.arr_hidden_rows[X.id]["dat"][ax]=[]}for(var G=0,aj=ar.arr_hidden_cols.length;G<aj;G++){if(ap){aw=ar.rows[ar.arr_hidden_cols[G]];ad=ar.obj_data_cache.get_nth_by_col_name("col"+aw.id);at=HandleMemoStr(ab[ad],false);crsReport.crsTableIndex.arr_hidden_rows[X.id]["dat"][ax][aw.kid]={val:at,pval:at}}else{aw=ar.rows[ar.arr_hidden_cols[G]];crsReport.crsTableIndex.arr_hidden_rows[X.id]["dat"][ax][aw.kid]={val:"",pval:""}}}}if(ar.arr_picture_cols!=null){if(r==""){r='<div id="main_tab_'+X.id+'"><ul><li><a href="#m_tab_'+X.id+'">'+X.label+'</a></li></ul><div id="m_tab_'+X.id+'"><table width="100%" id="main_tab_'+X.id+'" align="center" class="App_TableBlock" border="0" cellspacing="0"><tbody>'}aa=ar.arr_picture_cols.length;if(aa*U<=an){for(var S=0;S<aa;S++){for(var T=0;T<U;T++){aw=ar.rows[ar.arr_output_cols[s++]];af=crsReport.crsTableIndex.getAColSchema(aw.kid);r+="<tr rid='"+ax+"'>";r=this._draw_a_td(ap,r,ax,af,X,aw,ab);if(T==0){af=crsReport.crsTableIndex.getAColSchema(ar.arr_picture_cols[S]);aw=af.col.rows[af.col_idx];if(af.ismust){var ag=" Red"}else{var ag=""}if(ap){ad=ar.obj_data_cache.get_nth_by_col_name("col"+aw.id);at=HandleMemoStr(ab[ad],false);if(at=="null"){at=""}}else{at=""}var am={val:""};if(af.canread){am.val=at}var W=crsReport.crsCommon._get_editor(ax,af,am);at=am.val;if(aw.has_inline_calcu!="y"){var ac=rectNameToIndex(aw.cellspan);crsReport.crsCommon.add_action_maps(["set",parseInt(X.sheetindex)-1,ac[0].x,ac[0].y,at])}r+='<td width="150" class="TableLabel" rowspan='+U+' nowrap="" style="vertical-align: middle;"><span title="" class="TableContent'+ag+'">'+aw.columnlabel+'</span></td><td class="TableData Width40" rowspan='+U+' cid="'+aw.kid+'"'+((ap)?(' pval="'+at+'"'):"")+' val="'+((ap)?at:"")+'" style="vertical-align: middle;">'+W+"</td>"}r+="</tr>"}}}else{for(var S=0;S<aa;S++){for(var T=0;T<U;T++){r+="<tr rid='"+ax+"'>";if(T==0){af=crsReport.crsTableIndex.getAColSchema(ar.arr_picture_cols[S]);aw=af.col.rows[af.col_idx];if(af.ismust){var ag=" Red"}else{var ag=""}if(ap){ad=ar.obj_data_cache.get_nth_by_col_name("col"+aw.id);at=HandleMemoStr(ab[ad],false);if(at=="null"){at=""}}else{at=""}var am={val:""};if(af.canread){am.val=at}var W=crsReport.crsCommon._get_editor(ax,af,am);at=am.val;if(aw.has_inline_calcu!="y"){var ac=rectNameToIndex(aw.cellspan);crsReport.crsCommon.add_action_maps(["set",parseInt(X.sheetindex)-1,ac[0].x,ac[0].y,at])}r+='<td width="150" class="TableLabel" rowspan='+U+' nowrap="" style="vertical-align: middle;"><span title="" class="TableContent'+ag+'">'+aw.columnlabel+'</span></td><td class="TableData Width40" rowspan='+U+' cid="'+aw.kid+'"'+((ap)?(' pval="'+at+'"'):"")+' val="'+((ap)?at:"")+'" style="vertical-align: middle;">'+W+"</td>"}if(s<an){aw=ar.rows[ar.arr_output_cols[s++]];af=crsReport.crsTableIndex.getAColSchema(aw.kid);r=this._draw_a_td(ap,r,ax,af,X,aw,ab)}else{r+='<td class="TableLabel" colspan=2>&nbsp;</td>'}r+="</tr>"}}}if(s>=an){r+="</tbody></table></div></div>"}}while(s<an){if(r==""){r='<div id="main_tab_'+X.id+'"><ul><li><a href="#m_tab_'+X.id+'">'+X.label+'</a></li></ul><div id="m_tab_'+X.id+'"><table width="100%" id="main_tab_'+X.id+'" align="center" class="App_TableBlock" border="0" cellspacing="0"><tbody>'}aw=ar.rows[ar.arr_output_cols[s++]];af=crsReport.crsTableIndex.getAColSchema(aw.kid);if(Y%2==0){r+="<tr rid='"+ax+"'>"}r=this._draw_a_td(ap,r,ax,af,X,aw,ab);if(Y%2==1){r+="</tr>"}Y++}if(Y>0){if(Y%2==1){r+='<td class="TableLabel" colspan=2>&nbsp;</td></tr>'}r+="</tbody></table></div></div>"}if(r!=""){$(r).appendTo($("body > form"))}ar.arr_picture_cols=null;ar.arr_output_cols=null;ar.arr_hidden_cols=null}else{if(X.tabletype=="\u660e\u7ec6\u8868"){if(!ar.isEmpty()){var k,k,V="",Z="";aw=ar.first();while(!ar.EOF()){af=crsReport.crsTableIndex.getAColSchema(aw.kid);if(!af.canwrite&&!af.canread){}else{if(V==""){if(crsReport.openMode=="read"){k=["kid"],obj_col_model=[{name:"kid",index:"kid",hidden:true}]}else{k=["kid","\u64cd\u4f5c"],obj_col_model=[{name:"kid",index:"kid",hidden:true},{name:"ope",index:"ope",width:35,sortable:false,fixed:true}]}V='<li><a href="#tab_'+X.id+'">'+X.label+"</a></li>";Z='<div id="tab_'+X.id+'" align="center"><table id="detail_tab_'+X.id+'"><tr><td></td></tr></table><div id="pager_detail_tab_'+X.id+'"></div></div>';if(crsReport.openMode=="read"){}else{al.obj_detail_dump_row["tab_"+X.id]={kid:"",ope:'<img title="\u63d2\u5165" onclick="crsReport.crsCommon.crsForm._insert_row('+X.id+', this)" src="/static/modules/reportshop/images/Update.ico" border="0" style="cursor:pointer"><img title="\u5220\u9664" onclick="crsReport.crsCommon.crsForm._delete_row('+X.id+', this)" src="/static/modules/reportshop/images/delete.gif" border="0" style="cursor:pointer">'}}}k.push(aw.columnlabel);obj_col_model.push({name:aw.kid,index:aw.kid,sortable:false,width:(aw.columnlabel.length<4?4:aw.columnlabel.length)*60});if(crsReport.openMode=="read"){}else{if(af.canread&&aw.defaultval!=""){var am={val:aw.defaultval};al.obj_detail_dump_row["tab_"+X.id][aw.kid]=crsReport.crsCommon._get_editor(ax,af,am)+"</td>"}else{var am={val:""};al.obj_detail_dump_row["tab_"+X.id][aw.kid]=crsReport.crsCommon._get_editor(ax,af,am)+"</td>"}if(crsReport.openMode!="read"&&aw.defaultval!=""){if(al.obj_default_val==undefined){al.obj_default_val={}}if(al.obj_default_val["tab_"+X.id]==undefined){al.obj_default_val["tab_"+X.id]={}}al.obj_default_val["tab_"+X.id][aw.kid]=aw.defaultval}}}aw=ar.next()}if(X.canwrite!=undefined||X.canread!=undefined){if($("#detail_tabs").length<=0){$('<div id="detail_tabs"><ul>'+V+"</ul>"+Z+"</div>").appendTo($("body > form"))}else{$(V).appendTo($("#detail_tabs ul"));$(Z).appendTo($("#detail_tabs"))}$("#detail_tab_"+X.id).jqGrid({datatype:"local",height:this.i_default_height,width:"100%",colNames:k,colModel:obj_col_model,pager:"#pager_detail_tab_"+X.id,sortname:"id",viewrecords:true,sortorder:"desc"})}if(crsReport.openMode=="write"){for(var G=0;G<X.initcz;G++){al._add_row(X.id)}}else{var ah=ar.obj_data_cache;if(!ah.isEmpty()){var ab=ah.first();var ae=ah.get_nth_by_col_name("kid");while(!ah.EOF()){var au=null,ai={};if(X.canwrite!=undefined||X.canread!=undefined){if(crsReport.openMode=="read"){au={kid:ab[ae]}}else{au={kid:ab[ae],ope:'<img title="\u63d2\u5165" onclick="crsReport.crsCommon.crsForm._insert_row('+X.id+', this)" src="/static/modules/reportshop/images/Update.ico" border="0" style="cursor:pointer"><img title="\u5220\u9664" onclick="crsReport.crsCommon.crsForm._delete_row('+X.id+', this)" src="/static/modules/reportshop/images/delete.gif" border="0" style="cursor:pointer">'}}}aw=ar.first();while(!ar.EOF()){af=crsReport.crsTableIndex.getAColSchema(aw.kid);if(!af.canwrite&&!af.canread){if(crsReport.crsTableIndex.arr_hidden_rows[X.id]["dat"][ab[ae]]==undefined){crsReport.crsTableIndex.arr_hidden_rows[X.id]["dat"][ab[ae]]=[]}ad=ah.get_nth_by_col_name("col"+aw.id);at=HandleMemoStr(ab[ad],false);crsReport.crsTableIndex.arr_hidden_rows[X.id]["dat"][ab[ae]][aw.kid]={val:at,pval:at}}else{if(af.canread){ad=ah.get_nth_by_col_name("col"+aw.id);at=HandleMemoStr(ab[ad],false);if(at=="null"){at=""}if((aw.datatype=="\u8d27\u5e01\u578b"||aw.datatype=="\u6570\u503c\u578b")&&parseFloat(at)==0||aw.datatype=="\u65e5\u671f\u578b"&&(at=="0"||at=="0000-00-00 00:00:00"||at=="0000-00-00"||at=="00:00:00")){at=""}}else{at=""}var am={val:at};au[aw.kid]=crsReport.crsCommon._get_editor(ab[ae],af,am)+"</td>";ai[aw.kid]=am.val;at=am.val}if(aw.has_inline_calcu!="y"){var ac=af.get_cell_rect(parseInt(ab[10]));crsReport.crsCommon.add_action_maps(["set",parseInt(X.sheetindex)-1,ac[0].x,ac[0].y,at])}aw=ar.next()}if(X.canwrite!=undefined||X.canread!=undefined){$("#detail_tab_"+X.id).jqGrid("addRowData",au.kid,au,"last");$("table[id='detail_tab_"+X.id+"'] tr[id='"+au.kid+"'] td").each(function(){var b=$(this).attr("aria-describedby");var a=b.indexOf("{");if(a!==-1){b=b.substr(a);$(this).attr("val",ai[b]);$(this).attr("pval",ai[b])}})}var ab=ah.next()}}}if(X.canwrite!=undefined||X.canread!=undefined){$("#detail_tab_"+X.id).jqGrid("navGrid","#pager_detail_tab_"+X.id,{edit:false,del:false,search:false,refresh:false});$("#add_detail_tab_"+X.id+" span").bind("click",{obj_tab:X,obj_col:af,tabid:X.id,me:al},al.append_record)}}}}X=crsReport.crsTableIndex.next()}}try{if($("div[id^='main_tab_']").length>0){$("div[id^='main_tab_']").tabs()}}catch(e){}try{if($("#detail_tabs").length>0){$("#detail_tabs").tabs()}}catch(e){}if(!crsReport.crsChartCache.isEmpty()){V="",Z="";var aq=crsReport.crsChartCache.first();while(!crsReport.crsChartCache.EOF()){var R=getColPlatKId(aq.label);aq.label=R;aq.category_name=HandleMemoStr(aq.category_name,false);aq.series_name=HandleMemoStr(aq.series_name,false);V+='<li><a href="#'+R+'">'+aq.title+"</a></li>";Z+='<div id="'+R+'" style="min-width:450px;min-height:350px;"></div>';aq=crsReport.crsChartCache.next()}if(crsReport.crsChartCache.length()>1){if($("#detail_tabs").length>0){$("#detail_tabs").before($('<div id="chart_tabs" align="center"><ul>'+V+"</ul>"+Z+"</div>"))}else{$('<div id="chart_tabs" align="center"><ul>'+V+"</ul>"+Z+"</div>").appendTo($("body > form"))}try{if($("#chart_tabs").length>0){$("#chart_tabs").tabs()}}catch(e){}}else{if($("#detail_tabs").length>0){$("#detail_tabs").before($('<div id="chart_tabs" align="center">'+Z+"</div>"))}else{$('<div id="chart_tabs" align="center">'+Z+"</div>").appendTo($("body > form"))}}var aq=crsReport.crsChartCache.first();while(!crsReport.crsChartCache.EOF()){crsReport.crsChartCache.draw_chart(aq);aq=crsReport.crsChartCache.next()}}this.resize()},begin_update:function(){},end_update:function(){this.calculate();crsReport.crsChartCache.refresh()},resize:function(){var d=0;$("div[id^='main_tab_']").each(function(){d+=$(this).height()});var e=jQuery(window).width()-40;var f=jQuery(window).height()-d-125;if(e>this.i_default_height){jQuery("table[id^='detail_tab_']").jqGrid("setGridWidth",e);jQuery("#chart_tabs > div").width(e)}if(f>this.i_default_height){if(jQuery("#chart_tabs").length>0){if($("#detail_tabs").length>0){f-=$("#detail_tabs").height()}if(f>this.i_default_height){jQuery("#chart_tabs > div").height(f)}}else{jQuery("table[id^='detail_tab_']").jqGrid("setGridHeight",f)}}}};
